{
  "sha": "73a3187a708e5a9282fc0de3904f2aec4ac5347b",
  "message": "Add timeline auto-generation scheduler with asyncio.run() fix\n\nImplements automatic timeline image generation at midnight (Beijing time)\nfor all users with activity on the previous day. Concurrent generation\nwith rate limiting (max 5 concurrent).\n\nChanges:\n- backend/database.py: Add timezone-aware helpers\n  - get_users_with_activity_on_date(): Find users with sessions on date\n  - extract_text_from_sessions_on_date(): Extract text from date-filtered sessions\n  - Both convert Beijing local time to UTC for database queries\n\n- backend/scheduler.py: New async scheduler module\n  - generate_for_user(): Single user generation with idempotency\n  - generate_timeline_images_for_date(): Batch generation with Semaphore\n  - daily_generation_job(): Scheduled job wrapper\n  - Uses asyncio.Semaphore for rate limiting (max 5 concurrent)\n\n- backend/server.py: APScheduler integration\n  - Add AsyncIOScheduler with midnight cron trigger\n  - Update generate_daily_picture() to accept optional target_date param\n  - Add /api/admin/trigger-timeline-generation endpoint for manual testing\n  - Fix: Use asyncio.run() to create event loop for scheduler thread\n\nTested successfully:\n- Scheduler triggers at configured time\n- Finds users with activity on target date\n- Skips users with existing images (idempotency)\n- Generates new images concurrently\n- Stats: 2 total, 1 success, 1 skipped, 0 failed",
  "author": {
    "name": "lexicalmathical",
    "email": "lexicalmathical@gmail.com",
    "date": "2025-11-18T03:01:22Z"
  },
  "committer": {
    "name": "lexicalmathical",
    "email": "lexicalmathical@gmail.com",
    "date": "2025-11-18T03:01:22Z"
  },
  "stats": {
    "total": 381,
    "additions": 378,
    "deletions": 3
  },
  "files_count": 3,
  "parents": [
    "7a8675a8e78764848a1ceb6eaa99aba33456ec21"
  ]
}