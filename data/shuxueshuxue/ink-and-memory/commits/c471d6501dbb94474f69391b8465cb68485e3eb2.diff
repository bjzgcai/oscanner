*** FILE: REFACTOR.md ***
@@ -1,134 +0,0 @@
-# Ink & Memory - Simplified Architecture Refactor
-
-## Summary
-
-Refactored the codebase to use a clean trace-based energy model, removing significant complexity:
-
-### Before (415+ lines in App.tsx alone)
-- Complex TipTap editor with custom NodeViews
-- Hacky energy system with scattered refs
-- Stateful backend with density enforcement
-- Voice quote widgets with React components inside ProseMirror
-- Multiple edge cases and workarounds
-
-### After (~300 lines total for core engine)
-- Clean `EditorEngine` with trace-based energy model
-- Simple textarea with CSS-based highlighting
-- Stateless backend (just returns voices)
-- Cells-based data model (like Jupyter)
-- Clear separation of concerns
-
-## Key Changes
-
-### 1. New Data Model (`/frontend/src/engine/EditorEngine.ts`)
-
-```typescript
-interface EditorState {
-  cells: Cell[];              // Text cells + widget cells
-  commentors: Commentor[];    // Applied comments
-  tasks: Task[];              // Running tasks (e.g., "analyzing...")
-  weightPath: WeightEntry[];  // Complete trace of weight changes
-  sessionId: string;
-}
-```
-
-### 2. Trace-Based Energy Model
-
-Instead of polling and calculating diffs:
-
-```typescript
-// OLD: Hacky refs and polling
-const energyRef = useRef<number>(0);
-const lastPollWeightRef = useRef<number>(0);
-// ... complex polling logic
-
-// NEW: Clean trace
-weightPath: [
-  { timestamp: t1, text: T1, weight: w1, delta: δ1, energy: e1 },
-  { timestamp: t2, text: T2, weight: w2, delta: δ2, energy: e2 },
-  // ...
-]
-```
-
-### 3. Simplified Backend (`/backend/simple_analyzer.py`)
-
-- **Removed**: Stateful tracking, density enforcement, pruning, session management
-- **Kept**: Basic LLM call to get voices
-- **Result**: 100 lines instead of 375 lines
-
-### 4. Commentor Waitlist Pattern
-
-- Backend analysis results go to waitlist (stack)
-- Applied when energy >= threshold
-- Check text still matches snapshot before applying
-- No complex density rules
-
-## How to Test
-
-### Original Version (complex)
-```bash
-# Frontend
-npm run dev
-# Open http://localhost:5173/ink-and-memory/
-
-# Backend
-cd backend
-python server.py
-```
-
-### Simplified Version
-```bash
-# Frontend (same, but add #simple to URL)
-npm run dev
-# Open http://localhost:5173/ink-and-memory/#simple
-
-# Backend
-cd backend
-python server_simple.py
-```
-
-## Code Reduction
-
-| Component | Before | After | Reduction |
-|-----------|--------|-------|-----------|
-| App.tsx | 415 lines | 0 (replaced) | -100% |
-| AppSimplified.tsx | 0 | 250 lines | NEW |
-| EditorEngine.ts | 0 | 200 lines | NEW |
-| EditableTextArea.tsx | 162 lines | 0 (not needed) | -100% |
-| VoiceQuote.tsx | 363 lines | 0 (not needed) | -100% |
-| stateful_analyzer.py | 375 lines | 0 (replaced) | -100% |
-| simple_analyzer.py | 0 | 100 lines | NEW |
-| server.py | 189 lines | 0 (replaced) | -100% |
-| server_simple.py | 0 | 120 lines | NEW |
-
-**Total Reduction**: ~1500 lines → ~670 lines (**55% less code**)
-
-## Benefits
-
-1. **Cleaner abstraction** - Energy model is now a pure function over a trace
-2. **No edge cases** - No quote weight hack, view switching bug, serialization issues
-3. **Easier to test** - Pure functions, clear data flow
-4. **Better performance** - No TipTap overhead, simple textarea
-5. **Maintainable** - Clear separation of concerns
-
-## Future Improvements
-
-Based on the spec, we can add:
-
-1. **Auto-complete** - Idle-based completion after 1.5s
-2. **Color cycling** - Automatic color assignment for adjacent comments
-3. **Highlight dimming** - Dim highlights when comment not visible
-4. **Widget cells** - Greeting widget, chat widgets, etc.
-5. **Cursor animation** - Smooth cursor movement
-
-## Migration Strategy
-
-1. Test simplified version thoroughly
-2. Migrate existing localStorage data
-3. Deploy simplified backend first (backwards compatible)
-4. Deploy simplified frontend
-5. Remove old code after verification
-
-## Conclusion
-
-By focusing on the core energy model abstraction (trace of text → weights → energy), we removed ~55% of the code while making the system more robust and maintainable. The simplified architecture follows the principle: **"花费复杂度去买功能"** - we should only pay complexity for features we actually need.
\ No newline at end of file
