commit 0f5de428ee88fea7dc7df350338c6a8a0e621944
Author: lexicalmathical <lexicalmathical@gmail.com>
Date:   Sun Nov 2 15:36:46 2025 +0800

    Fix timing issue: force position recalc after StateChooser collapses
    
    Previous fix wasn't enough - timing issue remained:
    1. selectedState changes
    2. commentGroups useMemo runs (wrong timing!)
    3. StateChooser's useEffect runs â†’ collapses
    4. DOM updates but positions don't recalculate
    
    Solution: Add useEffect that triggers refsReady increment with 50ms delay
    - Ensures StateChooser has collapsed before recalculation
    - DOM has settled before measuring offsetTop
    - Console log added for debugging
    
    ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
    
    Co-Authored-By: Claude <noreply@anthropic.com>

diff --git a/frontend/src/App.tsx b/frontend/src/App.tsx
index 817ae61..2caf075 100644
--- a/frontend/src/App.tsx
+++ b/frontend/src/App.tsx
@@ -318,6 +318,18 @@ export default function App() {
     }
   }, [currentView]);
 
+  // @@@ Force recalculation when selectedState changes (StateChooser height changes)
+  useEffect(() => {
+    if (selectedState) {
+      // Small delay to ensure StateChooser has collapsed and DOM has settled
+      const timer = setTimeout(() => {
+        setRefsReady(prev => prev + 1);
+        console.log('ðŸ“ StateChooser collapsed, recalculating positions');
+      }, 50);
+      return () => clearTimeout(timer);
+    }
+  }, [selectedState]);
+
   // @@@ Fetch default voices from backend
   useEffect(() => {
     getDefaultVoices().then(backendVoices => {
