commit 17d6e9df4a47f243fb4aac0ea73e7778be1af704
Author: lexicalmathical <lexicalmathical@gmail.com>
Date:   Wed Dec 3 01:45:16 2025 +0800

    Add backend deploy workflow

diff --git a/.github/workflows/deploy-backend.yml b/.github/workflows/deploy-backend.yml
new file mode 100644
index 0000000..21a4cda
--- /dev/null
+++ b/.github/workflows/deploy-backend.yml
@@ -0,0 +1,70 @@
+name: Deploy Backend
+
+on:
+  push:
+    branches: [main]
+    paths:
+      - "backend/**"
+      - ".github/workflows/deploy-backend.yml"
+  workflow_dispatch:
+
+env:
+  IMAGE: ghcr.io/shuxueshuxue/ink-backend
+
+jobs:
+  build-and-push:
+    runs-on: ubuntu-latest
+    permissions:
+      contents: read
+      packages: write
+    outputs:
+      image_tag: ${{ steps.meta.outputs.image_tag }}
+    steps:
+      - uses: actions/checkout@v4
+
+      - uses: docker/setup-buildx-action@v3
+
+      - name: Log in to GHCR
+        uses: docker/login-action@v3
+        with:
+          registry: ghcr.io
+          username: ${{ github.actor }}
+          password: ${{ secrets.GITHUB_TOKEN }}
+
+      - name: Build and push image
+        run: |
+          docker buildx build \
+            --platform linux/amd64 \
+            -t $IMAGE:${GITHUB_SHA} \
+            -t $IMAGE:latest \
+            --push \
+            backend
+
+      - name: Export image tag
+        id: meta
+        run: echo "image_tag=${IMAGE}:${GITHUB_SHA}" >> "$GITHUB_OUTPUT"
+
+  deploy:
+    needs: build-and-push
+    runs-on: ubuntu-latest
+    if: github.ref == 'refs/heads/main'
+    steps:
+      - name: Deploy to server over SSH
+        uses: appleboy/ssh-action@v1.2.0
+        with:
+          host: 101.201.227.31
+          username: root
+          key: ${{ secrets.SERVER_SSH_KEY }}
+          script: |
+            set -e
+            IMAGE_TAG="${{ needs.build-and-push.outputs.image_tag }}"
+            cd /root/ink-and-memory/backend
+            mkdir -p /root/ink-and-memory/backend/data
+            docker pull "${IMAGE_TAG}"
+            docker rm -f ink-backend || true
+            tmux kill-session -t ink-and-memory-docker || true
+            tmux new -d -s ink-and-memory-docker \
+              "docker run --name ink-backend --restart unless-stopped \
+                -p 127.0.0.1:8765:8765 \
+                -v /root/ink-and-memory/backend/data:/app/data \
+                ${IMAGE_TAG}"
diff --git a/.gitignore b/.gitignore
index dd9a058..dc9361a 100644
--- a/.gitignore
+++ b/.gitignore
@@ -27,6 +27,7 @@ frontend/node_modules/
 *.db-shm
 *.db-wal
 backend/data/
+backend/ink-backend*.tar.gz
 
 # macOS system files
 .DS_Store
diff --git a/backend/Dockerfile b/backend/Dockerfile
new file mode 100644
index 0000000..2768c96
--- /dev/null
+++ b/backend/Dockerfile
@@ -0,0 +1,28 @@
+# Ink & Memory backend (FastAPI) - Ubuntu-compatible, no nginx
+FROM python:3.9-slim
+
+ENV PYTHONUNBUFFERED=1 \
+    PYTHONDONTWRITEBYTECODE=1 \
+    TZ=UTC
+
+WORKDIR /app
+
+# System deps for cryptography/pillow
+RUN apt-get update && apt-get install -y --no-install-recommends \
+    gcc \
+    libffi-dev \
+    libssl-dev \
+    libjpeg62-turbo-dev \
+    zlib1g-dev \
+    && rm -rf /var/lib/apt/lists/*
+
+# Install Python deps (hashed requirements)
+COPY requirements.txt .
+RUN pip install --no-cache-dir --require-hashes -r requirements.txt
+
+# Copy application code
+COPY . .
+
+EXPOSE 8765
+
+CMD ["uvicorn", "server:app", "--host", "0.0.0.0", "--port", "8765"]
