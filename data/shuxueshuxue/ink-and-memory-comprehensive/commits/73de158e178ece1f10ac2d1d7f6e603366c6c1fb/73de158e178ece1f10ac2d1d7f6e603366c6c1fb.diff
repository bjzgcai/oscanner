commit 73de158e178ece1f10ac2d1d7f6e603366c6c1fb
Author: lexicalmathical <lexicalmathical@gmail.com>
Date:   Sun Oct 26 20:51:30 2025 +0800

    Add mobile-responsive view with cursor-based comment popups
    
    Mobile-specific changes (viewport < 768px):
    - Hide global header (LeftSidebar) on mobile devices
    - Hide left toolbar with Start Fresh and @ buttons
    - Disable horizontal scrolling (overflowX: hidden, touchAction: pan-y)
    - Replace desktop side comments with bottom popup
    - Show comment only when cursor enters highlighted text area
    - Popup appears at bottom with smooth slide-in animation
    
    Desktop behavior unchanged:
    - All existing features work as before
    - Side comments remain visible and positioned correctly
    - Left sidebar and toolbar still accessible
    
    Technical implementation:
    - Added useMobile() hook for responsive detection
    - Mobile detection based on viewport width (<768px) and user agent
    - Track mobileActiveComment state for cursor-based display
    - Modified cursor change handler to detect highlighted area entry
    - Added slideInFromBottom CSS animation for popup
    - Conditional rendering based on isMobile flag throughout
    
    ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
    
    Co-Authored-By: Claude <noreply@anthropic.com>

diff --git a/frontend/src/App.css b/frontend/src/App.css
index c3bd42e..1161b0d 100644
--- a/frontend/src/App.css
+++ b/frontend/src/App.css
@@ -202,6 +202,17 @@
   }
 }
 
+@keyframes slideInFromBottom {
+  from {
+    opacity: 0;
+    transform: translateY(20px);
+  }
+  to {
+    opacity: 1;
+    transform: translateY(0);
+  }
+}
+
 /* Binder rings */
 .binder-ring {
   position: absolute;
diff --git a/frontend/src/App.tsx b/frontend/src/App.tsx
index d0e2f36..6123419 100644
--- a/frontend/src/App.tsx
+++ b/frontend/src/App.tsx
@@ -20,6 +20,7 @@ import StateChooser from './components/StateChooser';
 import type { VoiceConfig } from './types/voice';
 import { getVoices, getMetaPrompt, getStateConfig } from './utils/voiceStorage';
 import { getDefaultVoices, chatWithVoice } from './api/voiceApi';
+import { useMobile } from './utils/mobileDetect';
 
 // @@@ Left Toolbar Component - floating toolbelt within left margin
 function LeftToolbar({ onStartFresh, onInsertAgent }: { onStartFresh: () => void; onInsertAgent: () => void }) {
@@ -243,6 +244,7 @@ function CommentGroupCard({
 
 // @@@ Main App Component
 export default function App() {
+  const isMobile = useMobile();
   const [currentView, setCurrentView] = useState<'writing' | 'settings' | 'calendar' | 'analysis' | 'about'>('writing');
   const [voiceConfigs, setVoiceConfigs] = useState<Record<string, VoiceConfig>>({});
   const [defaultVoiceConfigs, setDefaultVoiceConfigs] = useState<Record<string, VoiceConfig>>({});
@@ -256,6 +258,9 @@ export default function App() {
   const [cursorPosition, setCursorPosition] = useState<number>(0);
   const [cursorCellId, setCursorCellId] = useState<string | null>(null);
 
+  // @@@ Mobile-specific: Track which comment is at cursor for popup display
+  const [mobileActiveComment, setMobileActiveComment] = useState<Commentor | null>(null);
+
   // @@@ Chat widget state
   const [dropdownVisible, setDropdownVisible] = useState(false);
   const [dropdownPosition, setDropdownPosition] = useState({ x: 0, y: 0 });
@@ -552,7 +557,11 @@ export default function App() {
 
     const cellText = (cell as TextCell).content;
     const appliedComments = state.commentors.filter(c => c.appliedAt);
-    if (appliedComments.length === 0) return;
+    if (appliedComments.length === 0) {
+      // Clear mobile comment if no comments exist
+      if (isMobile) setMobileActiveComment(null);
+      return;
+    }
 
     // Find comment at cursor position within this cell's text
     let foundComment: Commentor | null = null;
@@ -569,25 +578,32 @@ export default function App() {
       }
     }
 
+    // @@@ Mobile: Set active comment for popup display
+    if (isMobile) {
+      setMobileActiveComment(foundComment);
+    }
+
     if (!foundComment) return;
 
-    // Find the group key for this cell and navigate to the comment
-    commentGroups.forEach((group, groupKey) => {
-      // Only update groups in the current cell
-      if (group.cellId !== cursorCellId) return;
-
-      const commentIndex = group.comments.findIndex(c => c.id === foundComment!.id);
-      if (commentIndex !== -1) {
-        setGroupPages(prev => {
-          const next = new Map(prev);
-          if (next.get(groupKey) !== commentIndex) {
-            next.set(groupKey, commentIndex);
-          }
-          return next;
-        });
-      }
-    });
-  }, [cursorPosition, cursorCellId, state, commentGroups]);
+    // Desktop: Find the group key for this cell and navigate to the comment
+    if (!isMobile) {
+      commentGroups.forEach((group, groupKey) => {
+        // Only update groups in the current cell
+        if (group.cellId !== cursorCellId) return;
+
+        const commentIndex = group.comments.findIndex(c => c.id === foundComment!.id);
+        if (commentIndex !== -1) {
+          setGroupPages(prev => {
+            const next = new Map(prev);
+            if (next.get(groupKey) !== commentIndex) {
+              next.set(groupKey, commentIndex);
+            }
+            return next;
+          });
+        }
+      });
+    }
+  }, [cursorPosition, cursorCellId, state, commentGroups, isMobile]);
 
   // @@@ Per-cell text change handler
   const handleTextChange = useCallback((cellId: string, newText: string) => {
@@ -923,31 +939,37 @@ export default function App() {
 
   return (
     <>
-      <LeftSidebar currentView={currentView} onViewChange={setCurrentView} />
+      {/* @@@ Hide sidebar on mobile */}
+      {!isMobile && <LeftSidebar currentView={currentView} onViewChange={setCurrentView} />}
+
       {currentView === 'writing' && (
         <div style={{
           display: 'flex',
           height: '100vh',
-          paddingTop: '48px',
+          paddingTop: isMobile ? '0' : '48px',
           fontFamily: 'system-ui, -apple-system, sans-serif'
         }}>
-          {/* Left spacer for layout */}
-          <div style={{
-            width: '48px',
-            backgroundColor: 'transparent',
-            position: 'relative',
-            flexShrink: 0,
-            marginLeft: '12px'
-          }}>
-            <LeftToolbar onStartFresh={handleStartFresh} onInsertAgent={handleInsertAgent} />
-          </div>
+          {/* Left spacer for layout - hide on mobile */}
+          {!isMobile && (
+            <div style={{
+              width: '48px',
+              backgroundColor: 'transparent',
+              position: 'relative',
+              flexShrink: 0,
+              marginLeft: '12px'
+            }}>
+              <LeftToolbar onStartFresh={handleStartFresh} onInsertAgent={handleInsertAgent} />
+            </div>
+          )}
 
           <div
             ref={containerRef}
             style={{
               flex: 1,
               position: 'relative',
-              overflow: 'hidden'
+              overflow: 'hidden',
+              // @@@ Disable horizontal scrolling on mobile
+              ...(isMobile ? { overflowX: 'hidden', touchAction: 'pan-y' } : {})
             }}
           >
             <div style={{
@@ -1068,8 +1090,8 @@ export default function App() {
                   })}
                 </div>
 
-                {/* Comments layer (absolute positioned) */}
-                {Array.from(commentGroups.entries()).map(([groupKey, group]) => {
+                {/* Comments layer (absolute positioned) - hide on mobile */}
+                {!isMobile && Array.from(commentGroups.entries()).map(([groupKey, group]) => {
                   const currentIndex = groupPages.get(groupKey) || 0;
 
                   // @@@ Get the specific textarea for this group's cell
@@ -1102,6 +1124,48 @@ export default function App() {
                     />
                   );
                 })}
+
+                {/* @@@ Mobile comment popup - show when cursor is in highlighted area */}
+                {isMobile && mobileActiveComment && (
+                  <div style={{
+                    position: 'fixed',
+                    bottom: '20px',
+                    left: '10px',
+                    right: '10px',
+                    background: '#fff',
+                    border: '2px solid #ddd',
+                    borderRadius: '12px',
+                    padding: '16px',
+                    boxShadow: '0 8px 24px rgba(0,0,0,0.2)',
+                    zIndex: 100,
+                    fontFamily: "'Excalifont', 'Xiaolai', 'Georgia', serif",
+                    animation: 'slideInFromBottom 0.3s ease-out'
+                  }}>
+                    <div style={{
+                      display: 'flex',
+                      gap: '12px',
+                      alignItems: 'flex-start'
+                    }}>
+                      {(() => {
+                        const Icon = iconMap[mobileActiveComment.icon as keyof typeof iconMap] || FaBrain;
+                        const colors = colorMap[mobileActiveComment.color] || colorMap.blue;
+                        return (
+                          <>
+                            <Icon size={20} color={colors.text} style={{ marginTop: '2px', flexShrink: 0 }} />
+                            <div style={{ flex: 1 }}>
+                              <div style={{ fontWeight: 600, fontSize: '16px', color: colors.text, marginBottom: '8px' }}>
+                                {mobileActiveComment.voice}
+                              </div>
+                              <div style={{ fontSize: '15px', lineHeight: '1.5', color: '#444' }}>
+                                {mobileActiveComment.comment}
+                              </div>
+                            </div>
+                          </>
+                        );
+                      })()}
+                    </div>
+                  </div>
+                )}
               </div>
 
               {/* Debug stats bar at bottom */}
diff --git a/frontend/src/utils/mobileDetect.ts b/frontend/src/utils/mobileDetect.ts
new file mode 100644
index 0000000..cace24b
--- /dev/null
+++ b/frontend/src/utils/mobileDetect.ts
@@ -0,0 +1,44 @@
+/**
+ * Mobile detection utility
+ */
+import React from 'react';
+
+export function isMobile(): boolean {
+  // Check if window exists (for SSR compatibility)
+  if (typeof window === 'undefined') return false;
+
+  // Check viewport width (mobile typically < 768px)
+  const width = window.innerWidth;
+  if (width < 768) return true;
+
+  // Check user agent for mobile devices
+  const userAgent = navigator.userAgent || navigator.vendor || (window as any).opera;
+
+  // Mobile device patterns
+  const mobilePatterns = [
+    /Android/i,
+    /webOS/i,
+    /iPhone/i,
+    /iPad/i,
+    /iPod/i,
+    /BlackBerry/i,
+    /Windows Phone/i
+  ];
+
+  return mobilePatterns.some(pattern => pattern.test(userAgent));
+}
+
+/**
+ * Hook to track mobile state with window resize
+ */
+export function useMobile() {
+  const [mobile, setMobile] = React.useState(isMobile);
+
+  React.useEffect(() => {
+    const handleResize = () => setMobile(isMobile());
+    window.addEventListener('resize', handleResize);
+    return () => window.removeEventListener('resize', handleResize);
+  }, []);
+
+  return mobile;
+}
