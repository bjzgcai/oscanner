commit 948c570895f15df95e651917eed1cc2c27bee571
Author: lexicalmathical <lexicalmathical@gmail.com>
Date:   Sun Nov 2 18:38:20 2025 +0800

    Fix migration dialog appearing repeatedly after clicking Skip
    
    Changes:
    - Set migration flag to 'skipped' instead of 'true' when user skips
    - Migration check now distinguishes between:
      * 'skipped' - User explicitly skipped, don't show again
      * 'true' - Migration completed successfully
      * null/undefined - Migration not attempted yet
    - Only force re-migration if flag is 'true' AND calendar entries exist
    
    This prevents the annoying loop where:
    1. User logs in as guest
    2. Logs back into account
    3. Clicks "Skip" on migration dialog
    4. Refreshes page
    5. Dialog appears again (BUG - now fixed!)
    
    ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
    
    Co-Authored-By: Claude <noreply@anthropic.com>

diff --git a/backend/data/ink-and-memory.db b/backend/data/ink-and-memory.db
index b18a8a5..5f84fb9 100644
Binary files a/backend/data/ink-and-memory.db and b/backend/data/ink-and-memory.db differ
diff --git a/frontend/src/App.tsx b/frontend/src/App.tsx
index e28949c..3c1231d 100644
--- a/frontend/src/App.tsx
+++ b/frontend/src/App.tsx
@@ -395,17 +395,24 @@ export default function App() {
         dailyPictures: !!localStorage.getItem(STORAGE_KEYS.DAILY_PICTURES)
       });
 
-      // @@@ TEMPORARY: Force re-migration if calendar entries exist but weren't imported
-      // Check if calendar entries exist but no sessions in database (migration failed)
+      // @@@ Handle migration scenarios
       const hasCalendar = !!localStorage.getItem(STORAGE_KEYS.CALENDAR_ENTRIES);
       let shouldShowDialog = false;
 
-      if (hasCalendar && migrationDone) {
-        console.warn('âš ï¸ Found calendar entries but migration was marked done - forcing re-migration');
+      // If user explicitly skipped, don't show dialog again
+      if (migrationDone === 'skipped') {
+        console.log('ðŸš« Migration was skipped by user, not showing dialog');
+        shouldShowDialog = false;
+      }
+      // If migration was marked done but calendar entries still exist, it may have failed
+      else if (hasCalendar && migrationDone === 'true') {
+        console.warn('âš ï¸ Found calendar entries but migration was marked done - may have failed, forcing re-migration');
         localStorage.removeItem(STORAGE_KEYS.MIGRATION_COMPLETED);
         // Re-check immediately after clearing flag
         shouldShowDialog = !!hasLocalData; // Migration is now not done
-      } else {
+      }
+      // Normal case: show if there's data and migration not done
+      else {
         shouldShowDialog = !!hasLocalData && !migrationDone;
       }
 
@@ -1084,7 +1091,8 @@ export default function App() {
   }, []);
 
   const handleSkipMigration = useCallback(() => {
-    localStorage.setItem(STORAGE_KEYS.MIGRATION_COMPLETED, 'true');
+    // @@@ Set flag to 'skipped' instead of 'true' to distinguish from successful migration
+    localStorage.setItem(STORAGE_KEYS.MIGRATION_COMPLETED, 'skipped');
     setShowMigrationDialog(false);
   }, []);
 
