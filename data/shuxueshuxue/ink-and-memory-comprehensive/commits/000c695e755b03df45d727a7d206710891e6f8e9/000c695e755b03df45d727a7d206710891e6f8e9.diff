commit 000c695e755b03df45d727a7d206710891e6f8e9
Author: lexicalmathical <lexicalmathical@gmail.com>
Date:   Sun Nov 2 16:48:06 2025 +0800

    Fix migration logging and add calendar recovery endpoint
    
    - Add detailed logging in frontend migration (shows what's being sent)
    - Add detailed logging in backend migration (shows what's being parsed)
    - Remove silent error swallowing in current session import
    - Add /api/import-calendar-recovery endpoint for manual recovery
    - Backend now logs calendar parsing success/failure
    
    This will help diagnose why calendar entries weren't imported

diff --git a/backend/data/ink-and-memory.db b/backend/data/ink-and-memory.db
index 273bbb4..6de16bb 100644
Binary files a/backend/data/ink-and-memory.db and b/backend/data/ink-and-memory.db differ
diff --git a/backend/server.py b/backend/server.py
index abc67fc..51b3789 100644
--- a/backend/server.py
+++ b/backend/server.py
@@ -602,6 +602,12 @@ def import_local_data(request: ImportDataRequest, current_user: dict = Depends(g
 
     user_id = current_user['user_id']
 
+    print(f"\nüîç Migration request for user {user_id}:")
+    print(f"  - currentSession: {len(request.currentSession) if request.currentSession else 0} chars")
+    print(f"  - calendarEntries: {len(request.calendarEntries) if request.calendarEntries else 0} chars")
+    print(f"  - dailyPictures: {len(request.dailyPictures) if request.dailyPictures else 0} chars")
+    print(f"  - oldDocument: {len(request.oldDocument) if request.oldDocument else 0} chars")
+
     # Extract sessions
     sessions = []
 
@@ -614,22 +620,28 @@ def import_local_data(request: ImportDataRequest, current_user: dict = Depends(g
                 'name': 'Current Session',
                 'editor_state': current
             })
-        except:
-            pass
+            print(f"‚úÖ Imported current session ({len(str(current))} chars)")
+        except Exception as e:
+            print(f"‚ùå Failed to parse current session: {e}")
+            # Don't silently fail - this is critical data!
 
     # 2. Calendar entries
     if request.calendarEntries:
         try:
             calendar = json.loads(request.calendarEntries)
+            print(f"üìÖ Parsed calendar with {len(calendar)} dates")
             for date, entries in calendar.items():
+                print(f"  - {date}: {len(entries)} entries")
                 for entry in entries:
                     sessions.append({
                         'id': entry['id'],
                         'name': f"{date} - {entry.get('firstLine', 'Untitled')}",
                         'editor_state': entry['state']
                     })
-        except:
-            pass
+        except Exception as e:
+            print(f"‚ùå Failed to parse calendar entries: {e}")
+            import traceback
+            traceback.print_exc()
 
     # 3. Old document (if exists)
     if request.oldDocument:
@@ -735,6 +747,55 @@ def save_session(
 
     return {"success": True}
 
+@app.post("/api/import-calendar-recovery")
+def import_calendar_recovery(
+    request: dict,
+    current_user: dict = Depends(get_current_user)
+):
+    """
+    Recovery endpoint to import calendar entries that were missed in initial migration.
+
+    Request body:
+    {
+        "calendarEntries": "{\"2025-11-01\": [...]}"  # JSON string
+    }
+    """
+    import json
+
+    user_id = current_user['user_id']
+    calendar_json = request.get('calendarEntries')
+
+    if not calendar_json:
+        raise HTTPException(status_code=400, detail="calendarEntries required")
+
+    sessions = []
+    try:
+        calendar = json.loads(calendar_json)
+        print(f"üìÖ Recovery import: {len(calendar)} dates")
+        for date, entries in calendar.items():
+            print(f"  - {date}: {len(entries)} entries")
+            for entry in entries:
+                sessions.append({
+                    'id': entry['id'],
+                    'name': f"{date} - {entry.get('firstLine', 'Untitled')}",
+                    'editor_state': entry['state']
+                })
+    except Exception as e:
+        print(f"‚ùå Failed to parse calendar: {e}")
+        import traceback
+        traceback.print_exc()
+        raise HTTPException(status_code=400, detail=f"Failed to parse calendar: {str(e)}")
+
+    # Import to database
+    database.import_user_data(user_id, sessions, [], {}, [])
+
+    return {
+        "success": True,
+        "imported": {
+            "sessions": len(sessions)
+        }
+    }
+
 @app.get("/api/sessions")
 def list_sessions(current_user: dict = Depends(get_current_user)):
     """
diff --git a/frontend/src/App.tsx b/frontend/src/App.tsx
index c8e0a6a..eb4a196 100644
--- a/frontend/src/App.tsx
+++ b/frontend/src/App.tsx
@@ -1012,6 +1012,12 @@ export default function App() {
         oldDocument: localStorage.getItem('document') ?? undefined
       };
 
+      // Log what we're about to send
+      console.log('üì¶ Migration data being sent:');
+      console.log('  - currentSession:', migrationData.currentSession ? `${migrationData.currentSession.length} chars` : 'null');
+      console.log('  - calendarEntries:', migrationData.calendarEntries ? `${migrationData.calendarEntries.length} chars` : 'null');
+      console.log('  - dailyPictures:', migrationData.dailyPictures ? `${migrationData.dailyPictures.length} chars` : 'null');
+
       // Call backend migration endpoint
       const result = await importLocalData(migrationData);
 
