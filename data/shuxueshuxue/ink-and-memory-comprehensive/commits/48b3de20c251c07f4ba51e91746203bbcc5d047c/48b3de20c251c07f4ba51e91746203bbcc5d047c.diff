commit 48b3de20c251c07f4ba51e91746203bbcc5d047c
Author: lexicalmathical <lexicalmathical@gmail.com>
Date:   Sun Nov 2 17:21:02 2025 +0800

    Fix migration dialog not showing immediately after clearing flag
    
    Changes:
    - Migration check now properly shows dialog after clearing MIGRATION_COMPLETED flag
    - Previously: flag was cleared but old value was still checked
    - Now: immediately set shouldShowDialog when clearing flag
    
    This ensures the migration dialog appears without requiring a page refresh.
    
    ü§ñ Generated with [Claude Code](https://claude.com/claude-code)
    
    Co-Authored-By: Claude <noreply@anthropic.com>

diff --git a/backend/data/ink-and-memory.db b/backend/data/ink-and-memory.db
index 0bf47a7..b10ef0d 100644
Binary files a/backend/data/ink-and-memory.db and b/backend/data/ink-and-memory.db differ
diff --git a/frontend/src/App.tsx b/frontend/src/App.tsx
index 5582ee9..e28949c 100644
--- a/frontend/src/App.tsx
+++ b/frontend/src/App.tsx
@@ -398,12 +398,18 @@ export default function App() {
       // @@@ TEMPORARY: Force re-migration if calendar entries exist but weren't imported
       // Check if calendar entries exist but no sessions in database (migration failed)
       const hasCalendar = !!localStorage.getItem(STORAGE_KEYS.CALENDAR_ENTRIES);
+      let shouldShowDialog = false;
+
       if (hasCalendar && migrationDone) {
         console.warn('‚ö†Ô∏è Found calendar entries but migration was marked done - forcing re-migration');
         localStorage.removeItem(STORAGE_KEYS.MIGRATION_COMPLETED);
+        // Re-check immediately after clearing flag
+        shouldShowDialog = !!hasLocalData; // Migration is now not done
+      } else {
+        shouldShowDialog = !!hasLocalData && !migrationDone;
       }
 
-      if (hasLocalData && !migrationDone) {
+      if (shouldShowDialog) {
         console.log('‚úÖ Showing migration dialog');
         setShowMigrationDialog(true);
       }
