commit cf68fa89311d10529746f6c595157b324670b144
Author: lexicalmathical <lexicalmathical@gmail.com>
Date:   Sun Nov 2 15:44:51 2025 +0800

    Fix Start Fresh: update state directly, no reload needed
    
    Root cause: Reload-based approach had multiple issues
    1. Created session with random id (session_xxx)
    2. On reload, page loads 'current-session' (hardcoded)
    3. New session never loaded â†’ old content remained
    
    New approach: Update engine state directly
    - Load empty state into engine immediately â†’ instant UI update
    - Save new session to database in background
    - No reload needed â†’ no race conditions
    - Clear localTexts map â†’ textarea displays empty
    
    Benefits:
    - Immediate response (no reload delay)
    - No race conditions
    - Simpler logic
    - Works for both authenticated and guest users
    
    ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
    
    Co-Authored-By: Claude <noreply@anthropic.com>

diff --git a/frontend/src/App.tsx b/frontend/src/App.tsx
index 2725e5b..af47bb7 100644
--- a/frontend/src/App.tsx
+++ b/frontend/src/App.tsx
@@ -836,36 +836,40 @@ export default function App() {
   }, []);
 
   const confirmStartFresh = useCallback(async () => {
-    if (isAuthenticated && engineRef.current) {
-      // @@@ For authenticated users: create NEW session with new sessionId
-      const newSessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
-      const emptyState = {
-        cells: [{ id: Math.random().toString(36).slice(2), type: 'text', content: '' }],
-        commentors: [],
-        tasks: [],
-        weightPath: [],
-        overlappedPhrases: [],
-        sessionId: newSessionId,
-        // @@@ Clear currentEntryId so it creates a NEW calendar entry on save
-        currentEntryId: undefined
-      };
+    setShowWarning(false);
+
+    if (!engineRef.current) return;
 
+    // @@@ Create empty state with NEW sessionId
+    const newSessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
+    const emptyState: EditorState = {
+      cells: [{ id: Math.random().toString(36).slice(2), type: 'text' as const, content: '' }],
+      commentors: [],
+      tasks: [],
+      weightPath: [],
+      overlappedPhrases: [],
+      sessionId: newSessionId,
+      currentEntryId: undefined
+    };
+
+    // @@@ Load empty state directly into engine (immediate UI update)
+    engineRef.current.loadState(emptyState);
+    setState(emptyState);
+    setLocalTexts(new Map());
+
+    if (isAuthenticated) {
+      // @@@ Save to database in background
       try {
         const { saveSession } = await import('./api/voiceApi');
         await saveSession(emptyState.sessionId, emptyState);
         console.log(`âœ… Created new session: ${newSessionId}`);
-        // @@@ Wait for save to complete BEFORE reloading
-        window.location.reload();
       } catch (error) {
-        console.error('Failed to create new session in database:', error);
-        // Reload anyway to clear UI
-        window.location.reload();
+        console.error('Failed to save new session:', error);
       }
     } else {
       // For guest users: clear localStorage
       localStorage.removeItem(STORAGE_KEYS.EDITOR_STATE);
       localStorage.removeItem(STORAGE_KEYS.SELECTED_STATE);
-      window.location.reload();
     }
   }, [isAuthenticated]);
 
