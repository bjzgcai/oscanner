commit 1c76021d0a3c7a2c0f4cfa490cb753ffdd5d80ef
Author: lexicalmathical <lexicalmathical@gmail.com>
Date:   Sun Nov 2 13:51:10 2025 +0800

    Add frontend authentication and localStorage migration
    
    Frontend changes:
    - Create AuthContext with JWT token management
    - Add login/register UI components
    - Wrap app with AuthProvider
    - Show auth screen for guests
    - Add localStorage â†’ database migration dialog on first login
    - Block image generation for non-authenticated users
    - Add auth headers to all authenticated API endpoints
    
    New files:
    - frontend/src/contexts/AuthContext.tsx - Auth state management
    - frontend/src/components/Auth/LoginForm.tsx - Login form
    - frontend/src/components/Auth/RegisterForm.tsx - Register form
    
    Modified files:
    - frontend/src/main.tsx - Wrap with AuthProvider
    - frontend/src/App.tsx - Add auth screens, migration dialog
    - frontend/src/api/voiceApi.ts - Add authenticated endpoints
    - frontend/src/components/CollectionsView.tsx - Block guest image gen
    
    Features:
    - Auto-verify JWT token on mount
    - 7-day token expiration
    - Migration prompt shows after login if localStorage data exists
    - Users can migrate or skip (sets flag to not show again)
    - Images now save to database when authenticated
    
    ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
    
    Co-Authored-By: Claude <noreply@anthropic.com>

diff --git a/frontend/src/App.tsx b/frontend/src/App.tsx
index 7b88a0f..db3fcfe 100644
--- a/frontend/src/App.tsx
+++ b/frontend/src/App.tsx
@@ -22,10 +22,13 @@ import ChatWidgetUI from './components/ChatWidgetUI';
 import StateChooser from './components/StateChooser';
 import type { VoiceConfig } from './types/voice';
 import { getVoices, getMetaPrompt, getStateConfig } from './utils/voiceStorage';
-import { getDefaultVoices, chatWithVoice } from './api/voiceApi';
+import { getDefaultVoices, chatWithVoice, importLocalData, generateDailyPicture, saveDailyPicture } from './api/voiceApi';
 import { useMobile } from './utils/mobileDetect';
 import { CommentGroupCard } from './components/CommentCard';
 import { findNormalizedPhrase } from './utils/textNormalize';
+import { useAuth } from './contexts/AuthContext';
+import LoginForm from './components/Auth/LoginForm';
+import RegisterForm from './components/Auth/RegisterForm';
 
 // @@@ Left Toolbar Component - floating toolbelt within left margin
 function LeftToolbar({
@@ -253,6 +256,13 @@ const colorMap: Record<string, { gradient: string; text: string; glow: string }>
 // @@@ Main App Component
 export default function App() {
   const isMobile = useMobile();
+  const { isAuthenticated, isLoading } = useAuth();
+
+  // @@@ Auth screen state
+  const [authScreen, setAuthScreen] = useState<'login' | 'register'>('login');
+  const [showMigrationDialog, setShowMigrationDialog] = useState(false);
+  const [isMigrating, setIsMigrating] = useState(false);
+
   const [currentView, setCurrentView] = useState<'writing' | 'settings' | 'timeline' | 'analysis' | 'about'>('writing');
   const [showCalendarPopup, setShowCalendarPopup] = useState(false);
   const [voiceConfigs, setVoiceConfigs] = useState<Record<string, VoiceConfig>>({});
@@ -347,6 +357,29 @@ export default function App() {
     }
   }, [currentView]);
 
+  // @@@ Check for localStorage migration after login
+  useEffect(() => {
+    if (isAuthenticated && !isLoading) {
+      // Check if user has localStorage data that needs migration
+      const hasLocalData =
+        localStorage.getItem('ink_memory_state') ||
+        localStorage.getItem('calendarEntries') ||
+        localStorage.getItem('dailyPictures') ||
+        localStorage.getItem('voice-configs') ||
+        localStorage.getItem('meta-prompt') ||
+        localStorage.getItem('state-config') ||
+        localStorage.getItem('selected-state') ||
+        localStorage.getItem('analysisReports');
+
+      // Check if migration already done (flag stored after migration)
+      const migrationDone = localStorage.getItem('migration_completed');
+
+      if (hasLocalData && !migrationDone) {
+        setShowMigrationDialog(true);
+      }
+    }
+  }, [isAuthenticated, isLoading]);
+
   // Initialize engine
   useEffect(() => {
     const sessionId = crypto.randomUUID ? crypto.randomUUID() : Date.now().toString();
@@ -797,6 +830,62 @@ export default function App() {
     setCommentsAligned(prev => !prev);
   }, []);
 
+  // @@@ Handle localStorage migration
+  const handleMigrateData = useCallback(async () => {
+    setIsMigrating(true);
+    try {
+      // Export all localStorage data
+      const migrationData = {
+        currentSession: localStorage.getItem('ink_memory_state'),
+        calendarEntries: localStorage.getItem('calendarEntries'),
+        dailyPictures: localStorage.getItem('dailyPictures'),
+        voiceCustomizations: localStorage.getItem('voice-configs'),
+        metaPrompt: localStorage.getItem('meta-prompt'),
+        stateConfig: localStorage.getItem('state-config'),
+        selectedState: localStorage.getItem('selected-state'),
+        analysisReports: localStorage.getItem('analysisReports'),
+        oldDocument: localStorage.getItem('document')
+      };
+
+      // Call backend migration endpoint
+      const result = await importLocalData(migrationData);
+
+      console.log('âœ… Migration complete:', result.imported);
+
+      // Mark migration as complete
+      localStorage.setItem('migration_completed', 'true');
+
+      // Clear old localStorage data (keep auth token and migration flag)
+      const keysToKeep = ['auth_token', 'migration_completed'];
+      const allKeys = Object.keys(localStorage);
+      allKeys.forEach(key => {
+        if (!keysToKeep.includes(key)) {
+          localStorage.removeItem(key);
+        }
+      });
+
+      setShowMigrationDialog(false);
+
+      // Show success message
+      alert(`Migration successful! Imported:\n- ${result.imported.sessions} sessions\n- ${result.imported.pictures} pictures\n- ${result.imported.preferences} preferences\n- ${result.imported.reports} reports`);
+    } catch (error: any) {
+      console.error('Migration failed:', error);
+      alert(`Migration failed: ${error.message}\n\nYou can try again later from Settings.`);
+    } finally {
+      setIsMigrating(false);
+    }
+  }, []);
+
+  const handleSkipMigration = useCallback(() => {
+    localStorage.setItem('migration_completed', 'true');
+    setShowMigrationDialog(false);
+  }, []);
+
+  const handleAuthSuccess = useCallback(() => {
+    // After successful login/register, check for migration
+    // This is handled by the useEffect hook above
+  }, []);
+
   // @@@ Comment interaction handlers
   const handleCommentStar = useCallback((commentId: string) => {
     if (!engineRef.current) return;
@@ -1067,6 +1156,49 @@ export default function App() {
     return <div style={{ whiteSpace: 'pre-wrap' }}>{elements}</div>;
   };
 
+  // @@@ Show loading state while checking auth
+  if (isLoading) {
+    return (
+      <div style={{
+        display: 'flex',
+        alignItems: 'center',
+        justifyContent: 'center',
+        height: '100vh',
+        fontFamily: "'Excalifont', 'Xiaolai', 'Georgia', serif",
+        fontSize: '18px',
+        color: '#666'
+      }}>
+        Loading...
+      </div>
+    );
+  }
+
+  // @@@ Show auth screen if not authenticated
+  if (!isAuthenticated) {
+    return (
+      <div style={{
+        display: 'flex',
+        alignItems: 'center',
+        justifyContent: 'center',
+        minHeight: '100vh',
+        background: 'linear-gradient(135deg, #f5f0e8 0%, #e8dcc8 100%)',
+        padding: '20px'
+      }}>
+        {authScreen === 'login' ? (
+          <LoginForm
+            onSuccess={handleAuthSuccess}
+            onSwitchToRegister={() => setAuthScreen('register')}
+          />
+        ) : (
+          <RegisterForm
+            onSuccess={handleAuthSuccess}
+            onSwitchToLogin={() => setAuthScreen('login')}
+          />
+        )}
+      </div>
+    );
+  }
+
   if (!state || !engineRef.current) {
     return <div>Loading...</div>;
   }
@@ -1079,6 +1211,106 @@ export default function App() {
 
   return (
     <>
+      {/* @@@ Migration dialog */}
+      {showMigrationDialog && (
+        <div style={{
+          position: 'fixed',
+          top: 0,
+          left: 0,
+          right: 0,
+          bottom: 0,
+          backgroundColor: 'rgba(0, 0, 0, 0.7)',
+          display: 'flex',
+          alignItems: 'center',
+          justifyContent: 'center',
+          zIndex: 10000,
+          padding: '20px'
+        }}>
+          <div style={{
+            backgroundColor: '#fffef9',
+            border: '2px solid #d0c4b0',
+            borderRadius: '12px',
+            padding: '32px',
+            maxWidth: '500px',
+            boxShadow: '0 8px 24px rgba(0, 0, 0, 0.3)',
+            fontFamily: "'Excalifont', 'Xiaolai', 'Georgia', serif"
+          }}>
+            <h2 style={{
+              margin: '0 0 16px 0',
+              fontSize: '24px',
+              color: '#333',
+              fontWeight: 600
+            }}>
+              Migrate Your Data?
+            </h2>
+            <p style={{
+              margin: '0 0 24px 0',
+              fontSize: '16px',
+              lineHeight: '1.6',
+              color: '#555'
+            }}>
+              We found data in your browser. Would you like to migrate it to your account?
+              This will move all your sessions, pictures, and preferences to the cloud.
+            </p>
+            <div style={{
+              display: 'flex',
+              gap: '12px',
+              justifyContent: 'space-between'
+            }}>
+              <button
+                onClick={handleMigrateData}
+                disabled={isMigrating}
+                style={{
+                  flex: 1,
+                  padding: '12px 20px',
+                  border: 'none',
+                  background: isMigrating ? '#ccc' : '#4a90e2',
+                  borderRadius: '6px',
+                  cursor: isMigrating ? 'not-allowed' : 'pointer',
+                  fontSize: '16px',
+                  fontFamily: "'Excalifont', 'Xiaolai', 'Georgia', serif",
+                  color: '#fff',
+                  fontWeight: 600,
+                  transition: 'all 0.2s'
+                }}
+                onMouseEnter={(e) => {
+                  if (!isMigrating) e.currentTarget.style.backgroundColor = '#357abd';
+                }}
+                onMouseLeave={(e) => {
+                  if (!isMigrating) e.currentTarget.style.backgroundColor = '#4a90e2';
+                }}
+              >
+                {isMigrating ? 'Migrating...' : 'Migrate Data'}
+              </button>
+              <button
+                onClick={handleSkipMigration}
+                disabled={isMigrating}
+                style={{
+                  flex: 1,
+                  padding: '12px 20px',
+                  border: '1px solid #d0c4b0',
+                  background: '#fff',
+                  borderRadius: '6px',
+                  cursor: isMigrating ? 'not-allowed' : 'pointer',
+                  fontSize: '16px',
+                  fontFamily: "'Excalifont', 'Xiaolai', 'Georgia', serif",
+                  color: '#666',
+                  transition: 'all 0.2s'
+                }}
+                onMouseEnter={(e) => {
+                  if (!isMigrating) e.currentTarget.style.backgroundColor = '#f5f5f5';
+                }}
+                onMouseLeave={(e) => {
+                  if (!isMigrating) e.currentTarget.style.backgroundColor = '#fff';
+                }}
+              >
+                Skip
+              </button>
+            </div>
+          </div>
+        </div>
+      )}
+
       {/* @@@ Hide sidebar on mobile */}
       {!isMobile && <LeftSidebar currentView={currentView} onViewChange={setCurrentView} />}
 
diff --git a/frontend/src/api/voiceApi.ts b/frontend/src/api/voiceApi.ts
index 77d70c4..9cec8c7 100644
--- a/frontend/src/api/voiceApi.ts
+++ b/frontend/src/api/voiceApi.ts
@@ -5,6 +5,20 @@
 // nginx proxies /ink-and-memory/api/* to backend (8765)
 const API_BASE = '/ink-and-memory';
 
+/**
+ * Get auth headers for authenticated requests
+ */
+function getAuthHeaders(): HeadersInit {
+  const token = localStorage.getItem('auth_token');
+  if (!token) {
+    throw new Error('Not authenticated');
+  }
+  return {
+    'Content-Type': 'application/json',
+    'Authorization': `Bearer ${token}`
+  };
+}
+
 /**
  * Get default voices from backend
  */
@@ -203,3 +217,212 @@ export async function generateDailyPicture(allNotes: string): Promise<{ image_ba
 
   throw new Error('Image generation failed - no image in response');
 }
+
+// ========== Authenticated Endpoints (require login) ==========
+
+/**
+ * Import localStorage data to database (one-time migration)
+ */
+export async function importLocalData(data: {
+  currentSession?: string;
+  calendarEntries?: string;
+  dailyPictures?: string;
+  voiceCustomizations?: string;
+  metaPrompt?: string;
+  stateConfig?: string;
+  selectedState?: string;
+  analysisReports?: string;
+  oldDocument?: string;
+}): Promise<{ success: boolean; imported: any }> {
+  const response = await fetch(`${API_BASE}/api/import-local-data`, {
+    method: 'POST',
+    headers: getAuthHeaders(),
+    body: JSON.stringify(data)
+  });
+
+  if (!response.ok) {
+    const error = await response.json();
+    throw new Error(error.detail || 'Import failed');
+  }
+
+  return await response.json();
+}
+
+/**
+ * Save session to database
+ */
+export async function saveSession(sessionId: string, editorState: any, name?: string): Promise<void> {
+  const response = await fetch(`${API_BASE}/api/sessions`, {
+    method: 'POST',
+    headers: getAuthHeaders(),
+    body: JSON.stringify({
+      session_id: sessionId,
+      editor_state: editorState,
+      name
+    })
+  });
+
+  if (!response.ok) {
+    const error = await response.json();
+    throw new Error(error.detail || 'Save session failed');
+  }
+}
+
+/**
+ * List all sessions
+ */
+export async function listSessions(): Promise<any[]> {
+  const response = await fetch(`${API_BASE}/api/sessions`, {
+    headers: getAuthHeaders()
+  });
+
+  if (!response.ok) {
+    const error = await response.json();
+    throw new Error(error.detail || 'List sessions failed');
+  }
+
+  const data = await response.json();
+  return data.sessions;
+}
+
+/**
+ * Get a specific session
+ */
+export async function getSession(sessionId: string): Promise<any> {
+  const response = await fetch(`${API_BASE}/api/sessions/${sessionId}`, {
+    headers: getAuthHeaders()
+  });
+
+  if (!response.ok) {
+    const error = await response.json();
+    throw new Error(error.detail || 'Get session failed');
+  }
+
+  return await response.json();
+}
+
+/**
+ * Delete a session
+ */
+export async function deleteSession(sessionId: string): Promise<void> {
+  const response = await fetch(`${API_BASE}/api/sessions/${sessionId}`, {
+    method: 'DELETE',
+    headers: getAuthHeaders()
+  });
+
+  if (!response.ok) {
+    const error = await response.json();
+    throw new Error(error.detail || 'Delete session failed');
+  }
+}
+
+/**
+ * Save daily picture
+ */
+export async function saveDailyPicture(date: string, imageBase64: string, prompt: string): Promise<void> {
+  const response = await fetch(`${API_BASE}/api/pictures`, {
+    method: 'POST',
+    headers: getAuthHeaders(),
+    body: JSON.stringify({
+      date,
+      image_base64: imageBase64,
+      prompt
+    })
+  });
+
+  if (!response.ok) {
+    const error = await response.json();
+    throw new Error(error.detail || 'Save picture failed');
+  }
+}
+
+/**
+ * Get daily pictures
+ */
+export async function getDailyPictures(limit: number = 30): Promise<any[]> {
+  const response = await fetch(`${API_BASE}/api/pictures?limit=${limit}`, {
+    headers: getAuthHeaders()
+  });
+
+  if (!response.ok) {
+    const error = await response.json();
+    throw new Error(error.detail || 'Get pictures failed');
+  }
+
+  const data = await response.json();
+  return data.pictures;
+}
+
+/**
+ * Save user preferences
+ */
+export async function savePreferences(preferences: {
+  voice_configs?: any;
+  meta_prompt?: string;
+  state_config?: any;
+  selected_state?: string;
+}): Promise<void> {
+  const response = await fetch(`${API_BASE}/api/preferences`, {
+    method: 'POST',
+    headers: getAuthHeaders(),
+    body: JSON.stringify(preferences)
+  });
+
+  if (!response.ok) {
+    const error = await response.json();
+    throw new Error(error.detail || 'Save preferences failed');
+  }
+}
+
+/**
+ * Get user preferences
+ */
+export async function getPreferences(): Promise<any> {
+  const response = await fetch(`${API_BASE}/api/preferences`, {
+    headers: getAuthHeaders()
+  });
+
+  if (!response.ok) {
+    const error = await response.json();
+    throw new Error(error.detail || 'Get preferences failed');
+  }
+
+  return await response.json();
+}
+
+/**
+ * Save analysis report
+ */
+export async function saveAnalysisReport(reportType: string, reportData: any, allNotesText?: string): Promise<void> {
+  const response = await fetch(`${API_BASE}/api/reports`, {
+    method: 'POST',
+    headers: getAuthHeaders(),
+    body: JSON.stringify({
+      report_type: reportType,
+      report_data: reportData,
+      all_notes_text: allNotesText
+    })
+  });
+
+  if (!response.ok) {
+    const error = await response.json();
+    throw new Error(error.detail || 'Save report failed');
+  }
+}
+
+/**
+ * Get analysis reports
+ */
+export async function getAnalysisReports(limit: number = 10): Promise<any[]> {
+  const response = await fetch(`${API_BASE}/api/reports?limit=${limit}`, {
+    headers: getAuthHeaders()
+  });
+
+  if (!response.ok) {
+    const error = await response.json();
+    throw new Error(error.detail || 'Get reports failed');
+  }
+
+  const data = await response.json();
+  return data.reports;
+}
diff --git a/frontend/src/components/Auth/LoginForm.tsx b/frontend/src/components/Auth/LoginForm.tsx
new file mode 100644
index 0000000..cda1a60
--- /dev/null
+++ b/frontend/src/components/Auth/LoginForm.tsx
@@ -0,0 +1,184 @@
+/**
+ * Login form component
+ */
+
+import React, { useState } from 'react';
+import { useAuth } from '../../contexts/AuthContext';
+
+interface LoginFormProps {
+  onSuccess: () => void;
+  onSwitchToRegister: () => void;
+}
+
+export default function LoginForm({ onSuccess, onSwitchToRegister }: LoginFormProps) {
+  const { login } = useAuth();
+  const [email, setEmail] = useState('');
+  const [password, setPassword] = useState('');
+  const [error, setError] = useState('');
+  const [isSubmitting, setIsSubmitting] = useState(false);
+
+  const handleSubmit = async (e: React.FormEvent) => {
+    e.preventDefault();
+    setError('');
+    setIsSubmitting(true);
+
+    try {
+      await login(email, password);
+      onSuccess();
+    } catch (err: any) {
+      setError(err.message || 'Login failed');
+    } finally {
+      setIsSubmitting(false);
+    }
+  };
+
+  return (
+    <div style={{
+      width: '100%',
+      maxWidth: '400px',
+      margin: '0 auto',
+      padding: '32px',
+      backgroundColor: '#fffef9',
+      border: '2px solid #d0c4b0',
+      borderRadius: '12px',
+      boxShadow: '0 4px 12px rgba(0,0,0,0.1)',
+      fontFamily: "'Excalifont', 'Xiaolai', 'Georgia', serif"
+    }}>
+      <h2 style={{
+        margin: '0 0 24px 0',
+        fontSize: '24px',
+        fontWeight: 600,
+        color: '#333',
+        textAlign: 'center'
+      }}>
+        Welcome Back
+      </h2>
+
+      {error && (
+        <div style={{
+          padding: '12px',
+          marginBottom: '16px',
+          backgroundColor: '#fee',
+          border: '1px solid #fcc',
+          borderRadius: '6px',
+          fontSize: '14px',
+          color: '#c33'
+        }}>
+          {error}
+        </div>
+      )}
+
+      <form onSubmit={handleSubmit}>
+        <div style={{ marginBottom: '16px' }}>
+          <label style={{
+            display: 'block',
+            marginBottom: '6px',
+            fontSize: '14px',
+            fontWeight: 500,
+            color: '#555'
+          }}>
+            Email
+          </label>
+          <input
+            type="email"
+            value={email}
+            onChange={(e) => setEmail(e.target.value)}
+            required
+            disabled={isSubmitting}
+            style={{
+              width: '100%',
+              padding: '10px 12px',
+              border: '1px solid #d0c4b0',
+              borderRadius: '6px',
+              fontSize: '15px',
+              fontFamily: "'Excalifont', 'Xiaolai', 'Georgia', serif",
+              boxSizing: 'border-box'
+            }}
+          />
+        </div>
+
+        <div style={{ marginBottom: '24px' }}>
+          <label style={{
+            display: 'block',
+            marginBottom: '6px',
+            fontSize: '14px',
+            fontWeight: 500,
+            color: '#555'
+          }}>
+            Password
+          </label>
+          <input
+            type="password"
+            value={password}
+            onChange={(e) => setPassword(e.target.value)}
+            required
+            disabled={isSubmitting}
+            style={{
+              width: '100%',
+              padding: '10px 12px',
+              border: '1px solid #d0c4b0',
+              borderRadius: '6px',
+              fontSize: '15px',
+              fontFamily: "'Excalifont', 'Xiaolai', 'Georgia', serif",
+              boxSizing: 'border-box'
+            }}
+          />
+        </div>
+
+        <button
+          type="submit"
+          disabled={isSubmitting}
+          style={{
+            width: '100%',
+            padding: '12px',
+            border: 'none',
+            borderRadius: '6px',
+            backgroundColor: isSubmitting ? '#ccc' : '#4a90e2',
+            color: 'white',
+            fontSize: '16px',
+            fontWeight: 600,
+            cursor: isSubmitting ? 'not-allowed' : 'pointer',
+            fontFamily: "'Excalifont', 'Xiaolai', 'Georgia', serif",
+            transition: 'background-color 0.2s'
+          }}
+          onMouseEnter={(e) => {
+            if (!isSubmitting) {
+              e.currentTarget.style.backgroundColor = '#357abd';
+            }
+          }}
+          onMouseLeave={(e) => {
+            if (!isSubmitting) {
+              e.currentTarget.style.backgroundColor = '#4a90e2';
+            }
+          }}
+        >
+          {isSubmitting ? 'Logging in...' : 'Login'}
+        </button>
+      </form>
+
+      <div style={{
+        marginTop: '20px',
+        textAlign: 'center',
+        fontSize: '14px',
+        color: '#666'
+      }}>
+        Don't have an account?{' '}
+        <button
+          onClick={onSwitchToRegister}
+          disabled={isSubmitting}
+          style={{
+            background: 'none',
+            border: 'none',
+            color: '#4a90e2',
+            cursor: 'pointer',
+            textDecoration: 'underline',
+            fontSize: '14px',
+            fontFamily: "'Excalifont', 'Xiaolai', 'Georgia', serif"
+          }}
+        >
+          Register
+        </button>
+      </div>
+    </div>
+  );
+}
diff --git a/frontend/src/components/Auth/RegisterForm.tsx b/frontend/src/components/Auth/RegisterForm.tsx
new file mode 100644
index 0000000..9ab3078
--- /dev/null
+++ b/frontend/src/components/Auth/RegisterForm.tsx
@@ -0,0 +1,225 @@
+/**
+ * Registration form component
+ */
+
+import React, { useState } from 'react';
+import { useAuth } from '../../contexts/AuthContext';
+
+interface RegisterFormProps {
+  onSuccess: () => void;
+  onSwitchToLogin: () => void;
+}
+
+export default function RegisterForm({ onSuccess, onSwitchToLogin }: RegisterFormProps) {
+  const { register } = useAuth();
+  const [email, setEmail] = useState('');
+  const [password, setPassword] = useState('');
+  const [displayName, setDisplayName] = useState('');
+  const [error, setError] = useState('');
+  const [isSubmitting, setIsSubmitting] = useState(false);
+
+  const handleSubmit = async (e: React.FormEvent) => {
+    e.preventDefault();
+    setError('');
+
+    if (password.length < 6) {
+      setError('Password must be at least 6 characters');
+      return;
+    }
+
+    setIsSubmitting(true);
+
+    try {
+      await register(email, password, displayName || undefined);
+      onSuccess();
+    } catch (err: any) {
+      setError(err.message || 'Registration failed');
+    } finally {
+      setIsSubmitting(false);
+    }
+  };
+
+  return (
+    <div style={{
+      width: '100%',
+      maxWidth: '400px',
+      margin: '0 auto',
+      padding: '32px',
+      backgroundColor: '#fffef9',
+      border: '2px solid #d0c4b0',
+      borderRadius: '12px',
+      boxShadow: '0 4px 12px rgba(0,0,0,0.1)',
+      fontFamily: "'Excalifont', 'Xiaolai', 'Georgia', serif"
+    }}>
+      <h2 style={{
+        margin: '0 0 24px 0',
+        fontSize: '24px',
+        fontWeight: 600,
+        color: '#333',
+        textAlign: 'center'
+      }}>
+        Create Account
+      </h2>
+
+      {error && (
+        <div style={{
+          padding: '12px',
+          marginBottom: '16px',
+          backgroundColor: '#fee',
+          border: '1px solid #fcc',
+          borderRadius: '6px',
+          fontSize: '14px',
+          color: '#c33'
+        }}>
+          {error}
+        </div>
+      )}
+
+      <form onSubmit={handleSubmit}>
+        <div style={{ marginBottom: '16px' }}>
+          <label style={{
+            display: 'block',
+            marginBottom: '6px',
+            fontSize: '14px',
+            fontWeight: 500,
+            color: '#555'
+          }}>
+            Email
+          </label>
+          <input
+            type="email"
+            value={email}
+            onChange={(e) => setEmail(e.target.value)}
+            required
+            disabled={isSubmitting}
+            style={{
+              width: '100%',
+              padding: '10px 12px',
+              border: '1px solid #d0c4b0',
+              borderRadius: '6px',
+              fontSize: '15px',
+              fontFamily: "'Excalifont', 'Xiaolai', 'Georgia', serif",
+              boxSizing: 'border-box'
+            }}
+          />
+        </div>
+
+        <div style={{ marginBottom: '16px' }}>
+          <label style={{
+            display: 'block',
+            marginBottom: '6px',
+            fontSize: '14px',
+            fontWeight: 500,
+            color: '#555'
+          }}>
+            Password
+          </label>
+          <input
+            type="password"
+            value={password}
+            onChange={(e) => setPassword(e.target.value)}
+            required
+            disabled={isSubmitting}
+            style={{
+              width: '100%',
+              padding: '10px 12px',
+              border: '1px solid #d0c4b0',
+              borderRadius: '6px',
+              fontSize: '15px',
+              fontFamily: "'Excalifont', 'Xiaolai', 'Georgia', serif",
+              boxSizing: 'border-box'
+            }}
+          />
+          <div style={{
+            marginTop: '4px',
+            fontSize: '12px',
+            color: '#888'
+          }}>
+            At least 6 characters
+          </div>
+        </div>
+
+        <div style={{ marginBottom: '24px' }}>
+          <label style={{
+            display: 'block',
+            marginBottom: '6px',
+            fontSize: '14px',
+            fontWeight: 500,
+            color: '#555'
+          }}>
+            Display Name (Optional)
+          </label>
+          <input
+            type="text"
+            value={displayName}
+            onChange={(e) => setDisplayName(e.target.value)}
+            disabled={isSubmitting}
+            style={{
+              width: '100%',
+              padding: '10px 12px',
+              border: '1px solid #d0c4b0',
+              borderRadius: '6px',
+              fontSize: '15px',
+              fontFamily: "'Excalifont', 'Xiaolai', 'Georgia', serif",
+              boxSizing: 'border-box'
+            }}
+          />
+        </div>
+
+        <button
+          type="submit"
+          disabled={isSubmitting}
+          style={{
+            width: '100%',
+            padding: '12px',
+            border: 'none',
+            borderRadius: '6px',
+            backgroundColor: isSubmitting ? '#ccc' : '#4a90e2',
+            color: 'white',
+            fontSize: '16px',
+            fontWeight: 600,
+            cursor: isSubmitting ? 'not-allowed' : 'pointer',
+            fontFamily: "'Excalifont', 'Xiaolai', 'Georgia', serif",
+            transition: 'background-color 0.2s'
+          }}
+          onMouseEnter={(e) => {
+            if (!isSubmitting) {
+              e.currentTarget.style.backgroundColor = '#357abd';
+            }
+          }}
+          onMouseLeave={(e) => {
+            if (!isSubmitting) {
+              e.currentTarget.style.backgroundColor = '#4a90e2';
+            }
+          }}
+        >
+          {isSubmitting ? 'Creating account...' : 'Register'}
+        </button>
+      </form>
+
+      <div style={{
+        marginTop: '20px',
+        textAlign: 'center',
+        fontSize: '14px',
+        color: '#666'
+      }}>
+        Already have an account?{' '}
+        <button
+          onClick={onSwitchToLogin}
+          disabled={isSubmitting}
+          style={{
+            background: 'none',
+            border: 'none',
+            color: '#4a90e2',
+            cursor: 'pointer',
+            textDecoration: 'underline',
+            fontSize: '14px',
+            fontFamily: "'Excalifont', 'Xiaolai', 'Georgia', serif"
+          }}
+        >
+          Login
+        </button>
+      </div>
+    </div>
+  );
+}
diff --git a/frontend/src/components/CollectionsView.tsx b/frontend/src/components/CollectionsView.tsx
index a2cb2c4..5425587 100644
--- a/frontend/src/components/CollectionsView.tsx
+++ b/frontend/src/components/CollectionsView.tsx
@@ -1,6 +1,7 @@
 import { useState, useEffect, useRef } from 'react';
 import type { Commentor } from '../engine/EditorEngine';
 import { findNormalizedPhrase } from '../utils/textNormalize';
+import { useAuth } from '../contexts/AuthContext';
 
 // @@@ TypeScript interfaces
 interface TimelineDay {
@@ -184,6 +185,7 @@ function getAllNotesFromSessions(): string {
 
 // @@@ Timeline page - combines pictures and starred comments by date
 function TimelinePage() {
+  const { isAuthenticated } = useAuth();
   const [starredComments, setStarredComments] = useState<Commentor[]>([]);
   const [pictures, setPictures] = useState<Array<{ date: string; base64: string; prompt: string }>>([]);
   const [generatingForDate, setGeneratingForDate] = useState<string | null>(null);
@@ -259,6 +261,12 @@ function TimelinePage() {
   }, []);
 
   const handleGenerateForDate = async (dateStr: string) => {
+    // @@@ Block image generation for guests
+    if (!isAuthenticated) {
+      alert('Please log in to generate images. Image generation requires authentication.');
+      return;
+    }
+
     setGeneratingForDate(dateStr);
 
     try {
@@ -268,7 +276,7 @@ function TimelinePage() {
         return;
       }
 
-      const { generateDailyPicture } = await import('../api/voiceApi');
+      const { generateDailyPicture, saveDailyPicture } = await import('../api/voiceApi');
       const { image_base64, prompt } = await generateDailyPicture(allNotes);
 
       const newPicture = {
@@ -277,6 +285,10 @@ function TimelinePage() {
         prompt: prompt
       };
 
+      // @@@ Save to database (requires auth)
+      const pictureDate = new Date(newPicture.date).toISOString().split('T')[0]; // YYYY-MM-DD format
+      await saveDailyPicture(pictureDate, image_base64, prompt);
+
       // @@@ Overwrite existing picture for this date instead of adding new
       const normalizedNewDate = formatDate(newPicture.date);
 
diff --git a/frontend/src/contexts/AuthContext.tsx b/frontend/src/contexts/AuthContext.tsx
new file mode 100644
index 0000000..d1b3a32
--- /dev/null
+++ b/frontend/src/contexts/AuthContext.tsx
@@ -0,0 +1,144 @@
+/**
+ * Authentication context and hooks
+ *
+ * Manages JWT token storage, user state, and auth operations
+ */
+
+import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';
+
+const API_BASE = '/ink-and-memory';
+
+interface User {
+  id: number;
+  email: string;
+  display_name?: string;
+}
+
+interface AuthContextType {
+  user: User | null;
+  token: string | null;
+  isLoading: boolean;
+  login: (email: string, password: string) => Promise<void>;
+  register: (email: string, password: string, displayName?: string) => Promise<void>;
+  logout: () => void;
+  isAuthenticated: boolean;
+}
+
+const AuthContext = createContext<AuthContextType | undefined>(undefined);
+
+export function AuthProvider({ children }: { children: ReactNode }) {
+  const [user, setUser] = useState<User | null>(null);
+  const [token, setToken] = useState<string | null>(null);
+  const [isLoading, setIsLoading] = useState(true);
+
+  // Load token from localStorage on mount
+  useEffect(() => {
+    const savedToken = localStorage.getItem('auth_token');
+    if (savedToken) {
+      // Verify token by fetching user info
+      fetch(`${API_BASE}/api/me`, {
+        headers: {
+          'Authorization': `Bearer ${savedToken}`
+        }
+      })
+        .then(res => {
+          if (!res.ok) throw new Error('Token invalid');
+          return res.json();
+        })
+        .then(userData => {
+          setUser(userData);
+          setToken(savedToken);
+        })
+        .catch(() => {
+          // Token invalid, clear it
+          localStorage.removeItem('auth_token');
+        })
+        .finally(() => {
+          setIsLoading(false);
+        });
+    } else {
+      setIsLoading(false);
+    }
+  }, []);
+
+  const login = async (email: string, password: string) => {
+    const response = await fetch(`${API_BASE}/api/login`, {
+      method: 'POST',
+      headers: {
+        'Content-Type': 'application/json'
+      },
+      body: JSON.stringify({ email, password })
+    });
+
+    if (!response.ok) {
+      const error = await response.json();
+      throw new Error(error.detail || 'Login failed');
+    }
+
+    const data = await response.json();
+    setUser(data.user);
+    setToken(data.token);
+    localStorage.setItem('auth_token', data.token);
+  };
+
+  const register = async (email: string, password: string, displayName?: string) => {
+    const response = await fetch(`${API_BASE}/api/register`, {
+      method: 'POST',
+      headers: {
+        'Content-Type': 'application/json'
+      },
+      body: JSON.stringify({
+        email,
+        password,
+        display_name: displayName
+      })
+    });
+
+    if (!response.ok) {
+      const error = await response.json();
+      throw new Error(error.detail || 'Registration failed');
+    }
+
+    const data = await response.json();
+    setUser(data.user);
+    setToken(data.token);
+    localStorage.setItem('auth_token', data.token);
+  };
+
+  const logout = () => {
+    setUser(null);
+    setToken(null);
+    localStorage.removeItem('auth_token');
+  };
+
+  return (
+    <AuthContext.Provider
+      value={{
+        user,
+        token,
+        isLoading,
+        login,
+        register,
+        logout,
+        isAuthenticated: !!user && !!token
+      }}
+    >
+      {children}
+    </AuthContext.Provider>
+  );
+}
+
+export function useAuth() {
+  const context = useContext(AuthContext);
+  if (context === undefined) {
+    throw new Error('useAuth must be used within AuthProvider');
+  }
+  return context;
+}
+
+/**
+ * Get current auth token for API calls
+ */
+export function getAuthToken(): string | null {
+  return localStorage.getItem('auth_token');
+}
diff --git a/frontend/src/main.tsx b/frontend/src/main.tsx
index bef5202..03529f4 100644
--- a/frontend/src/main.tsx
+++ b/frontend/src/main.tsx
@@ -2,9 +2,12 @@ import { StrictMode } from 'react'
 import { createRoot } from 'react-dom/client'
 import './index.css'
 import App from './App.tsx'
+import { AuthProvider } from './contexts/AuthContext'
 
 createRoot(document.getElementById('root')!).render(
   <StrictMode>
-    <App />
+    <AuthProvider>
+      <App />
+    </AuthProvider>
   </StrictMode>,
 )
