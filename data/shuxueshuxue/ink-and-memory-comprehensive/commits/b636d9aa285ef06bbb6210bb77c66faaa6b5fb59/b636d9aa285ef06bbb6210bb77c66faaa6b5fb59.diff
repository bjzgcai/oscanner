commit b636d9aa285ef06bbb6210bb77c66faaa6b5fb59
Author: lexicalmathical <lexicalmathical@gmail.com>
Date:   Tue Nov 18 22:44:10 2025 +0800

    Fix deck icon picker z-index and update button colors
    
    - Use React portal to render deck icon picker at top level, preventing clipping
    - Change button colors to warmer, lighter tones (peach, soft blue, coral)
    - Add transparent overlay for click-outside to close picker

diff --git a/frontend/src/components/DeckManager.tsx b/frontend/src/components/DeckManager.tsx
index cd77089..657a660 100644
--- a/frontend/src/components/DeckManager.tsx
+++ b/frontend/src/components/DeckManager.tsx
@@ -1,4 +1,5 @@
 import { useState, useEffect, useRef } from 'react';
+import { createPortal } from 'react-dom';
 import { useTranslation } from 'react-i18next';
 import {
   listDecks,
@@ -60,6 +61,9 @@ export default function DeckManager({ onUpdate }: Props) {
   const [editingVoice, setEditingVoice] = useState<string | null>(null);
   const [editingField, setEditingField] = useState<'name' | 'prompt' | null>(null);
   const [iconPickerOpen, setIconPickerOpen] = useState<string | null>(null); // @@@ Track which voice's icon picker is open
+  const [editingDeck, setEditingDeck] = useState<string | null>(null); // @@@ Track which deck is being edited
+  const [deckEditingField, setDeckEditingField] = useState<'name' | 'description' | null>(null); // @@@ Track which deck field
+  const [deckIconPickerOpen, setDeckIconPickerOpen] = useState<string | null>(null); // @@@ Track which deck's icon picker is open
   const [creatingDeck, setCreatingDeck] = useState(false);
   const [creatingVoice, setCreatingVoice] = useState<string | null>(null);
   const [publishWarning, setPublishWarning] = useState<string | null>(null);
@@ -149,6 +153,18 @@ export default function DeckManager({ onUpdate }: Props) {
     }
   }
 
+  async function handleUpdateDeck(deckId: string, data: Partial<Deck>) {
+    try {
+      await updateDeck(deckId, data);
+      await loadDecks(true);
+      setEditingDeck(null);
+      setDeckEditingField(null);
+      onUpdate?.();
+    } catch (err: any) {
+      alert(`Failed to update deck: ${err.message}`);
+    }
+  }
+
   async function handleDeleteDeck(deckId: string) {
     if (!confirm(t('deck.confirm.delete'))) return;
 
@@ -333,36 +349,33 @@ export default function DeckManager({ onUpdate }: Props) {
 
   return (
     <div style={{ flex: 1, display: 'flex', flexDirection: 'column', background: '#f8f0e6', overflow: 'hidden' }}>
-      {/* Fixed Header */}
-      <div style={{
-        padding: '24px 32px',
-        background: '#f8f0e6',
-        flexShrink: 0,
-        borderBottom: '2px solid #d0c4b0'
-      }}>
-        <h1 style={{
-          margin: 0,
-          fontSize: 28,
-          fontWeight: 700,
-          color: '#2c2c2c',
-          fontFamily: 'Georgia, serif',
-          letterSpacing: '-0.5px'
-        }}>
-          {t('deck.heading')}
-        </h1>
-        <p style={{
-          margin: '6px 0 0',
-          fontSize: 14,
-          color: '#666',
-          fontStyle: 'italic'
-        }}>
-          {t('deck.subheading')}
-        </p>
-      </div>
-
-      {/* Scrollable Content */}
+      {/* Scrollable Content with embedded header */}
       <div ref={scrollContainerRef} style={{ flex: 1, overflowY: 'auto', padding: '32px' }}>
         <div style={{ maxWidth: 1200, margin: '0 auto', display: 'flex', flexDirection: 'column', gap: 24 }}>
+          {/* Embedded Header */}
+          <div style={{
+            padding: '0 0 24px 0',
+            borderBottom: '2px solid #d0c4b0'
+          }}>
+            <h1 style={{
+              margin: 0,
+              fontSize: 28,
+              fontWeight: 700,
+              color: '#2c2c2c',
+              fontFamily: 'Georgia, serif',
+              letterSpacing: '-0.5px'
+            }}>
+              {t('deck.heading')}
+            </h1>
+            <p style={{
+              margin: '6px 0 0',
+              fontSize: 14,
+              color: '#666',
+              fontStyle: 'italic'
+            }}>
+              {t('deck.subheading')}
+            </p>
+          </div>
           {/* Create New Deck Button */}
           <button
             onClick={handleCreateDeck}
@@ -370,7 +383,7 @@ export default function DeckManager({ onUpdate }: Props) {
             style={{
               padding: '12px 24px',
               marginBottom: '8px',
-              background: '#4a90e2',
+              background: '#f9a875',
               color: 'white',
               border: 'none',
               borderRadius: '8px',
@@ -382,10 +395,10 @@ export default function DeckManager({ onUpdate }: Props) {
               alignSelf: 'flex-start'
             }}
             onMouseEnter={(e) => {
-              if (!creatingDeck) e.currentTarget.style.background = '#357abd';
+              if (!creatingDeck) e.currentTarget.style.background = '#f89560';
             }}
             onMouseLeave={(e) => {
-              if (!creatingDeck) e.currentTarget.style.background = '#4a90e2';
+              if (!creatingDeck) e.currentTarget.style.background = '#f9a875';
             }}
           >
             {creatingDeck ? t('deck.actions.creating') : t('deck.actions.create')}
@@ -405,6 +418,7 @@ export default function DeckManager({ onUpdate }: Props) {
           {decks.map(deck => {
             const isExpanded = expandedDecks.has(deck.id);
             const isSystem = !!deck.is_system; // @@@ Convert to boolean to prevent React from rendering "0"
+            const isDeckEditing = editingDeck === deck.id;
             const Icon = iconMap[deck.icon as keyof typeof iconMap] || FaBrain;
             const colorHex = COLORS[deck.color as keyof typeof COLORS]?.hex || '#4a90e2';
             const voiceCount = deck.voice_count || deck.voices?.length || 0;
@@ -424,73 +438,276 @@ export default function DeckManager({ onUpdate }: Props) {
               >
                 {/* Deck Header */}
                 <div
-                  onClick={() => toggleDeck(deck.id)}
                   style={{
                     padding: 20,
                     background: isSystem ? '#f9f9f9' : '#fafafa',
-                    cursor: 'pointer',
                     display: 'flex',
                     alignItems: 'center',
                     gap: 16,
                     transition: 'background 0.2s'
                   }}
-                  onMouseEnter={(e) => {
-                    e.currentTarget.style.background = isSystem ? '#f0f0f0' : '#f5f5f5';
-                  }}
-                  onMouseLeave={(e) => {
-                    e.currentTarget.style.background = isSystem ? '#f9f9f9' : '#fafafa';
-                  }}
                 >
                   {/* Expand/Collapse Icon */}
-                  <div style={{ fontSize: 20, color: '#666' }}>
+                  <div
+                    onClick={() => toggleDeck(deck.id)}
+                    style={{ fontSize: 20, color: '#666', cursor: 'pointer' }}
+                  >
                     {isExpanded ? <FaChevronDown /> : <FaChevronRight />}
                   </div>
 
-                  {/* Deck Icon */}
-                  <div style={{
-                    width: 56,
-                    height: 56,
-                    borderRadius: 28,
-                    background: `linear-gradient(135deg, ${colorHex} 0%, ${colorHex}cc 100%)`,
-                    display: 'flex',
-                    alignItems: 'center',
-                    justifyContent: 'center',
-                    color: '#fff',
-                    flexShrink: 0,
-                    boxShadow: `0 3px 8px ${colorHex}40`
-                  }}>
-                    <Icon size={28} />
+                  {/* Deck Icon with picker */}
+                  <div style={{ position: 'relative' }}>
+                    <div
+                      data-deck-icon={deck.id}
+                      onClick={(e) => {
+                        e.stopPropagation();
+                        if (!isSystem) {
+                          setDeckIconPickerOpen(deckIconPickerOpen === deck.id ? null : deck.id);
+                        }
+                      }}
+                      style={{
+                        width: 56,
+                        height: 56,
+                        borderRadius: 28,
+                        background: `linear-gradient(135deg, ${colorHex} 0%, ${colorHex}cc 100%)`,
+                        display: 'flex',
+                        alignItems: 'center',
+                        justifyContent: 'center',
+                        color: '#fff',
+                        flexShrink: 0,
+                        boxShadow: `0 3px 8px ${colorHex}40`,
+                        cursor: isSystem ? 'default' : 'pointer',
+                        transition: 'transform 0.2s, box-shadow 0.2s'
+                      }}
+                      onMouseEnter={(e) => {
+                        if (!isSystem) {
+                          e.currentTarget.style.transform = 'scale(1.1)';
+                          e.currentTarget.style.boxShadow = `0 6px 16px ${colorHex}60`;
+                        }
+                      }}
+                      onMouseLeave={(e) => {
+                        if (!isSystem) {
+                          e.currentTarget.style.transform = 'scale(1)';
+                          e.currentTarget.style.boxShadow = `0 3px 8px ${colorHex}40`;
+                        }
+                      }}
+                      title={isSystem ? '' : 'Click to change icon'}
+                    >
+                      <Icon size={28} />
+                    </div>
+
+                    {/* Icon Picker Dropdown for Deck - Rendered at top level using portal */}
+                    {deckIconPickerOpen === deck.id && (() => {
+                      const iconBadge = document.querySelector(`[data-deck-icon="${deck.id}"]`) as HTMLElement;
+                      if (!iconBadge) return null;
+                      const rect = iconBadge.getBoundingClientRect();
+
+                      return createPortal(
+                        <>
+                          {/* Transparent overlay to capture clicks outside */}
+                          <div
+                            onClick={() => setDeckIconPickerOpen(null)}
+                            style={{
+                              position: 'fixed',
+                              top: 0,
+                              left: 0,
+                              right: 0,
+                              bottom: 0,
+                              zIndex: 9999
+                            }}
+                          />
+                          {/* Icon picker dropdown */}
+                          <div
+                            style={{
+                              position: 'fixed',
+                              top: rect.bottom + 4,
+                              left: rect.left,
+                              background: '#fff',
+                              border: '2px solid #4a90e2',
+                              borderRadius: 8,
+                              padding: 8,
+                              boxShadow: '0 4px 16px rgba(0,0,0,0.2)',
+                              zIndex: 10000,
+                              display: 'grid',
+                              gridTemplateColumns: 'repeat(4, 1fr)',
+                              gap: 4,
+                              minWidth: 180
+                            }}
+                          >
+                            {Object.entries(iconMap).map(([iconName, IconComponent]) => {
+                              const isSelected = deck.icon === iconName;
+                              return (
+                                <div
+                                  key={iconName}
+                                  onClick={(e) => {
+                                    e.stopPropagation();
+                                    handleUpdateDeck(deck.id, { icon: iconName });
+                                    setDeckIconPickerOpen(null);
+                                  }}
+                                  style={{
+                                    width: 40,
+                                    height: 40,
+                                    borderRadius: 8,
+                                    background: isSelected ? colorHex : '#f0f0f0',
+                                    display: 'flex',
+                                    alignItems: 'center',
+                                    justifyContent: 'center',
+                                    color: isSelected ? '#fff' : '#666',
+                                    cursor: 'pointer',
+                                    transition: 'all 0.2s'
+                                  }}
+                                  onMouseEnter={(e) => {
+                                    if (!isSelected) {
+                                      e.currentTarget.style.background = '#e0e0e0';
+                                      e.currentTarget.style.transform = 'scale(1.1)';
+                                    }
+                                  }}
+                                  onMouseLeave={(e) => {
+                                    if (!isSelected) {
+                                      e.currentTarget.style.background = '#f0f0f0';
+                                      e.currentTarget.style.transform = 'scale(1)';
+                                    }
+                                  }}
+                                  title={iconName}
+                                >
+                                  <IconComponent size={20} />
+                                </div>
+                              );
+                            })}
+                          </div>
+                        </>,
+                        document.body
+                      );
+                    })()}
                   </div>
 
-                  {/* Deck Info */}
+                  {/* Deck Info with inline editing */}
                   <div style={{ flex: 1, minWidth: 0 }}>
-                    <div style={{
-                      fontSize: 20,
-                      fontWeight: 700,
-                      color: '#2c2c2c',
-                      marginBottom: 4
-                    }}>
-                      {deck.name}
-                      {isSystem && (
-                        <span style={{
-                          marginLeft: 12,
-                          fontSize: 12,
-                          fontWeight: 500,
-                          color: '#888',
-                          background: '#e0e0e0',
-                          padding: '2px 8px',
-                          borderRadius: 4
-                        }}>
-                          {t('deck.labels.system')}
-                        </span>
-                      )}
-                    </div>
-                    <div style={{
-                      fontSize: 14,
-                      color: '#666'
-                    }}>
-                      {deck.description || t('deck.labels.noDescription')}
-                    </div>
+                    {/* Deck Name */}
+                    {!isDeckEditing || deckEditingField !== 'name' ? (
+                      <div
+                        onClick={(e) => {
+                          e.stopPropagation();
+                          if (!isSystem) {
+                            setEditingDeck(deck.id);
+                            setDeckEditingField('name');
+                          }
+                        }}
+                        style={{
+                          fontSize: 20,
+                          fontWeight: 700,
+                          color: '#2c2c2c',
+                          marginBottom: 4,
+                          cursor: isSystem ? 'default' : 'pointer',
+                          transition: 'opacity 0.2s'
+                        }}
+                        onMouseEnter={(e) => {
+                          if (!isSystem) e.currentTarget.style.opacity = '0.7';
+                        }}
+                        onMouseLeave={(e) => {
+                          if (!isSystem) e.currentTarget.style.opacity = '1';
+                        }}
+                      >
+                        {deck.name}
+                        {isSystem && (
+                          <span style={{
+                            marginLeft: 12,
+                            fontSize: 12,
+                            fontWeight: 500,
+                            color: '#888',
+                            background: '#e0e0e0',
+                            padding: '2px 8px',
+                            borderRadius: 4
+                          }}>
+                            {t('deck.labels.system')}
+                          </span>
+                        )}
+                      </div>
+                    ) : (
+                      <input
+                        autoFocus
+                        defaultValue={deck.name}
+                        onClick={(e) => e.stopPropagation()}
+                        onBlur={(e) => {
+                          handleUpdateDeck(deck.id, { name: e.target.value });
+                        }}
+                        onKeyDown={(e) => {
+                          if (e.key === 'Enter') {
+                            e.currentTarget.blur();
+                          } else if (e.key === 'Escape') {
+                            setEditingDeck(null);
+                            setDeckEditingField(null);
+                          }
+                        }}
+                        style={{
+                          width: '100%',
+                          fontSize: 20,
+                          fontWeight: 700,
+                          color: '#2c2c2c',
+                          padding: '4px 8px',
+                          border: '2px solid #4a90e2',
+                          borderRadius: 4,
+                          background: '#f0f8ff',
+                          marginBottom: 4
+                        }}
+                      />
+                    )}
+
+                    {/* Deck Description */}
+                    {!isDeckEditing || deckEditingField !== 'description' ? (
+                      <div
+                        onClick={(e) => {
+                          e.stopPropagation();
+                          if (!isSystem) {
+                            setEditingDeck(deck.id);
+                            setDeckEditingField('description');
+                          }
+                        }}
+                        style={{
+                          fontSize: 14,
+                          color: '#666',
+                          cursor: isSystem ? 'default' : 'pointer',
+                          transition: 'opacity 0.2s'
+                        }}
+                        onMouseEnter={(e) => {
+                          if (!isSystem) e.currentTarget.style.opacity = '0.7';
+                        }}
+                        onMouseLeave={(e) => {
+                          if (!isSystem) e.currentTarget.style.opacity = '1';
+                        }}
+                      >
+                        {deck.description || t('deck.labels.noDescription')}
+                      </div>
+                    ) : (
+                      <textarea
+                        autoFocus
+                        defaultValue={deck.description || ''}
+                        onClick={(e) => e.stopPropagation()}
+                        onBlur={(e) => {
+                          handleUpdateDeck(deck.id, { description: e.target.value });
+                        }}
+                        onKeyDown={(e) => {
+                          if (e.key === 'Escape') {
+                            setEditingDeck(null);
+                            setDeckEditingField(null);
+                          }
+                        }}
+                        style={{
+                          width: '100%',
+                          minHeight: '60px',
+                          fontSize: 14,
+                          color: '#666',
+                          padding: '6px 8px',
+                          border: '2px solid #4a90e2',
+                          borderRadius: 4,
+                          background: '#f0f8ff',
+                          fontFamily: 'inherit',
+                          resize: 'vertical',
+                          boxSizing: 'border-box'
+                        }}
+                      />
+                    )}
+
                     <div style={{
                       fontSize: 12,
                       color: '#999',
@@ -563,7 +780,7 @@ export default function DeckManager({ onUpdate }: Props) {
                             onClick={() => handleSyncDeck(deck.id)}
                             style={{
                               padding: '8px 16px',
-                              background: '#3498db',
+                              background: '#81b7d2',
                               color: '#fff',
                               border: 'none',
                               borderRadius: 6,
@@ -574,7 +791,7 @@ export default function DeckManager({ onUpdate }: Props) {
                             }}
                             onMouseEnter={(e) => {
                               e.currentTarget.style.transform = 'translateY(-1px)';
-                              e.currentTarget.style.boxShadow = '0 4px 12px rgba(52, 152, 219, 0.4)';
+                              e.currentTarget.style.boxShadow = '0 4px 12px rgba(129, 183, 210, 0.4)';
                             }}
                             onMouseLeave={(e) => {
                               e.currentTarget.style.transform = 'translateY(0)';
@@ -589,7 +806,7 @@ export default function DeckManager({ onUpdate }: Props) {
                           onClick={() => handlePublishClick(deck)}
                           style={{
                             padding: '8px 16px',
-                            background: deck.published ? '#e74c3c' : '#9b59b6',
+                            background: deck.published ? '#f39c7a' : '#b47ed7',
                             color: '#fff',
                             border: 'none',
                             borderRadius: 6,
@@ -600,7 +817,7 @@ export default function DeckManager({ onUpdate }: Props) {
                           }}
                           onMouseEnter={(e) => {
                             e.currentTarget.style.transform = 'translateY(-1px)';
-                            const color = deck.published ? 'rgba(231, 76, 60, 0.4)' : 'rgba(155, 89, 182, 0.4)';
+                            const color = deck.published ? 'rgba(243, 156, 122, 0.4)' : 'rgba(180, 126, 215, 0.4)';
                             e.currentTarget.style.boxShadow = `0 4px 12px ${color}`;
                           }}
                           onMouseLeave={(e) => {
@@ -614,7 +831,7 @@ export default function DeckManager({ onUpdate }: Props) {
                           onClick={() => handleDeleteDeck(deck.id)}
                           style={{
                             padding: '8px 16px',
-                            background: '#e74c3c',
+                            background: '#e8956c',
                             color: '#fff',
                             border: 'none',
                             borderRadius: 6,
@@ -625,7 +842,7 @@ export default function DeckManager({ onUpdate }: Props) {
                           }}
                           onMouseEnter={(e) => {
                             e.currentTarget.style.transform = 'translateY(-1px)';
-                            e.currentTarget.style.boxShadow = '0 4px 12px rgba(231, 76, 60, 0.4)';
+                            e.currentTarget.style.boxShadow = '0 4px 12px rgba(232, 149, 108, 0.4)';
                           }}
                           onMouseLeave={(e) => {
                             e.currentTarget.style.transform = 'translateY(0)';
