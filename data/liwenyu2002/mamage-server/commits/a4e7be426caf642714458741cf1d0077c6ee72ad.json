{
  "cached_at": "2025-12-20T14:31:18.040167",
  "commit_sha": "a4e7be426caf642714458741cf1d0077c6ee72ad",
  "repo": "liwenyu2002/mamage-server",
  "data": {
    "sha": "a4e7be426caf642714458741cf1d0077c6ee72ad",
    "node_id": "C_kwDOQYJTNNoAKGE0ZTdiZTQyNmNhZjY0MjcxNDQ1ODc0MWNmMWQwMDc3YzZlZTcyYWQ",
    "commit": {
      "author": {
        "name": "HIT_LWY",
        "email": "75512499+liwenyu2002@users.noreply.github.com",
        "date": "2025-12-08T12:03:24Z"
      },
      "committer": {
        "name": "GitHub",
        "email": "noreply@github.com",
        "date": "2025-12-08T12:03:24Z"
      },
      "message": "Add GitHub Actions workflow for deployment",
      "tree": {
        "sha": "c430c59790c4168602b0206e4b7b33466d8510ba",
        "url": "https://api.github.com/repos/liwenyu2002/mamage-server/git/trees/c430c59790c4168602b0206e4b7b33466d8510ba"
      },
      "url": "https://api.github.com/repos/liwenyu2002/mamage-server/git/commits/a4e7be426caf642714458741cf1d0077c6ee72ad",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsFcBAABCAAQBQJpNr6MCRC1aQ7uu5UhlAAAxWQQAGcv2uDsGqkDSw1jGNjXvTlD\nqAtQGbu256EeCmLGqjs154W+hiylsYhGeQFTh/4dVgM5sQqPMuEpu0qbBVhAFK4X\nP3VwEqdULlLumuk404qahIoh0l5QXssKqza35Eu1CEQx0hlwfqTXTE7XaddcUte4\nAWGhkyBsktrzgwMXOBtvwgj6sDsPNi2iOEZKZpc6jVaUaOevI7axcBHpr5cSF4pB\nKaIiVECiBeZw0JCxdF/0sD9AEslK7D9X0uG8pV/seRi2D84zKyTcfNUXZ6UTN/c7\nTxG0hCBzD9s5d4AAC2eNQPNOOAHmfKzNIshMxmTY2mtB7jdOVIF/BeqfhX8Bi4AX\n8JL10oy2gbcxUoBOQrrq3DwqIeiuQ1Rjk3VdMio266N6/O7ykpSBHcw4dRQgKZh4\nz+GEZ0c9FGyJzZaL55r+R7D04yrfTi94fShvpHJFgKoMxgqzVDyCsaIhEbdQbp/+\nvBUzgrsvY6K6Sx2pebGd+QVpBf7xZJYTH5CScruppNtx1zuucjkV7SqZNak5HDdn\nx3iksFMr3ZaL5tdxz2QEe1QSwphBP6F1fqxfwWpD0qfUrxarhhLs4dQRIMhhdg3k\nb17r2oUx1VvDqXSnnsEas8xYgoJUldnAYP/rkAF/e5xQ0Gp7r2jA2rrf7nC1ybn7\ngOfE02QNt+zCtNjq14gF\n=HFz2\n-----END PGP SIGNATURE-----\n",
        "payload": "tree c430c59790c4168602b0206e4b7b33466d8510ba\nparent e710d01366a5a628f8553154fe8f2781f0217948\nauthor HIT_LWY <75512499+liwenyu2002@users.noreply.github.com> 1765195404 +0800\ncommitter GitHub <noreply@github.com> 1765195404 +0800\n\nAdd GitHub Actions workflow for deployment",
        "verified_at": "2025-12-08T12:03:24Z"
      }
    },
    "url": "https://api.github.com/repos/liwenyu2002/mamage-server/commits/a4e7be426caf642714458741cf1d0077c6ee72ad",
    "html_url": "https://github.com/liwenyu2002/mamage-server/commit/a4e7be426caf642714458741cf1d0077c6ee72ad",
    "comments_url": "https://api.github.com/repos/liwenyu2002/mamage-server/commits/a4e7be426caf642714458741cf1d0077c6ee72ad/comments",
    "author": {
      "login": "liwenyu2002",
      "id": 75512499,
      "node_id": "MDQ6VXNlcjc1NTEyNDk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/75512499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/liwenyu2002",
      "html_url": "https://github.com/liwenyu2002",
      "followers_url": "https://api.github.com/users/liwenyu2002/followers",
      "following_url": "https://api.github.com/users/liwenyu2002/following{/other_user}",
      "gists_url": "https://api.github.com/users/liwenyu2002/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/liwenyu2002/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/liwenyu2002/subscriptions",
      "organizations_url": "https://api.github.com/users/liwenyu2002/orgs",
      "repos_url": "https://api.github.com/users/liwenyu2002/repos",
      "events_url": "https://api.github.com/users/liwenyu2002/events{/privacy}",
      "received_events_url": "https://api.github.com/users/liwenyu2002/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "committer": {
      "login": "web-flow",
      "id": 19864447,
      "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
      "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/web-flow",
      "html_url": "https://github.com/web-flow",
      "followers_url": "https://api.github.com/users/web-flow/followers",
      "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
      "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
      "organizations_url": "https://api.github.com/users/web-flow/orgs",
      "repos_url": "https://api.github.com/users/web-flow/repos",
      "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/web-flow/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e710d01366a5a628f8553154fe8f2781f0217948",
        "url": "https://api.github.com/repos/liwenyu2002/mamage-server/commits/e710d01366a5a628f8553154fe8f2781f0217948",
        "html_url": "https://github.com/liwenyu2002/mamage-server/commit/e710d01366a5a628f8553154fe8f2781f0217948"
      }
    ],
    "stats": {
      "total": 62,
      "additions": 62,
      "deletions": 0
    },
    "files": [
      {
        "sha": "91e75297b1d34e615a58f8f6c1e196845e9fd94a",
        "filename": ".github/workflows/deploy.yml",
        "status": "added",
        "additions": 62,
        "deletions": 0,
        "changes": 62,
        "blob_url": "https://github.com/liwenyu2002/mamage-server/blob/a4e7be426caf642714458741cf1d0077c6ee72ad/.github%2Fworkflows%2Fdeploy.yml",
        "raw_url": "https://github.com/liwenyu2002/mamage-server/raw/a4e7be426caf642714458741cf1d0077c6ee72ad/.github%2Fworkflows%2Fdeploy.yml",
        "contents_url": "https://api.github.com/repos/liwenyu2002/mamage-server/contents/.github%2Fworkflows%2Fdeploy.yml?ref=a4e7be426caf642714458741cf1d0077c6ee72ad",
        "patch": "@@ -0,0 +1,62 @@\n+name: Deploy mamage-server\n+\n+on:\n+  push:\n+    branches: [ \"main\" ]        # 推到 main 时自动部署\n+\n+jobs:\n+  build-and-deploy:\n+    runs-on: ubuntu-latest\n+\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v4\n+\n+      - name: Use Node.js 20\n+        uses: actions/setup-node@v4\n+        with:\n+          node-version: \"20\"\n+\n+      # 可选：CI 里先跑一次安装，提前发现依赖问题\n+      - name: Install dependencies\n+        run: npm ci || npm install\n+\n+      # 可选：有测试就跑，没有就略过\n+      - name: Run tests (optional)\n+        run: |\n+          if npm test ; then\n+            echo \"tests ok\"\n+          else\n+            echo \"no tests or tests failed, continue anyway\"\n+          fi\n+\n+      # 配置 SSH，使用你在仓库里配置的 DEPLOY_SSH_KEY\n+      - name: Setup SSH agent\n+        uses: webfactory/ssh-agent@v0.9.0\n+        with:\n+          ssh-private-key: ${{ secrets.DEPLOY_SSH_KEY }}\n+\n+      # 部署到服务器\n+      - name: Deploy to server via SSH\n+        run: |\n+          ssh -o StrictHostKeyChecking=no -p ${{ secrets.DEPLOY_PORT }} \\\n+            ${{ secrets.DEPLOY_USER }}@${{ secrets.DEPLOY_HOST }} << 'EOF'\n+          set -e\n+\n+          # 后端项目所在目录\n+          cd /home/liwy/mamage-server\n+\n+          # 拉最新代码\n+          git fetch origin main\n+          git reset --hard origin/main\n+\n+          # 安装依赖（生产环境省略 devDependencies）\n+          npm ci --omit=dev || npm install --omit=dev\n+\n+          # 重启 pm2 进程，第一次没有的话就 start\n+          pm2 restart mamage-server || pm2 start app.js --name mamage-server\n+\n+          # 保存 pm2 进程列表，保证重启后还能自启（如果你配置了 pm2 startup）\n+          pm2 save\n+\n+          EOF"
      }
    ]
  }
}