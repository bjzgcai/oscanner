{
  "cached_at": "2025-12-20T14:34:15.864280",
  "commit_sha": "b549253116f9c2205d594b9a48fd8c4c6e7d090d",
  "repo": "malabz/Cax",
  "data": {
    "sha": "b549253116f9c2205d594b9a48fd8c4c6e7d090d",
    "node_id": "C_kwDOPt61otoAKGI1NDkyNTMxMTZmOWMyMjA1ZDU5NGI5YTQ4ZmQ4YzRjNmU3ZDA5MGQ",
    "commit": {
      "author": {
        "name": "ripple-jmx",
        "email": "mingxuanjiang@hust.edu.cn",
        "date": "2025-11-08T06:58:59Z"
      },
      "committer": {
        "name": "ripple-jmx",
        "email": "mingxuanjiang@hust.edu.cn",
        "date": "2025-11-08T06:58:59Z"
      },
      "message": "feat(prompt): make prepare wizard layout responsive",
      "tree": {
        "sha": "f2b3183518aaf538957d996cbc6831d64c70ea61",
        "url": "https://api.github.com/repos/malabz/Cax/git/trees/f2b3183518aaf538957d996cbc6831d64c70ea61"
      },
      "url": "https://api.github.com/repos/malabz/Cax/git/commits/b549253116f9c2205d594b9a48fd8c4c6e7d090d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null,
        "verified_at": null
      }
    },
    "url": "https://api.github.com/repos/malabz/Cax/commits/b549253116f9c2205d594b9a48fd8c4c6e7d090d",
    "html_url": "https://github.com/malabz/Cax/commit/b549253116f9c2205d594b9a48fd8c4c6e7d090d",
    "comments_url": "https://api.github.com/repos/malabz/Cax/commits/b549253116f9c2205d594b9a48fd8c4c6e7d090d/comments",
    "author": {
      "login": "ripple-jmx",
      "id": 55392975,
      "node_id": "MDQ6VXNlcjU1MzkyOTc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/55392975?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ripple-jmx",
      "html_url": "https://github.com/ripple-jmx",
      "followers_url": "https://api.github.com/users/ripple-jmx/followers",
      "following_url": "https://api.github.com/users/ripple-jmx/following{/other_user}",
      "gists_url": "https://api.github.com/users/ripple-jmx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ripple-jmx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ripple-jmx/subscriptions",
      "organizations_url": "https://api.github.com/users/ripple-jmx/orgs",
      "repos_url": "https://api.github.com/users/ripple-jmx/repos",
      "events_url": "https://api.github.com/users/ripple-jmx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ripple-jmx/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "committer": {
      "login": "ripple-jmx",
      "id": 55392975,
      "node_id": "MDQ6VXNlcjU1MzkyOTc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/55392975?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ripple-jmx",
      "html_url": "https://github.com/ripple-jmx",
      "followers_url": "https://api.github.com/users/ripple-jmx/followers",
      "following_url": "https://api.github.com/users/ripple-jmx/following{/other_user}",
      "gists_url": "https://api.github.com/users/ripple-jmx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ripple-jmx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ripple-jmx/subscriptions",
      "organizations_url": "https://api.github.com/users/ripple-jmx/orgs",
      "repos_url": "https://api.github.com/users/ripple-jmx/repos",
      "events_url": "https://api.github.com/users/ripple-jmx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ripple-jmx/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "afb3e0c2c1d0f9976e4f01c6379e0fc92705ff89",
        "url": "https://api.github.com/repos/malabz/Cax/commits/afb3e0c2c1d0f9976e4f01c6379e0fc92705ff89",
        "html_url": "https://github.com/malabz/Cax/commit/afb3e0c2c1d0f9976e4f01c6379e0fc92705ff89"
      }
    ],
    "stats": {
      "total": 101,
      "additions": 73,
      "deletions": 28
    },
    "files": [
      {
        "sha": "5c3002e8370604e0ecd7da09621f578fa8ce46b1",
        "filename": "cax/command_prompt.py",
        "status": "modified",
        "additions": 73,
        "deletions": 28,
        "changes": 101,
        "blob_url": "https://github.com/malabz/Cax/blob/b549253116f9c2205d594b9a48fd8c4c6e7d090d/cax%2Fcommand_prompt.py",
        "raw_url": "https://github.com/malabz/Cax/raw/b549253116f9c2205d594b9a48fd8c4c6e7d090d/cax%2Fcommand_prompt.py",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/cax%2Fcommand_prompt.py?ref=b549253116f9c2205d594b9a48fd8c4c6e7d090d",
        "patch": "@@ -9,10 +9,11 @@\n \n from textual.app import App, ComposeResult\n from textual.binding import Binding\n-from textual.containers import Container\n+from textual.containers import Container, VerticalScroll\n+from textual.events import Resize\n+from textual.geometry import Size\n from textual.screen import Screen\n from textual.widgets import Button, Footer, Header, Input, ListItem, ListView, Static\n-from textual.scroll_view import ScrollView\n \n from rich.console import Group\n from rich.text import Text\n@@ -49,40 +50,45 @@ def __init__(self, defaults: dict[str, str] | None = None) -> None:\n         self._status: Static | None = None\n         self._fields: dict[str, Input] = {}\n         self._defaults = defaults or {}\n+        self._instructions: Static | None = None\n+        self._is_compact: bool | None = None\n \n     def compose(self) -> ComposeResult:\n         yield Header(show_clock=True)\n         with Container(id=\"wizard-layout\"):\n-            scroll = ScrollView(id=\"wizard-scroll\", can_focus=False, can_focus_children=True)\n-            scroll.show_horizontal_scrollbar = False\n-            with scroll:\n-                instructions = Text.from_markup(\n-                    \"[bold cyan]Fill in the fields below to build a cactus-prepare command.[/]\\n\"\n-                    \"Fields left empty won't be added to the command. Click the buttons below when you're done.\"\n-                )\n-                yield Static(instructions, id=\"wizard-instructions\")\n-                for field_id, label, placeholder in self.FIELD_DEFINITIONS:\n-                    value = self._defaults.get(field_id, \"\")\n-                    input_widget = Input(\n-                        value=value,\n-                        placeholder=placeholder,\n-                        id=f\"wizard-{field_id}\",\n-                    )\n-                    self._fields[field_id] = input_widget\n-                    yield Static(label, classes=\"wizard-label\")\n-                    yield input_widget\n-            with Container(id=\"wizard-actions\"):\n-                yield Button(\"Generate command\", id=\"submit\", variant=\"success\")\n-                yield Button(\"Cancel\", id=\"cancel\")\n-            status = Static(\"\", id=\"wizard-status\")\n-            self._status = status\n-            yield status\n+            with Container(id=\"wizard-body\"):\n+                with VerticalScroll(id=\"wizard-scroll\", can_focus=True, can_focus_children=True) as scroll:\n+                    scroll.show_horizontal_scrollbar = False\n+                    instructions = Static(self._instructions_text(False), id=\"wizard-instructions\")\n+                    self._instructions = instructions\n+                    yield instructions\n+                    for field_id, label, placeholder in self.FIELD_DEFINITIONS:\n+                        value = self._defaults.get(field_id, \"\")\n+                        input_widget = Input(\n+                            value=value,\n+                            placeholder=placeholder,\n+                            id=f\"wizard-{field_id}\",\n+                        )\n+                        self._fields[field_id] = input_widget\n+                        yield Static(label, classes=\"wizard-label\")\n+                        yield input_widget\n+            with Container(id=\"wizard-footer\"):\n+                with Container(id=\"wizard-actions\"):\n+                    yield Button(\"Generate command\", id=\"submit\", variant=\"success\", flat=True)\n+                    yield Button(\"Cancel\", id=\"cancel\", flat=True)\n+                status = Static(\"\", id=\"wizard-status\")\n+                self._status = status\n+                yield status\n         yield Footer()\n \n     def on_mount(self) -> None:  # type: ignore[override]\n         spec_input = self._fields.get(\"spec\")\n         if spec_input:\n             spec_input.focus()\n+        self._apply_layout_mode(self.size)\n+\n+    def on_resize(self, event: Resize) -> None:  # type: ignore[override]\n+        self._apply_layout_mode(event.size)\n \n     def action_cancel(self) -> None:\n         self.dismiss(None)\n@@ -133,6 +139,25 @@ def _update_status(self, message: str) -> None:\n         if self._status:\n             self._status.update(message)\n \n+    def _instructions_text(self, compact: bool) -> Text:\n+        if compact:\n+            return Text.from_markup(\"[bold cyan]Fill the fields below; blank entries are ignored.[/]\")\n+        return Text.from_markup(\n+            \"[bold cyan]Provide the cactus-prepare arguments in each field.[/]\\n\"\n+            \"Leave a field blank to skip it, then use the buttons below to confirm.\"\n+        )\n+\n+    def _apply_layout_mode(self, size: Size | None) -> None:\n+        if size is None:\n+            size = self.size\n+        compact = size.width < 96 or size.height < 28\n+        stacked_actions = size.width < 72\n+        if self._instructions and compact != self._is_compact:\n+            self._instructions.update(self._instructions_text(compact))\n+        self._is_compact = compact\n+        self.set_class(compact, \"compact\")\n+        self.set_class(stacked_actions, \"stacked-actions\")\n+\n \n class TemplateSelector(Screen[templates.Template | None]):\n     \"\"\"Simple screen that lists templates and returns the chosen one.\"\"\"\n@@ -293,21 +318,41 @@ class PrepareCommandPrompt(App[PromptResult]):\n     /* Wizard screen */\n     #wizard-layout {\n         layout: vertical;\n-        height: 1fr;\n         padding: 1 2;\n         min-height: 0;\n+        width: 1fr;\n+        height: 1fr;\n+    }\n+    #wizard-body {\n+        layout: vertical;\n+        min-height: 0;\n+        width: 1fr;\n+        height: 1fr;\n     }\n     #wizard-scroll {\n-        height: 1fr;\n+        layout: vertical;\n         padding: 0 1;\n         min-height: 0;\n+        width: 1fr;\n+        height: 1fr;\n+        overflow-y: auto;\n     }\n     .wizard-label { padding-top: 1; }\n     .wizard-label:first-of-type { padding-top: 0; }\n+    #wizard-footer { layout: vertical; padding-top: 1; height: auto; min-height: 0; max-height: 7; }\n     #wizard-actions { layout: horizontal; padding: 1 0; }\n     #wizard-actions Button { margin-right: 1; }\n     #wizard-actions Button:last-child { margin-right: 0; }\n     #wizard-status { padding: 0 0 1 0; }\n+    .compact #wizard-layout { padding: 1 1; }\n+    .compact #wizard-instructions { padding-bottom: 0; }\n+    .stacked-actions #wizard-actions { layout: vertical; }\n+    .stacked-actions #wizard-actions Button {\n+        margin-right: 0;\n+        margin-bottom: 1;\n+        width: 1fr;\n+    }\n+    .stacked-actions #wizard-actions Button:last-child { margin-bottom: 0; }\n \n     /* Template selection */\n     #template-layout { layout: vertical; height: 1fr; padding: 1 2; min-height: 0; }"
      }
    ]
  }
}