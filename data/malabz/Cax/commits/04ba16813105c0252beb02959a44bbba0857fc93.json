{
  "cached_at": "2025-12-20T14:33:31.102438",
  "commit_sha": "04ba16813105c0252beb02959a44bbba0857fc93",
  "repo": "malabz/Cax",
  "data": {
    "sha": "04ba16813105c0252beb02959a44bbba0857fc93",
    "node_id": "C_kwDOPt61otoAKDA0YmExNjgxMzEwNWMwMjUyYmViMDI5NTlhNDRiYmJhMDg1N2ZjOTM",
    "commit": {
      "author": {
        "name": "LoadStar822",
        "email": "992247533@qq.com",
        "date": "2025-11-07T08:30:48Z"
      },
      "committer": {
        "name": "LoadStar822",
        "email": "992247533@qq.com",
        "date": "2025-11-07T08:30:48Z"
      },
      "message": "feat: improve cactus-prepare UX and templates",
      "tree": {
        "sha": "45a088104f99dbaafbdda394a5237beef546da43",
        "url": "https://api.github.com/repos/malabz/Cax/git/trees/45a088104f99dbaafbdda394a5237beef546da43"
      },
      "url": "https://api.github.com/repos/malabz/Cax/git/commits/04ba16813105c0252beb02959a44bbba0857fc93",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null,
        "verified_at": null
      }
    },
    "url": "https://api.github.com/repos/malabz/Cax/commits/04ba16813105c0252beb02959a44bbba0857fc93",
    "html_url": "https://github.com/malabz/Cax/commit/04ba16813105c0252beb02959a44bbba0857fc93",
    "comments_url": "https://api.github.com/repos/malabz/Cax/commits/04ba16813105c0252beb02959a44bbba0857fc93/comments",
    "author": {
      "login": "LoadStar822",
      "id": 56856603,
      "node_id": "MDQ6VXNlcjU2ODU2NjAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/56856603?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LoadStar822",
      "html_url": "https://github.com/LoadStar822",
      "followers_url": "https://api.github.com/users/LoadStar822/followers",
      "following_url": "https://api.github.com/users/LoadStar822/following{/other_user}",
      "gists_url": "https://api.github.com/users/LoadStar822/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LoadStar822/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LoadStar822/subscriptions",
      "organizations_url": "https://api.github.com/users/LoadStar822/orgs",
      "repos_url": "https://api.github.com/users/LoadStar822/repos",
      "events_url": "https://api.github.com/users/LoadStar822/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LoadStar822/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "committer": {
      "login": "LoadStar822",
      "id": 56856603,
      "node_id": "MDQ6VXNlcjU2ODU2NjAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/56856603?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LoadStar822",
      "html_url": "https://github.com/LoadStar822",
      "followers_url": "https://api.github.com/users/LoadStar822/followers",
      "following_url": "https://api.github.com/users/LoadStar822/following{/other_user}",
      "gists_url": "https://api.github.com/users/LoadStar822/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LoadStar822/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LoadStar822/subscriptions",
      "organizations_url": "https://api.github.com/users/LoadStar822/orgs",
      "repos_url": "https://api.github.com/users/LoadStar822/repos",
      "events_url": "https://api.github.com/users/LoadStar822/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LoadStar822/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "d6c64fee265b51d1a91afa2586f3659ce2780f66",
        "url": "https://api.github.com/repos/malabz/Cax/commits/d6c64fee265b51d1a91afa2586f3659ce2780f66",
        "html_url": "https://github.com/malabz/Cax/commit/d6c64fee265b51d1a91afa2586f3659ce2780f66"
      }
    ],
    "stats": {
      "total": 722,
      "additions": 526,
      "deletions": 196
    },
    "files": [
      {
        "sha": "b6ff7815e901cd7b07ed6f5f624c1bc89a270dae",
        "filename": ".gitignore",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/malabz/Cax/blob/04ba16813105c0252beb02959a44bbba0857fc93/.gitignore",
        "raw_url": "https://github.com/malabz/Cax/raw/04ba16813105c0252beb02959a44bbba0857fc93/.gitignore",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/.gitignore?ref=04ba16813105c0252beb02959a44bbba0857fc93",
        "patch": "@@ -3,3 +3,4 @@ steps-output/\n jobstore/\n tests/__pycache__/\n cax_all_code.txt\n+*.pyc"
      },
      {
        "sha": "153ddc79dcd0bf43527111c74e91f8393c202ffe",
        "filename": "CHANGELOG.md",
        "status": "modified",
        "additions": 24,
        "deletions": 2,
        "changes": 26,
        "blob_url": "https://github.com/malabz/Cax/blob/04ba16813105c0252beb02959a44bbba0857fc93/CHANGELOG.md",
        "raw_url": "https://github.com/malabz/Cax/raw/04ba16813105c0252beb02959a44bbba0857fc93/CHANGELOG.md",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/CHANGELOG.md?ref=04ba16813105c0252beb02959a44bbba0857fc93",
        "patch": "@@ -2,9 +2,31 @@\n \n All notable changes to this project will be documented in this file.\n \n-# Changelog\n+## [0.2.1] - 2025-11-07\n \n-All notable changes to this project will be documented in this file.\n+### Highlights\n+- The Textual `cactus-prepare` prompt now features an argument wizard (F2 / `:wizard`), template chooser (F3 / `:template`), and history window (F4 / `!N`), guiding newcomers through common flags, bundling Evolver examples, and reusing the 20 most recent commands to shorten onboarding.\n+- The CLI persists each command, infers the real output directory from `--outDir` or `--outSeqFile`, and writes `cax_prepare_debug.txt` into that directory so logs travel alongside their artifacts.\n+\n+### CLI & Prompt\n+- Added inline shortcut hints plus `!N` history recall and the `:wizard`/`:template` quick commands, reducing re-typing and accidental edits.\n+- The wizard separates the species tree, outputs, HAL target, job store, and extra arguments; the extra field honors `shlex` parsing, and defaults are inferred from the current command or a chosen template.\n+- Before running `cactus-prepare`, the CLI records the exact command in `~/.cax/history.json` and emits debug output next to the inferred outputs (defaulting to `steps-output/`), keeping history, logs, and artifacts aligned.\n+\n+### Templates & Examples\n+- Introduced a template manager that scans the packaged Evolver Newick samples together with user entries in `~/.cax/templates.json`, deduplicates them, and points defaults to `~/.cax/outputs/<stem>` so repeated runs do not collide.\n+- Wheel builds now ship the Evolver example files, so templates work immediately after installation without manual copies.\n+\n+### History\n+- Added a lightweight history store (max 20 entries) in `~/.cax/history.json`, including the ability to delete entries from the history window and reuse them across projects.\n+\n+### UI\n+- Plan Overview supports a compact mode below 110 columns, hiding the environment card and tightening columns to avoid overflow, while environment summaries and RaMAx option dialogs now use English copy.\n+- The command editor switched to a multi-line TextArea with `Ctrl+S` save support, making long commands easier to edit and presenting modal text in English for clarity.\n+- The environment summary card condenses multi-line paths and versions into single-line snippets, uses English labels, and stays readable at any terminal width.\n+\n+### Other\n+- `.gitignore` now ignores `*.pyc` to avoid accidentally committing Python bytecode.\n \n ## [0.2.0] - 2025-10-28\n "
      },
      {
        "sha": "0c62199f16ac1e2d7f7ae75b420c1231325dff4e",
        "filename": "VERSION",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/malabz/Cax/blob/04ba16813105c0252beb02959a44bbba0857fc93/VERSION",
        "raw_url": "https://github.com/malabz/Cax/raw/04ba16813105c0252beb02959a44bbba0857fc93/VERSION",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/VERSION?ref=04ba16813105c0252beb02959a44bbba0857fc93",
        "patch": "@@ -1 +1 @@\n-0.2.0\n+0.2.1"
      },
      {
        "sha": "337523ce21afa3ed5909298b499db49acacd29cb",
        "filename": "cax/cli.py",
        "status": "modified",
        "additions": 26,
        "deletions": 7,
        "changes": 33,
        "blob_url": "https://github.com/malabz/Cax/blob/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Fcli.py",
        "raw_url": "https://github.com/malabz/Cax/raw/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Fcli.py",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/cax%2Fcli.py?ref=04ba16813105c0252beb02959a44bbba0857fc93",
        "patch": "@@ -30,8 +30,13 @@ def _load_prepare_text(\n             raise typer.Exit(code=result.returncode)\n         output = result.stdout or \"\"\n         history.add_command(shlex.join(cmd))\n-        Path(\"steps-output\").mkdir(exist_ok=True, parents=True)\n-        Path(\"steps-output/cax_prepare_debug.txt\").write_text(output, encoding=\"utf-8\")\n+        tokens = cmd[1:]\n+        out_dir_path = _discover_out_dir(tokens)\n+        if out_dir_path is None:\n+            out_dir_path = Path(\"steps-output\")\n+        out_dir_path.mkdir(exist_ok=True, parents=True)\n+        debug_path = out_dir_path / \"cax_prepare_debug.txt\"\n+        debug_path.write_text(output, encoding=\"utf-8\")\n         return output\n     if from_file:\n         return Path(from_file).read_text(encoding=\"utf-8\")\n@@ -90,11 +95,8 @@ def _prepare_plan_preview(\n     if prepare_args is None:\n         return None, None\n     tokens = shlex.split(prepare_args)\n-    out_dir = _extract_flag(tokens, \"--outDir\")\n-    out_seq = _extract_flag(tokens, \"--outSeqFile\")\n-    # If outDir not provided but outSeqFile is, derive from it.\n-    if out_dir is None and out_seq:\n-        out_dir = str(Path(out_seq).resolve().parent)\n+    out_dir_path = _discover_out_dir(tokens)\n+    out_dir = str(out_dir_path) if out_dir_path else None\n     job_store = _extract_flag(tokens, \"--jobStore\") or _extract_flag(tokens, \"--jobstore\")\n     # Some users may pass --jobStore=file:/path or jobstore=...; leave as-is for now.\n     return out_dir, job_store\n@@ -109,6 +111,23 @@ def _extract_flag(tokens: list[str], flag: str) -> Optional[str]:\n     return None\n \n \n+def _discover_out_dir(tokens: list[str]) -> Optional[Path]:\n+    \"\"\"Infer the output directory from cactus-prepare style tokens.\"\"\"\n+\n+    out_dir = _extract_flag(tokens, \"--outDir\")\n+    if out_dir:\n+        return Path(out_dir).expanduser()\n+    out_seq = _extract_flag(tokens, \"--outSeqFile\")\n+    if out_seq:\n+        seq_path = Path(out_seq).expanduser()\n+        try:\n+            parent = seq_path.resolve().parent\n+        except OSError:\n+            parent = seq_path.parent\n+        return parent\n+    return None\n+\n+\n def _ensure_clean_environment(out_dir: Optional[str], job_store: Optional[str]) -> None:\n     \"\"\"Before running cactus-prepare, optionally clean existing output directories.\"\"\"\n "
      },
      {
        "sha": "8b76ee8c138b74bff71e89310e1fe4747aee791f",
        "filename": "cax/command_prompt.py",
        "status": "modified",
        "additions": 295,
        "deletions": 105,
        "changes": 400,
        "blob_url": "https://github.com/malabz/Cax/blob/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Fcommand_prompt.py",
        "raw_url": "https://github.com/malabz/Cax/raw/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Fcommand_prompt.py",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/cax%2Fcommand_prompt.py?ref=04ba16813105c0252beb02959a44bbba0857fc93",
        "patch": "@@ -5,12 +5,17 @@\n from pathlib import Path\n import shlex\n from typing import Literal\n+from textwrap import dedent\n \n from textual.app import App, ComposeResult\n from textual.binding import Binding\n+from textual.containers import Container\n from textual.screen import Screen\n from textual.widgets import Button, Footer, Header, Input, ListItem, ListView, Static\n+from textual.scroll_view import ScrollView\n \n+from rich.console import Group\n+from rich.text import Text\n from . import history, templates\n \n \n@@ -30,76 +35,107 @@ class PrepareWizard(Screen[str | None]):\n         Binding(\"escape\", \"cancel\", \"Back\"),\n     ]\n \n+    FIELD_DEFINITIONS = [\n+        (\"spec\", \"Species/plan file\", \"examples/evolverMammals.txt\"),\n+        (\"out_dir\", \"--outDir\", str(templates.default_output_dir(\"run\"))),\n+        (\"out_seq\", \"--outSeqFile\", \"steps-output/out.txt\"),\n+        (\"out_hal\", \"--outHal\", \"steps-output/out.hal\"),\n+        (\"job_store\", \"--jobStore\", \"jobstore\"),\n+        (\"extra\", \"Extra arguments\", \"--maxCores 32\"),\n+    ]\n+\n     def __init__(self, defaults: dict[str, str] | None = None) -> None:\n         super().__init__()\n         self._status: Static | None = None\n         self._fields: dict[str, Input] = {}\n         self._defaults = defaults or {}\n \n     def compose(self) -> ComposeResult:\n-        yield Header()\n-        yield Static(\"Fill out the fields below and press “Generate command” to return.\", id=\"instructions\")\n-        for field_id, label, placeholder in [\n-            (\"spec\", \"Spec or plan file\", \"examples/evolverMammals.txt\"),\n-            (\"out_dir\", \"--outDir\", \"steps-output\"),\n-            (\"out_seq\", \"--outSeqFile\", \"steps-output/out.txt\"),\n-            (\"out_hal\", \"--outHal\", \"steps-output/out.hal\"),\n-            (\"job_store\", \"--jobStore\", \"jobstore\"),\n-            (\"extra\", \"Additional arguments\", \"--optionA foo --optionB\"),\n-        ]:\n-            value = self._defaults.get(field_id, \"\")\n-            input_widget = Input(value=value, placeholder=placeholder, id=field_id)\n-            self._fields[field_id] = input_widget\n-            yield Static(label)\n-            yield input_widget\n-        self._status = Static(\"\", id=\"status\")\n-        yield Button(\"Generate command\", id=\"submit\", variant=\"success\")\n-        yield Button(\"Cancel\", id=\"cancel\")\n-        yield self._status\n+        yield Header(show_clock=True)\n+        with Container(id=\"wizard-layout\"):\n+            scroll = ScrollView(id=\"wizard-scroll\", can_focus=False, can_focus_children=True)\n+            scroll.show_horizontal_scrollbar = False\n+            with scroll:\n+                instructions = Text.from_markup(\n+                    \"[bold cyan]Fill in the fields below to build a cactus-prepare command.[/]\\n\"\n+                    \"Fields left empty won't be added to the command. Click the buttons below when you're done.\"\n+                )\n+                yield Static(instructions, id=\"wizard-instructions\")\n+                for field_id, label, placeholder in self.FIELD_DEFINITIONS:\n+                    value = self._defaults.get(field_id, \"\")\n+                    input_widget = Input(\n+                        value=value,\n+                        placeholder=placeholder,\n+                        id=f\"wizard-{field_id}\",\n+                    )\n+                    self._fields[field_id] = input_widget\n+                    yield Static(label, classes=\"wizard-label\")\n+                    yield input_widget\n+            with Container(id=\"wizard-actions\"):\n+                yield Button(\"Generate command\", id=\"submit\", variant=\"success\")\n+                yield Button(\"Cancel\", id=\"cancel\")\n+            status = Static(\"\", id=\"wizard-status\")\n+            self._status = status\n+            yield status\n         yield Footer()\n \n+    def on_mount(self) -> None:  # type: ignore[override]\n+        spec_input = self._fields.get(\"spec\")\n+        if spec_input:\n+            spec_input.focus()\n+\n     def action_cancel(self) -> None:\n         self.dismiss(None)\n \n     def on_button_pressed(self, event: Button.Pressed) -> None:  # type: ignore[override]\n         if event.button.id == \"cancel\":\n-            self.dismiss(None)\n-            return\n-        if event.button.id != \"submit\":\n-            return\n-        spec = self._fields[\"spec\"].value.strip()\n-        if not spec:\n-            self._set_status(\"[red]Spec or plan file cannot be empty[/red]\")\n-            return\n-        spec_path = Path(spec)\n-        if not spec_path.exists():\n-            self._set_status(\"[red]Specified plan file does not exist[/red]\")\n+            self.action_cancel()\n             return\n-        command = [\"cactus-prepare\", spec]\n-        out_dir = self._fields[\"out_dir\"].value.strip()\n-        if out_dir:\n-            command.extend([\"--outDir\", out_dir])\n-        out_seq = self._fields[\"out_seq\"].value.strip()\n-        if out_seq:\n-            command.extend([\"--outSeqFile\", out_seq])\n-        out_hal = self._fields[\"out_hal\"].value.strip()\n-        if out_hal:\n-            command.extend([\"--outHal\", out_hal])\n-        job_store = self._fields[\"job_store\"].value.strip()\n-        if job_store:\n-            command.extend([\"--jobStore\", job_store])\n+        if event.button.id == \"submit\":\n+            self._submit()\n+\n+    def on_input_submitted(self, event: Input.Submitted) -> None:  # type: ignore[override]\n+        event.stop()\n+        self._submit()\n+\n+    def _submit(self) -> None:\n+        command = self._build_command()\n+        if command:\n+            self.dismiss(command)\n+\n+    def _build_command(self) -> str | None:\n+        spec = self._fields.get(\"spec\")\n+        if not spec or not spec.value.strip():\n+            self._update_status(\"[red]A species/plan file path is required[/red]\")\n+            return None\n+        tokens: list[str] = [\"cactus-prepare\", spec.value.strip()]\n+        mapping = [\n+            (\"out_dir\", \"--outDir\"),\n+            (\"out_seq\", \"--outSeqFile\"),\n+            (\"out_hal\", \"--outHal\"),\n+            (\"job_store\", \"--jobStore\"),\n+        ]\n+        for field_id, flag in mapping:\n+            value = self._fields[field_id].value.strip()\n+            if value:\n+                tokens.extend([flag, value])\n         extra = self._fields[\"extra\"].value.strip()\n         if extra:\n-            command.extend(shlex.split(extra))\n-        self.dismiss(shlex.join(command))\n+            try:\n+                tokens.extend(shlex.split(extra))\n+            except ValueError as exc:\n+                self._update_status(f\"[red]Failed to parse extra arguments: {exc}[/red]\")\n+                return None\n+        self._update_status(\"[green]Command generated. Confirm to return to the main view.[/green]\")\n+        return shlex.join(tokens)\n \n-    def _set_status(self, message: str) -> None:\n+    def _update_status(self, message: str) -> None:\n         if self._status:\n             self._status.update(message)\n \n \n class TemplateSelector(Screen[templates.Template | None]):\n-    \"\"\"Simple list view that lets the user pick a template.\"\"\"\n+    \"\"\"Simple screen that lists templates and returns the chosen one.\"\"\"\n \n     BINDINGS = [\n         Binding(\"escape\", \"cancel\", \"Back\"),\n@@ -111,62 +147,179 @@ def __init__(self, template_list: list[templates.Template]) -> None:\n         self._list_view: ListView | None = None\n \n     def compose(self) -> ComposeResult:\n-        yield Header()\n-        if not self._templates:\n-            yield Static(\"No templates available.\", id=\"instructions\")\n-        else:\n-            yield Static(\"Use the arrow keys to choose a template, then press Enter.\", id=\"instructions\")\n-            items: list[ListItem] = []\n-            for idx, template in enumerate(self._templates):\n-                description = f\"{template.name}\\n{template.spec}\"\n-                item = ListItem(Static(description), id=f\"template-{idx}\")\n-                items.append(item)\n+        yield Header(show_clock=True)\n+        with Container(id=\"template-layout\"):\n+            title = Text.from_markup(\"[bold cyan]Choose a template[/]\")\n+            yield Static(title, id=\"template-title\")\n+            items = []\n+            for template in self._templates:\n+                text = Text.assemble((template.name, \"bold\"), \"\\n\", (template.spec, \"dim\"))\n+                items.append(ListItem(Static(text), name=template.name))\n             list_view = ListView(*items, id=\"template-list\")\n             self._list_view = list_view\n             yield list_view\n         yield Footer()\n \n+    def on_mount(self) -> None:  # type: ignore[override]\n+        if self._list_view:\n+            self._list_view.focus()\n+\n+    def action_cancel(self) -> None:\n+        self.dismiss(None)\n+\n+    def on_list_view_selected(self, event: ListView.Selected) -> None:  # type: ignore[override]\n+        event.stop()\n+        template = self._templates[event.index] if 0 <= event.index < len(self._templates) else None\n+        self.dismiss(template)\n+\n+\n+class HistoryViewer(Screen[str | None]):\n+    \"\"\"Full-screen history viewer that returns the selected command.\"\"\"\n+\n+    BINDINGS = [\n+        Binding(\"escape\", \"cancel\", \"Back\"),\n+        Binding(\"delete\", \"delete_entry\", \"Delete\"),\n+        Binding(\"d\", \"delete_entry\", \"Delete\"),\n+    ]\n+\n+    def __init__(self, entries: list[history.HistoryEntry]) -> None:\n+        super().__init__()\n+        self._entries = entries\n+        self._list_view: ListView | None = None\n+        self._content_container: Container | None = None\n+        self._status: Static | None = None\n+\n+    def compose(self) -> ComposeResult:\n+        yield Header(show_clock=True)\n+        with Container(id=\"history-layout\"):\n+            instructions = Text.from_markup(\n+                dedent(\n+                    \"\"\"\n+                    [bold cyan]History[/]\n+                    • Use the arrow keys or PgUp/PgDn to scroll\n+                    • Press Enter to copy the selected command into the main view\n+                    • Press [bold magenta]D[/] or [bold magenta]Delete[/] to remove the selected command\n+                    • Press Esc to go back\n+                    \"\"\"\n+                ).strip()\n+            )\n+            yield Static(instructions, id=\"history-instructions\")\n+            content = Container(*self._build_history_content(), id=\"history-content\")\n+            self._content_container = content\n+            yield content\n+            status = Static(\"\", id=\"history-status\")\n+            self._status = status\n+            yield status\n+        yield Footer()\n+\n+    def on_mount(self) -> None:  # type: ignore[override]\n+        if self._list_view:\n+            self._list_view.focus()\n+\n     def action_cancel(self) -> None:\n         self.dismiss(None)\n \n     def on_list_view_selected(self, event: ListView.Selected) -> None:  # type: ignore[override]\n-        if not event.item.id:\n+        event.stop()\n+        if 0 <= event.index < len(self._entries):\n+            command = self._entries[event.index].command\n+            self.dismiss(command)\n+        else:\n+            self.dismiss(None)\n+\n+    async def action_delete_entry(self) -> None:\n+        if not self._entries:\n+            self._update_status(\"[yellow]No entries to delete[/yellow]\")\n             return\n-        if not event.item.id.startswith(\"template-\"):\n+        if not self._list_view or self._list_view.index is None:\n+            self._update_status(\"[yellow]Select a command to delete first[/yellow]\")\n             return\n-        try:\n-            index = int(event.item.id.split(\"-\", 1)[1])\n-        except ValueError:\n+        index = self._list_view.index\n+        if not history.delete_entry(index):\n+            self._update_status(\"[red]Delete failed, please try again[/red]\")\n             return\n-        if index < 0 or index >= len(self._templates):\n+        del self._entries[index]\n+        await self._refresh_history_content()\n+        if self._entries:\n+            self._update_status(f\"[green]Deleted history command #{index + 1}[/green]\")\n+        else:\n+            self._update_status(\"[green]History cleared[/green]\")\n+\n+    def _build_history_content(self) -> list[Static | ListView]:\n+        self._list_view = None\n+        if not self._entries:\n+            empty = Text.from_markup(\n+                \"[dim]No history yet. After you run cactus-prepare, the latest commands will appear here.[/]\"\n+            )\n+            return [Static(empty, id=\"history-empty\")]\n+        items = []\n+        for idx, entry in enumerate(self._entries, start=1):\n+            text = Text.from_markup(f\"[bold cyan]#{idx}[/] {entry.command}\")\n+            items.append(ListItem(Static(text), name=str(idx)))\n+        list_view = ListView(*items, id=\"history-list\")\n+        self._list_view = list_view\n+        return [list_view]\n+\n+    async def _refresh_history_content(self) -> None:\n+        if not self._content_container:\n             return\n-        self.dismiss(self._templates[index])\n-\n-    def on_mount(self) -> None:  # type: ignore[override]\n+        await self._content_container.remove_children()\n+        for widget in self._build_history_content():\n+            await self._content_container.mount(widget)\n         if self._list_view:\n-            self._list_view.index = 0\n+            self._list_view.focus()\n+\n+    def _update_status(self, message: str) -> None:\n+        if self._status:\n+            self._status.update(message)\n \n \n class PrepareCommandPrompt(App[PromptResult]):\n     \"\"\"Minimal Textual app that requests a cactus-prepare command.\"\"\"\n \n     CSS = \"\"\"\n-    Screen {\n+    Screen { layout: vertical; min-height: 0; }\n+    #prepare-layout { layout: vertical; padding: 1 2; min-height: 0; width: 1fr; }\n+    #content { layout: vertical; padding-bottom: 2; width: 1fr; height: 1fr; min-height: 0; }\n+    #instructions-panel { layout: vertical; width: 1fr; min-height: 0; }\n+    #instructions-title { padding-bottom: 1; }\n+    .instructions-block { padding-bottom: 1; }\n+    .instructions-block:last-child { padding-bottom: 0; }\n+    #prepare-bottom { layout: vertical; padding: 1 2; width: 1fr; height: auto; min-height: 0; }\n+    #command-title { color: $accent; }\n+    #command { margin: 1 0; }\n+    #status { padding: 0 0 1 0; }\n+\n+    /* Wizard screen */\n+    #wizard-layout {\n         layout: vertical;\n-    }\n-    #instructions {\n+        height: 1fr;\n         padding: 1 2;\n+        min-height: 0;\n     }\n-    #history {\n-        padding: 0 2;\n-        color: #b3b3b3;\n-    }\n-    #command {\n-        margin: 1 2;\n-    }\n-    #status {\n-        padding: 0 2 1 2;\n+    #wizard-scroll {\n+        height: 1fr;\n+        padding: 0 1;\n+        min-height: 0;\n     }\n+    .wizard-label { padding-top: 1; }\n+    .wizard-label:first-of-type { padding-top: 0; }\n+    #wizard-actions { layout: horizontal; padding: 1 0; }\n+    #wizard-actions Button { margin-right: 1; }\n+    #wizard-actions Button:last-child { margin-right: 0; }\n+    #wizard-status { padding: 0 0 1 0; }\n+\n+    /* Template selection */\n+    #template-layout { layout: vertical; height: 1fr; padding: 1 2; min-height: 0; }\n+    #template-title { padding-bottom: 1; }\n+    #template-list { height: 1fr; min-height: 0; }\n+\n+    /* History view */\n+    #history-layout { layout: vertical; height: 1fr; padding: 1 2; min-height: 0; }\n+    #history-instructions { padding-bottom: 1; }\n+    #history-content { height: 1fr; min-height: 0; }\n+    #history-list { height: 1fr; min-height: 0; }\n+    #history-status { padding-top: 1; }\n     \"\"\"\n \n     BINDINGS = [\n@@ -176,38 +329,65 @@ class PrepareCommandPrompt(App[PromptResult]):\n         Binding(\"f3\", \"choose_template\", \"Templates\"),\n         Binding(\"ctrl+shift+w\", \"open_wizard\", \"Wizard\"),\n         Binding(\"ctrl+shift+t\", \"choose_template\", \"Templates\"),\n+        Binding(\"f4\", \"show_history\", \"History\"),\n+        Binding(\"ctrl+shift+h\", \"show_history\", \"History\"),\n     ]\n \n     def __init__(self) -> None:\n         super().__init__()\n         self._command_input: Input | None = None\n         self._status: Static | None = None\n-        self._history_text: Static | None = None\n         self._history_entries = history.load_history()\n         self._templates = templates.load_templates()\n         self._template_defaults: dict[str, str] | None = None\n \n     def compose(self) -> ComposeResult:\n         yield Header(show_clock=True)\n-        instructions = (\n-            \"Enter a full cactus-prepare command and press Enter to submit. \"\n-            \"To reuse history, type `!N` (for example `!1`) and press Enter to load, then press Enter again to submit. \"\n-            \"Press F2 or Ctrl+Shift+W to open the argument wizard, F3 or Ctrl+Shift+T to pick a template, \"\n-            \"or type `:wizard` / `:template` directly in the prompt.\"\n-        )\n-        yield Static(instructions, id=\"instructions\")\n-        history_widget = Static(self._render_history(), id=\"history\")\n-        self._history_text = history_widget\n-        yield history_widget\n-        command_input = Input(placeholder=\"cactus-prepare …\", id=\"command\")\n-        self._command_input = command_input\n-        yield command_input\n-        status = Static(\"\", id=\"status\")\n-        self._status = status\n-        yield status\n+        with Container(id=\"prepare-layout\"):\n+            with Container(id=\"content\"):\n+                with Container(id=\"instructions-panel\"):\n+                    instructions_title = Text.from_markup(\"[bold cyan]Preparation[/]\")\n+                    yield Static(instructions_title, id=\"instructions-title\")\n+                    instructions_sections = [\n+                        Text.from_markup(\n+                            dedent(\n+                                \"\"\"\n+                                [bold underline]Shortcuts[/]\n+                                • [bold magenta]F2[/] / [bold magenta]Ctrl+Shift+W[/] open the argument wizard\n+                                • [bold magenta]F3[/] / [bold magenta]Ctrl+Shift+T[/] choose a template\n+                                • [bold magenta]F4[/] / [bold magenta]Ctrl+Shift+H[/] view command history\n+                                • [bold magenta]Esc[/] / [bold magenta]Ctrl+C[/] exit this prompt\n+                                \"\"\"\n+                            ).strip()\n+                        ),\n+                        Text.from_markup(\n+                            dedent(\n+                                \"\"\"\n+                                [bold underline]Command entry[/]\n+                                • Enter a full `cactus-prepare` command and press Enter to submit it\n+                                • Type `[reverse]!N[/]` (for example `[reverse]!1[/]`) to load a history entry\n+                                • Type `[bold magenta]:wizard[/]` to open the argument wizard, or `[bold magenta]:template[/]` to open the template list\n+                                • The history window keeps the 20 most recent commands\n+                                \"\"\"\n+                            ).strip()\n+                        ),\n+                    ]\n+                    for section in instructions_sections:\n+                        yield Static(section, classes=\"instructions-block\")\n+\n+            with Container(id=\"prepare-bottom\"):\n+                command_title = Text.from_markup(\"[bold]Enter a cactus-prepare command[/]\")\n+                yield Static(command_title, id=\"command-title\")\n+                command_input = Input(placeholder=\"cactus-prepare …\", id=\"command\")\n+                self._command_input = command_input\n+                yield command_input\n+                status = Static(\"\", id=\"status\")\n+                self._status = status\n+                yield status\n         yield Footer()\n \n     def on_mount(self) -> None:  # type: ignore[override]\n+        self._refresh_history()\n         if self._command_input:\n             if self._history_entries:\n                 self._command_input.value = self._history_entries[0].command\n@@ -270,19 +450,20 @@ def action_choose_template(self) -> None:\n             return\n         self.push_screen(TemplateSelector(self._templates), self._template_chosen)\n \n+    def action_show_history(self) -> None:\n+        self._refresh_history()\n+        if not self._history_entries:\n+            self._update_status(\"[yellow]No history available yet[/yellow]\")\n+            return\n+        self.push_screen(HistoryViewer(self._history_entries), self._history_selected)\n+\n     def _update_status(self, message: str) -> None:\n         if self._status:\n             self._status.update(message)\n \n-    def _render_history(self) -> str:\n-        if not self._history_entries:\n-            return \"No history yet.\"\n-        lines: list[str] = [\"Recent history:\"]\n-        for idx, entry in enumerate(self._history_entries[:5], start=1):\n-            lines.append(f\"{idx}. {entry.command}\")\n-        if len(self._history_entries) > 5:\n-            lines.append(\"…\")\n-        return \"\\n\".join(lines)\n+    def _refresh_history(self) -> None:\n+        self._history_entries = history.load_history()\n+\n \n     def _wizard_finished(self, result: str | None) -> None:\n         if not result:\n@@ -303,6 +484,15 @@ def _template_chosen(self, template: templates.Template | None) -> None:\n         self._template_defaults = template.to_wizard_defaults()\n         self._update_status(f\"[green]Applied template: {template.name}[/green]\")\n \n+    def _history_selected(self, command: str | None) -> None:\n+        if not command:\n+            self._update_status(\"[yellow]History window closed[/yellow]\")\n+            return\n+        if self._command_input:\n+            self._command_input.value = command\n+            self._command_input.cursor_position = len(command)\n+        self._update_status(\"[green]History command loaded. Press Enter to submit.[/green]\")\n+\n     def _suggest_defaults(self) -> dict[str, str]:\n         defaults: dict[str, str] = {}\n         if self._template_defaults:"
      },
      {
        "sha": "ebab9d73b004581d231f689ef748f5e8eb3cef84",
        "filename": "cax/detectors.py",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/malabz/Cax/blob/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Fdetectors.py",
        "raw_url": "https://github.com/malabz/Cax/raw/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Fdetectors.py",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/cax%2Fdetectors.py?ref=04ba16813105c0252beb02959a44bbba0857fc93",
        "patch": "@@ -88,7 +88,7 @@ def environment_summary() -> dict[str, Optional[str]]:\n \n     ramax = executable_info(\"RaMAx\", [\"--version\"])\n     cactus_exec = executable_info(\"cactus\", [\"--version\"])\n-    # 优先使用用户指定的命令获取 cactus 版本\n+    # Prefer user-specified commands when deriving the cactus version\n     cactus_version = detect_cactus_version() or (cactus_exec.version)\n     return {\n         \"ramax_path\": ramax.path,"
      },
      {
        "sha": "00ef90bee51285c9dabed54b44992c9763b43ce8",
        "filename": "cax/examples/__init__.py",
        "status": "added",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/malabz/Cax/blob/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Fexamples%2F__init__.py",
        "raw_url": "https://github.com/malabz/Cax/raw/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Fexamples%2F__init__.py",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/cax%2Fexamples%2F__init__.py?ref=04ba16813105c0252beb02959a44bbba0857fc93",
        "patch": "@@ -0,0 +1 @@\n+\"\"\"Example input files for cactus-prepare.\"\"\""
      },
      {
        "sha": "2666e1784a1c2597bb1475f5068f55668613eaef",
        "filename": "cax/examples/evolverMammals.txt",
        "status": "added",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/malabz/Cax/blob/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Fexamples%2FevolverMammals.txt",
        "raw_url": "https://github.com/malabz/Cax/raw/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Fexamples%2FevolverMammals.txt",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/cax%2Fexamples%2FevolverMammals.txt?ref=04ba16813105c0252beb02959a44bbba0857fc93",
        "patch": "@@ -0,0 +1,7 @@\n+((simHuman_chr6:0.144018,(simMouse_chr6:0.084509,simRat_chr6:0.091589)mr:0.271974):0.020593,(simCow_chr6:0.18908,simDog_chr6:0.16303):0.032898);\n+\n+simCow_chr6 https://raw.githubusercontent.com/ComparativeGenomicsToolkit/cactusTestData/master/evolver/mammals/loci1/simCow.chr6\n+simDog_chr6 https://raw.githubusercontent.com/ComparativeGenomicsToolkit/cactusTestData/master/evolver/mammals/loci1/simDog.chr6\n+simHuman_chr6 https://raw.githubusercontent.com/ComparativeGenomicsToolkit/cactusTestData/master/evolver/mammals/loci1/simHuman.chr6\n+simMouse_chr6 https://raw.githubusercontent.com/ComparativeGenomicsToolkit/cactusTestData/master/evolver/mammals/loci1/simMouse.chr6\n+simRat_chr6 https://raw.githubusercontent.com/ComparativeGenomicsToolkit/cactusTestData/master/evolver/mammals/loci1/simRat.chr6"
      },
      {
        "sha": "9c8623807fc6703b253ec081ab220862ac635184",
        "filename": "cax/examples/evolverPrimates.txt",
        "status": "added",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/malabz/Cax/blob/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Fexamples%2FevolverPrimates.txt",
        "raw_url": "https://github.com/malabz/Cax/raw/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Fexamples%2FevolverPrimates.txt",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/cax%2Fexamples%2FevolverPrimates.txt?ref=04ba16813105c0252beb02959a44bbba0857fc93",
        "patch": "@@ -0,0 +1,6 @@\n+(simOrang:0.00993,((simChimp:0.00272,simHuman:0.00269)cb:0.00415,simGorilla:0.00644)hcb:0.00046);\n+\n+simOrang\thttps://raw.githubusercontent.com/ComparativeGenomicsToolkit/cactusTestData/master/evolver/primates/loci1/simOrang.chr6\n+simChimp\thttps://raw.githubusercontent.com/ComparativeGenomicsToolkit/cactusTestData/master/evolver/primates/loci1/simChimp.chr6\n+simHuman\thttps://raw.githubusercontent.com/ComparativeGenomicsToolkit/cactusTestData/master/evolver/primates/loci1/simHuman.chr6\n+simGorilla\thttps://raw.githubusercontent.com/ComparativeGenomicsToolkit/cactusTestData/master/evolver/primates/loci1/simGorilla.chr6"
      },
      {
        "sha": "024485892c0cace519bdb5c70dc6c9005912839e",
        "filename": "cax/history.py",
        "status": "modified",
        "additions": 14,
        "deletions": 1,
        "changes": 15,
        "blob_url": "https://github.com/malabz/Cax/blob/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Fhistory.py",
        "raw_url": "https://github.com/malabz/Cax/raw/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Fhistory.py",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/cax%2Fhistory.py?ref=04ba16813105c0252beb02959a44bbba0857fc93",
        "patch": "@@ -6,7 +6,7 @@\n from pathlib import Path\n from typing import Iterable, List\n \n-HISTORY_FILE = Path(\"steps-output/cax_history.json\")\n+HISTORY_FILE = Path.home() / \".cax\" / \"history.json\"\n HISTORY_LIMIT = 20\n \n \n@@ -55,3 +55,16 @@ def add_command(command: str) -> None:\n         if entry.command != command:\n             merged.append(entry.command)\n     save_history(merged)\n+\n+\n+def delete_entry(index: int) -> bool:\n+    \"\"\"Delete a history entry by its zero-based index.\"\"\"\n+\n+    if index < 0:\n+        return False\n+    entries = load_history()\n+    if index >= len(entries):\n+        return False\n+    del entries[index]\n+    save_history(entry.command for entry in entries)\n+    return True"
      },
      {
        "sha": "63cbeb02f5f4cc4fe4e0550b033b50a412c9b302",
        "filename": "cax/render.py",
        "status": "modified",
        "additions": 28,
        "deletions": 20,
        "changes": 48,
        "blob_url": "https://github.com/malabz/Cax/blob/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Frender.py",
        "raw_url": "https://github.com/malabz/Cax/raw/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Frender.py",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/cax%2Frender.py?ref=04ba16813105c0252beb02959a44bbba0857fc93",
        "patch": "@@ -14,7 +14,7 @@\n from .planner import PlannedCommand\n \n \n-def plan_overview(plan: Plan) -> Panel:\n+def plan_overview(plan: Plan, compact: bool = False) -> Panel:\n     \"\"\"Return a Rich Panel summarising the plan (auto-resizes in UI).\"\"\"\n \n     table = Table(\n@@ -23,20 +23,28 @@ def plan_overview(plan: Plan) -> Panel:\n         header_style=\"bold magenta\",\n         expand=True,\n     )\n-    table.add_column(\"Round\", overflow=\"fold\")\n-    table.add_column(\"Root\", overflow=\"fold\")\n-    table.add_column(\"Target HAL\", overflow=\"fold\")\n-    table.add_column(\"RaMAx?\", overflow=\"fold\")\n-    table.add_column(\"Workdir\", overflow=\"fold\")\n+    if compact:\n+        table.add_column(\"Round\", overflow=\"ellipsis\", no_wrap=True, ratio=2)\n+        table.add_column(\"Root\", overflow=\"ellipsis\", no_wrap=True, ratio=2)\n+        table.add_column(\"Target HAL\", overflow=\"ellipsis\", no_wrap=True, ratio=3)\n+        table.add_column(\"RaMAx?\", overflow=\"ellipsis\", no_wrap=True, ratio=1)\n+    else:\n+        table.add_column(\"Round\", overflow=\"fold\")\n+        table.add_column(\"Root\", overflow=\"fold\")\n+        table.add_column(\"Target HAL\", overflow=\"fold\")\n+        table.add_column(\"RaMAx?\", overflow=\"fold\")\n+        table.add_column(\"Workdir\", overflow=\"fold\")\n \n     for round_entry in plan.rounds:\n-        table.add_row(\n+        row = [\n             round_entry.name,\n             round_entry.root,\n             round_entry.target_hal,\n             \"yes\" if round_entry.replace_with_ramax else \"no\",\n-            round_entry.workdir or \"\",\n-        )\n+        ]\n+        if not compact:\n+            row.append(round_entry.workdir or \"\")\n+        table.add_row(*row)\n \n     footer = Text(f\"Verbose logging: {'on' if plan.verbose else 'off'}\", style=\"dim\")\n     content = Group(table, footer)\n@@ -50,15 +58,15 @@ def environment_summary_card(\n     \"\"\"Return a Rich Panel that adapts to container width (no pre-rendering).\"\"\"\n \n     def value_or_missing(value: Optional[str]) -> str:\n-        return value if value else \"未检测到\"\n+        return value if value else \"Not detected\"\n \n     def oneline(value: Optional[str]) -> str:\n         if not value:\n-            return \"未检测到\"\n+            return \"Not detected\"\n         lines = value.splitlines()\n         if not lines:\n             return value\n-        return lines[0] if len(lines) == 1 else f\"{lines[0]} (＋{len(lines)-1} more)\"\n+        return lines[0] if len(lines) == 1 else f\"{lines[0]} (+{len(lines)-1} more)\"\n \n     table = Table.grid(padding=(0, 1), expand=True)\n     table.add_column(ratio=1)\n@@ -69,16 +77,16 @@ def entry(name: str, value: Optional[str]) -> Text:\n         text.append(oneline(value))\n         return text\n \n-    table.add_row(entry(\"RaMAx 路径\", environment.get(\"ramax_path\")))\n-    table.add_row(entry(\"RaMAx 版本\", environment.get(\"ramax_version\")))\n-    table.add_row(entry(\"cactus 路径\", environment.get(\"cactus_path\")))\n-    table.add_row(entry(\"cactus 版本\", environment.get(\"cactus_version\")))\n+    table.add_row(entry(\"RaMAx path\", environment.get(\"ramax_path\")))\n+    table.add_row(entry(\"RaMAx version\", environment.get(\"ramax_version\")))\n+    table.add_row(entry(\"cactus path\", environment.get(\"cactus_path\")))\n+    table.add_row(entry(\"cactus version\", environment.get(\"cactus_version\")))\n     table.add_row(entry(\"GPU\", environment.get(\"gpu\")))\n-    table.add_row(entry(\"CPU 核心数\", resources.get(\"cpu_count\")))\n-    table.add_row(entry(\"内存 (GB)\", resources.get(\"memory_gb\")))\n-    table.add_row(entry(\"磁盘可用 (GB)\", resources.get(\"disk_free_gb\")))\n+    table.add_row(entry(\"CPU cores\", resources.get(\"cpu_count\")))\n+    table.add_row(entry(\"Memory (GB)\", resources.get(\"memory_gb\")))\n+    table.add_row(entry(\"Disk free (GB)\", resources.get(\"disk_free_gb\")))\n \n-    panel = Panel(table, title=\"环境摘要\", border_style=\"cyan\", expand=True)\n+    panel = Panel(table, title=\"Environment summary\", border_style=\"cyan\", expand=True)\n     return panel\n \n "
      },
      {
        "sha": "c80d2b46f8520c805914ac8052b8aec80e61731b",
        "filename": "cax/templates.py",
        "status": "modified",
        "additions": 53,
        "deletions": 19,
        "changes": 72,
        "blob_url": "https://github.com/malabz/Cax/blob/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Ftemplates.py",
        "raw_url": "https://github.com/malabz/Cax/raw/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Ftemplates.py",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/cax%2Ftemplates.py?ref=04ba16813105c0252beb02959a44bbba0857fc93",
        "patch": "@@ -6,8 +6,10 @@\n from pathlib import Path\n import shlex\n \n-TEMPLATE_FILE = Path(\"steps-output/cax_templates.json\")\n+TEMPLATE_FILE = Path.home() / \".cax\" / \"templates.json\"\n+PACKAGE_EXAMPLE_DIR = Path(__file__).resolve().parent / \"examples\"\n EXAMPLE_DIR = Path(\"examples\")\n+EXAMPLE_DIRS = (PACKAGE_EXAMPLE_DIR, EXAMPLE_DIR)\n FLAG_MAP = {\n     \"out_dir\": \"--outDir\",\n     \"out_seq\": \"--outSeqFile\",\n@@ -54,27 +56,52 @@ def load_templates() -> list[Template]:\n \n def _load_builtin_templates() -> list[Template]:\n     templates: list[Template] = []\n-    if not EXAMPLE_DIR.exists():\n-        return templates\n-    for path in sorted(EXAMPLE_DIR.glob(\"*.txt\")):\n-        stem = path.stem\n-        params = {\n-            \"out_dir\": \"steps-output\",\n-            \"out_seq\": f\"steps-output/{stem}.txt\",\n-            \"out_hal\": f\"steps-output/{stem}.hal\",\n-            \"job_store\": \"jobstore\",\n-        }\n-        templates.append(\n-            Template(\n-                name=f\"Example: {stem}\",\n-                spec=str(path),\n-                params=params,\n-                source=\"builtin\",\n-            )\n-        )\n+    seen: set[str] = set()\n+    for base_dir in EXAMPLE_DIRS:\n+        if not base_dir.exists():\n+            continue\n+        for path in sorted(base_dir.glob(\"*.txt\")):\n+            if path.name in seen:\n+                continue\n+            seen.add(path.name)\n+            template = _template_from_example(path)\n+            if template is not None:\n+                templates.append(template)\n     return templates\n \n \n+def _template_from_example(path: Path) -> Template | None:\n+    try:\n+        with path.open(encoding=\"utf-8\") as handle:\n+            first_line = next((line.strip() for line in handle if line.strip()), \"\")\n+    except OSError:\n+        return None\n+    if not _looks_like_newick(first_line):\n+        return None\n+    stem = path.stem\n+    default_out_dir_path = default_output_dir(stem)\n+    params = {\n+        \"out_dir\": str(default_out_dir_path),\n+        \"out_seq\": str(default_out_dir_path / f\"{stem}.txt\"),\n+        \"out_hal\": str(default_out_dir_path / f\"{stem}.hal\"),\n+        \"job_store\": \"jobstore\",\n+    }\n+    return Template(\n+        name=f\"Example: {stem}\",\n+        spec=str(path),\n+        params=params,\n+        source=\"builtin\",\n+    )\n+\n+\n+def _looks_like_newick(line: str) -> bool:\n+    if not line:\n+        return False\n+    if line.endswith(\";\") and \"(\" in line:\n+        return True\n+    return False\n+\n+\n def _load_user_templates() -> list[Template]:\n     try:\n         data = json.loads(TEMPLATE_FILE.read_text(encoding=\"utf-8\"))\n@@ -96,3 +123,10 @@ def _load_user_templates() -> list[Template]:\n         clean_params = {k: str(v) for k, v in params.items() if k in FLAG_MAP}\n         templates.append(Template(name=name, spec=spec, params=clean_params, source=\"user\"))\n     return templates\n+\n+\n+def default_output_dir(stem: str | None = None) -> Path:\n+    base = Path.home() / \".cax\" / \"outputs\"\n+    if stem:\n+        return base / stem\n+    return base"
      },
      {
        "sha": "9a3a044906cdb92bd6bbd507cfa56288f270ec92",
        "filename": "cax/ui.py",
        "status": "modified",
        "additions": 68,
        "deletions": 39,
        "changes": 107,
        "blob_url": "https://github.com/malabz/Cax/blob/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Fui.py",
        "raw_url": "https://github.com/malabz/Cax/raw/04ba16813105c0252beb02959a44bbba0857fc93/cax%2Fui.py",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/cax%2Fui.py?ref=04ba16813105c0252beb02959a44bbba0857fc93",
        "patch": "@@ -8,8 +8,9 @@\n from textual.app import App, ComposeResult\n from textual.binding import Binding\n from textual.containers import Container\n+from textual.geometry import Size\n from textual.screen import ModalScreen\n-from textual.widgets import Button, Footer, Header, Input, ListItem, ListView, Static, Tree\n+from textual.widgets import Button, Footer, Header, Input, ListItem, ListView, Static, Tree, TextArea\n \n from rich.text import Text\n \n@@ -103,7 +104,6 @@ class CommandEditModal(ModalScreen[str | None]):\n     BINDINGS = [\n         Binding(\"escape\", \"cancel\", \"Cancel\"),\n         Binding(\"ctrl+s\", \"save\", \"Save\"),\n-        Binding(\"enter\", \"save\", \"Save\"),\n     ]\n \n     CSS = \"\"\"\n@@ -140,15 +140,16 @@ def __init__(self, title: str, initial_command: str):\n         super().__init__()\n         self.title = title\n         self.initial_command = initial_command\n-        self._input: Input | None = None\n+        self._editor: TextArea | None = None\n         self._status: Static | None = None\n \n     def compose(self) -> ComposeResult:\n         with Container(id=\"editor-dialog\"):\n             yield Static(self.title, id=\"editor-title\")\n-            input_widget = Input(value=self.initial_command, id=\"editor-command\")\n-            self._input = input_widget\n-            yield input_widget\n+            editor = TextArea(id=\"editor-command\")\n+            editor.text = self.initial_command\n+            self._editor = editor\n+            yield editor\n             status = Static(\"\", id=\"editor-status\")\n             self._status = status\n             yield status\n@@ -157,18 +158,14 @@ def compose(self) -> ComposeResult:\n                 yield Button(\"Cancel\", id=\"cancel\")\n \n     def on_mount(self) -> None:\n-        if self._input:\n-            self._input.focus()\n-            self._input.cursor_position = len(self._input.value)\n-\n-    def on_input_submitted(self, event: Input.Submitted) -> None:\n-        self.action_save()\n+        if self._editor:\n+            self._editor.focus()\n \n     def action_save(self) -> None:\n-        if not self._input:\n+        if not self._editor:\n             self.dismiss(None)\n             return\n-        value = self._input.value.strip()\n+        value = self._editor.text.strip()\n         if not value:\n             if self._status:\n                 self._status.update(\"Command cannot be empty\")\n@@ -189,9 +186,9 @@ class RamaxOptionsModal(ModalScreen[tuple[list[str], list[str]] | None]):\n     \"\"\"Modal dialog for editing global and per-round RaMAx options.\"\"\"\n \n     BINDINGS = [\n-        Binding(\"escape\", \"cancel\", \"取消\"),\n-        Binding(\"ctrl+s\", \"save\", \"保存\"),\n-        Binding(\"enter\", \"save\", \"保存\"),\n+        Binding(\"escape\", \"cancel\", \"Cancel\"),\n+        Binding(\"ctrl+s\", \"save\", \"Save\"),\n+        Binding(\"enter\", \"save\", \"Save\"),\n     ]\n \n     CSS = \"\"\"\n@@ -252,27 +249,27 @@ def __init__(self, global_opts: list[str], round_opts: list[str]):\n \n     def compose(self) -> ComposeResult:\n         with Container(id=\"options-dialog\"):\n-            yield Static(\"编辑 RaMAx 选项\", id=\"options-title\")\n-            yield Static(\"全局选项 (plan.global_ramax_opts)\", classes=\"section-label\")\n+            yield Static(\"Edit RaMAx options\", id=\"options-title\")\n+            yield Static(\"Global options (plan.global_ramax_opts)\", classes=\"section-label\")\n             global_container = Container(id=\"global-options\", classes=\"options-list\")\n             self._global_container = global_container\n             yield global_container\n             with Container(id=\"global-buttons\", classes=\"button-row\"):\n-                yield Button(\"追加全局选项\", id=\"add-global\", variant=\"success\")\n-                yield Button(\"删除最后全局\", id=\"remove-global\", variant=\"warning\")\n-            yield Static(\"当前 Round 选项 (round.ramax_opts)\", classes=\"section-label\")\n+                yield Button(\"Add global option\", id=\"add-global\", variant=\"success\")\n+                yield Button(\"Remove last global\", id=\"remove-global\", variant=\"warning\")\n+            yield Static(\"Current Round options (round.ramax_opts)\", classes=\"section-label\")\n             round_container = Container(id=\"round-options\", classes=\"options-list\")\n             self._round_container = round_container\n             yield round_container\n             with Container(id=\"round-buttons\", classes=\"button-row\"):\n-                yield Button(\"追加 Round 选项\", id=\"add-round\", variant=\"success\")\n-                yield Button(\"删除最后 Round\", id=\"remove-round\", variant=\"warning\")\n+                yield Button(\"Add Round option\", id=\"add-round\", variant=\"success\")\n+                yield Button(\"Remove last Round\", id=\"remove-round\", variant=\"warning\")\n             status = Static(\"\", id=\"options-status\")\n             self._status = status\n             yield status\n             with Container(id=\"options-buttons\"):\n-                yield Button(\"保存\", id=\"save-options\", variant=\"success\")\n-                yield Button(\"取消\", id=\"cancel-options\")\n+                yield Button(\"Save\", id=\"save-options\", variant=\"success\")\n+                yield Button(\"Cancel\", id=\"cancel-options\")\n \n     def on_mount(self) -> None:\n         self._refresh_inputs()\n@@ -283,23 +280,23 @@ def _refresh_inputs(self) -> None:\n                 child.remove()\n             if self._global_values:\n                 inputs = [\n-                    Input(value=value, placeholder=\"例如 --threads=8\", classes=\"option-input\", id=f\"global-{idx}\")\n+                    Input(value=value, placeholder=\"e.g. --threads=8\", classes=\"option-input\", id=f\"global-{idx}\")\n                     for idx, value in enumerate(self._global_values)\n                 ]\n                 self._global_container.mount(*inputs)\n             else:\n-                self._global_container.mount(Static(\"（无全局选项）\", classes=\"option-empty\"))\n+                self._global_container.mount(Static(\"(no global options)\", classes=\"option-empty\"))\n         if self._round_container:\n             for child in list(self._round_container.children):\n                 child.remove()\n             if self._round_values:\n                 inputs = [\n-                    Input(value=value, placeholder=\"例如 --input {}\", classes=\"option-input\", id=f\"round-{idx}\")\n+                    Input(value=value, placeholder=\"e.g. --input {}\", classes=\"option-input\", id=f\"round-{idx}\")\n                     for idx, value in enumerate(self._round_values)\n                 ]\n                 self._round_container.mount(*inputs)\n             else:\n-                self._round_container.mount(Static(\"（无 Round 选项）\", classes=\"option-empty\"))\n+                self._round_container.mount(Static(\"(no Round options)\", classes=\"option-empty\"))\n \n     def _sync_from_inputs(self) -> None:\n         if self._global_container:\n@@ -388,19 +385,31 @@ class PlanUIApp(App[UIResult]):\n     CSS = \"\"\"\n     Screen {\n         layout: vertical;\n+        min-height: 0;\n     }\n     #main {\n         layout: horizontal;\n+        width: 100%;\n+        height: 1fr;\n+        min-height: 0;\n+    }\n+    #main > * {\n+        min-width: 0;\n+        min-height: 0;\n     }\n     #rounds {\n         width: 45%;\n+        min-width: 32;\n         height: 1fr;\n     }\n     #details {\n         width: 55%;\n         padding: 1 2;\n         overflow-y: auto;\n         layout: vertical;\n+        height: 1fr;\n+        min-width: 0;\n+        min-height: 0;\n     }\n     #environment-summary {\n         width: 100%;\n@@ -409,6 +418,8 @@ class PlanUIApp(App[UIResult]):\n         width: 100%;\n         margin-top: 1;\n     }\n+    /* TextArea size within the edit modal */\n+    #editor-command { height: 10; }\n     \"\"\"\n \n     BINDINGS = [\n@@ -430,6 +441,7 @@ def __init__(self, plan: Plan, base_dir: Optional[Path] = None):\n         self.round_items: list[RoundListItem] = []\n         self.round_list: ListView | None = None\n         self.detail_panel: Static | None = None\n+        self._environment_card: Static | None = None\n \n     def compose(self) -> ComposeResult:\n         yield Header()\n@@ -460,22 +472,34 @@ def compose(self) -> ComposeResult:\n                 ),\n                 id=\"environment-summary\",\n             )\n+            self._environment_card = environment_card\n             with Container(id=\"details\"):\n                 yield environment_card\n-                detail = Static(render.plan_overview(self.plan), id=\"plan-overview\")\n+                detail = Static(\n+                    render.plan_overview(self.plan, compact=self._is_compact()),\n+                    id=\"plan-overview\",\n+                )\n                 self.detail_panel = detail\n                 yield detail\n         yield Footer()\n \n     def on_mount(self) -> None:\n         if self.tree_widget and self.alignment_tree:\n-            self.tree_widget.root.expand_all()\n+            if self.size.width > 120:\n+                self.tree_widget.root.expand_all()\n             self.tree_widget.move_cursor(self.tree_widget.root, animate=False)\n             self.set_focus(self.tree_widget)\n             self._show_alignment_node(self.alignment_tree.root)\n         elif self.round_list and self.round_items:\n             self.round_list.index = 0\n             self._show_round(0)\n+        self._apply_env_visibility()\n+\n+    def watch_size(self, size: Size) -> None:  # type: ignore[override]\n+        self._apply_env_visibility()\n+\n+    def _is_compact(self) -> bool:\n+        return self.size.width <= 110\n \n     def action_toggle_round(self) -> None:\n         if self.alignment_tree and self.tree_widget:\n@@ -512,7 +536,7 @@ def action_toggle_round(self) -> None:\n \n     def action_preview_plan(self) -> None:\n         if self.detail_panel:\n-            preview = render.plan_overview(self.plan)\n+            preview = render.plan_overview(self.plan, compact=self._is_compact())\n             self.detail_panel.update(preview)\n \n     def action_run_plan(self) -> None:\n@@ -549,6 +573,11 @@ def action_toggle_verbose(self) -> None:\n         elif self.detail_panel:\n             self.detail_panel.update(message)\n \n+    def _apply_env_visibility(self) -> None:\n+        if not self._environment_card:\n+            return\n+        self._environment_card.display = self.size.width > 110\n+\n     def action_edit_round(self) -> None:\n         if self.alignment_tree and self.tree_widget:\n             node = self._selected_alignment_node()\n@@ -626,18 +655,18 @@ def _round_details(self, round_entry: Round) -> list[str]:\n             details.append(\"[magenta]hal2fasta[/magenta]\")\n             details.extend(step.raw for step in round_entry.hal2fasta_steps)\n         details.append(\"\")\n-        details.append(\"[yellow]RaMAx 选项[/yellow]\")\n-        details.append(f\"全局: {self._format_option_list(self.plan.global_ramax_opts)}\")\n+        details.append(\"[yellow]RaMAx options[/yellow]\")\n+        details.append(f\"Global: {self._format_option_list(self.plan.global_ramax_opts)}\")\n         details.append(f\"Round: {self._format_option_list(round_entry.ramax_opts)}\")\n         return details\n \n     def _format_option_list(self, options: list[str]) -> str:\n-        return \", \".join(options) if options else \"（空）\"\n+        return \", \".join(options) if options else \"(empty)\"\n \n     def _ramax_options_summary(self, round_entry: Round) -> str:\n         global_summary = self._format_option_list(self.plan.global_ramax_opts)\n         round_summary = self._format_option_list(round_entry.ramax_opts)\n-        return f\"全局: {global_summary}\\nRound: {round_summary}\"\n+        return f\"Global: {global_summary}\\nRound: {round_summary}\"\n \n     def _show_round(self, index: int, status: str | None = None) -> None:\n         if not self.detail_panel or index >= len(self.plan.rounds):\n@@ -652,7 +681,7 @@ def _gather_command_targets(self, round_entry: Round) -> list[CommandTarget]:\n         targets: list[CommandTarget] = [\n             CommandTarget(\n                 key=\"ramax-options\",\n-                label=\"RaMAx 选项\",\n+                label=\"RaMAx options\",\n                 command=self._ramax_options_summary(round_entry),\n                 kind=\"ramax-options\",\n             )\n@@ -850,7 +879,7 @@ def _apply_ramax_options(\n         self.plan.global_ramax_opts = global_opts\n         round_entry = self.plan.rounds[round_index]\n         round_entry.ramax_opts = round_opts\n-        status = \"已更新 RaMAx 选项\"\n+        status = \"RaMAx options updated\"\n         if self.alignment_tree and self.tree_widget:\n             node = self._find_node_for_round(round_entry)\n             if node:"
      },
      {
        "sha": "fd2a394402debef867f907115199f1345d91acce",
        "filename": "pyproject.toml",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/malabz/Cax/blob/04ba16813105c0252beb02959a44bbba0857fc93/pyproject.toml",
        "raw_url": "https://github.com/malabz/Cax/raw/04ba16813105c0252beb02959a44bbba0857fc93/pyproject.toml",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/pyproject.toml?ref=04ba16813105c0252beb02959a44bbba0857fc93",
        "patch": "@@ -30,7 +30,7 @@ python_files = [\"test_*.py\"]\n \n [tool.hatch.build.targets.wheel]\n packages = [\"cax\"]\n+include = [\"cax/examples/*.txt\"]\n \n [tool.hatch.build.targets.sdist]\n include = [\"cax\", \"examples\", \"tests\", \"README.md\", \"pyproject.toml\"]\n-"
      }
    ]
  }
}