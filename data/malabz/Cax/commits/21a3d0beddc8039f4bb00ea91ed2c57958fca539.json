{
  "cached_at": "2025-12-20T14:33:31.605241",
  "commit_sha": "21a3d0beddc8039f4bb00ea91ed2c57958fca539",
  "repo": "malabz/Cax",
  "data": {
    "sha": "21a3d0beddc8039f4bb00ea91ed2c57958fca539",
    "node_id": "C_kwDOPt61otoAKDIxYTNkMGJlZGRjODAzOWY0YmIwMGVhOTFlZDJjNTc5NThmY2E1Mzk",
    "commit": {
      "author": {
        "name": "LoadStar822",
        "email": "992247533@qq.com",
        "date": "2025-10-28T08:25:22Z"
      },
      "committer": {
        "name": "LoadStar822",
        "email": "992247533@qq.com",
        "date": "2025-10-28T08:25:22Z"
      },
      "message": "  feat: responsive Environment Summary & Plan Overview; add RaMAx options editor\n\n  - UI: Environment Summary rendered as Rich Panel with auto-resize; Plan Overview\n    switched to Panel/Table (expand + overflow=fold) to avoid overflow/misalignment\n    on narrow terminals\n  - UI: Added RaMAx options editor for plan.global_ramax_opts and round.ramax_opts;\n    supports add/remove and is integrated into the E-key edit flow; previews auto-append\n    options\n  - Detect: Report cactus path/version; version prefers `pip show cactus | grep -i ^Version`\n    with fallback to `python -m pip show cactus`; filter NVML noise lines\n  - CSS: Removed unsupported `gap`; use margins for spacing\n  - CLI: Stop echoing the full `cactus-prepare` command to reduce noise\n  - Docs: Update CHANGELOG; release 0.2.0 (2025-10-28)",
      "tree": {
        "sha": "4adece6ac1a04994c8fcfe7f722ab8a9d0bf1684",
        "url": "https://api.github.com/repos/malabz/Cax/git/trees/4adece6ac1a04994c8fcfe7f722ab8a9d0bf1684"
      },
      "url": "https://api.github.com/repos/malabz/Cax/git/commits/21a3d0beddc8039f4bb00ea91ed2c57958fca539",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null,
        "verified_at": null
      }
    },
    "url": "https://api.github.com/repos/malabz/Cax/commits/21a3d0beddc8039f4bb00ea91ed2c57958fca539",
    "html_url": "https://github.com/malabz/Cax/commit/21a3d0beddc8039f4bb00ea91ed2c57958fca539",
    "comments_url": "https://api.github.com/repos/malabz/Cax/commits/21a3d0beddc8039f4bb00ea91ed2c57958fca539/comments",
    "author": {
      "login": "LoadStar822",
      "id": 56856603,
      "node_id": "MDQ6VXNlcjU2ODU2NjAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/56856603?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LoadStar822",
      "html_url": "https://github.com/LoadStar822",
      "followers_url": "https://api.github.com/users/LoadStar822/followers",
      "following_url": "https://api.github.com/users/LoadStar822/following{/other_user}",
      "gists_url": "https://api.github.com/users/LoadStar822/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LoadStar822/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LoadStar822/subscriptions",
      "organizations_url": "https://api.github.com/users/LoadStar822/orgs",
      "repos_url": "https://api.github.com/users/LoadStar822/repos",
      "events_url": "https://api.github.com/users/LoadStar822/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LoadStar822/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "committer": {
      "login": "LoadStar822",
      "id": 56856603,
      "node_id": "MDQ6VXNlcjU2ODU2NjAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/56856603?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LoadStar822",
      "html_url": "https://github.com/LoadStar822",
      "followers_url": "https://api.github.com/users/LoadStar822/followers",
      "following_url": "https://api.github.com/users/LoadStar822/following{/other_user}",
      "gists_url": "https://api.github.com/users/LoadStar822/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LoadStar822/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LoadStar822/subscriptions",
      "organizations_url": "https://api.github.com/users/LoadStar822/orgs",
      "repos_url": "https://api.github.com/users/LoadStar822/repos",
      "events_url": "https://api.github.com/users/LoadStar822/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LoadStar822/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "83f3304baffd03ac6d291738bb1a904afeaa9693",
        "url": "https://api.github.com/repos/malabz/Cax/commits/83f3304baffd03ac6d291738bb1a904afeaa9693",
        "html_url": "https://github.com/malabz/Cax/commit/83f3304baffd03ac6d291738bb1a904afeaa9693"
      }
    ],
    "stats": {
      "total": 406,
      "additions": 376,
      "deletions": 30
    },
    "files": [
      {
        "sha": "a73451893963c84520503d4352c89f16679fd26e",
        "filename": ".gitignore",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/malabz/Cax/blob/21a3d0beddc8039f4bb00ea91ed2c57958fca539/.gitignore",
        "raw_url": "https://github.com/malabz/Cax/raw/21a3d0beddc8039f4bb00ea91ed2c57958fca539/.gitignore",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/.gitignore?ref=21a3d0beddc8039f4bb00ea91ed2c57958fca539",
        "patch": "@@ -1,4 +1,5 @@\n cax/__pycache__/\n steps-output/\n jobstore/\n-tests/__pycache__/\n\\ No newline at end of file\n+tests/__pycache__/\n+cax_all_code.txt"
      },
      {
        "sha": "39acacf0c931425fab236f34302b748c40443b82",
        "filename": "CHANGELOG.md",
        "status": "modified",
        "additions": 11,
        "deletions": 1,
        "changes": 12,
        "blob_url": "https://github.com/malabz/Cax/blob/21a3d0beddc8039f4bb00ea91ed2c57958fca539/CHANGELOG.md",
        "raw_url": "https://github.com/malabz/Cax/raw/21a3d0beddc8039f4bb00ea91ed2c57958fca539/CHANGELOG.md",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/CHANGELOG.md?ref=21a3d0beddc8039f4bb00ea91ed2c57958fca539",
        "patch": "@@ -6,13 +6,23 @@ All notable changes to this project will be documented in this file.\n \n All notable changes to this project will be documented in this file.\n \n-## [0.2.0] - Unreleased\n+## [0.2.0] - 2025-10-28\n \n ### Highlights\n - Added interactive confirmation before running `cactus-prepare`, allowing users to remove stale `--outDir`/`--jobStore` directories in advance.\n - Enhanced execution feedback with Rich-based progress indicators, end-of-run summaries, and optional verbose streaming of all command output.\n - Surfaced plan-level verbose state in the UI (toggle with `V`) and overview rendering, keeping the terminal quiet by default while filtering RaMAx graph verification noise.\n \n+### UI\n+- Added Environment Summary card to the top of the details pane, showing RaMAx/cactus paths and versions, GPU, CPU, memory, and disk. The card is now rendered as a Rich `Panel` and adapts to terminal width to avoid overflow and misalignment.\n+- Replaced fixed-width string rendering with Rich renderables (`Panel`, `Table`) for both the Environment Summary and Plan Overview, ensuring responsive layout from narrow to full-screen terminals.\n+- Introduced RaMAx options editor: global `plan.global_ramax_opts` and per-round `round.ramax_opts` editable via a new modal with add/remove controls. Options are reflected in command previews automatically.\n+- Removed unsupported `gap` CSS usage and adjusted spacing with margins to fix Textual CSS errors.\n+\n+### Detection & Tooling\n+- Environment detection now reports cactus (not cactus-prepare) path and version. Cactus version is obtained via `pip show cactus | grep -i ^Version` with a fallback to `python -m pip show cactus` parsing; noisy NVML messages are filtered out.\n+- Minor CLI polish: removed echoing of the full `cactus-prepare` command to reduce console noise.\n+\n ### Documentation & Tooling\n - Updated README with the new verbose shortcut and pre-run cleanup behaviour.\n - Expanded `PlanRunner` logging to emphasise failures and log locations."
      },
      {
        "sha": "0ea3a944b399d25f7e1b8fe684d754eb8da9fe7f",
        "filename": "VERSION",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/malabz/Cax/blob/21a3d0beddc8039f4bb00ea91ed2c57958fca539/VERSION",
        "raw_url": "https://github.com/malabz/Cax/raw/21a3d0beddc8039f4bb00ea91ed2c57958fca539/VERSION",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/VERSION?ref=21a3d0beddc8039f4bb00ea91ed2c57958fca539",
        "patch": "@@ -1 +1 @@\n-0.2.0-dev\n+0.2.0"
      },
      {
        "sha": "e2252ead00da34c5a3fb44b61ce59b49daec8b83",
        "filename": "cax/cli.py",
        "status": "modified",
        "additions": 0,
        "deletions": 1,
        "changes": 1,
        "blob_url": "https://github.com/malabz/Cax/blob/21a3d0beddc8039f4bb00ea91ed2c57958fca539/cax%2Fcli.py",
        "raw_url": "https://github.com/malabz/Cax/raw/21a3d0beddc8039f4bb00ea91ed2c57958fca539/cax%2Fcli.py",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/cax%2Fcli.py?ref=21a3d0beddc8039f4bb00ea91ed2c57958fca539",
        "patch": "@@ -23,7 +23,6 @@ def _load_prepare_text(\n ) -> str:\n     if prepare_args is not None:\n         cmd = [executable, *shlex.split(prepare_args)]\n-        typer.echo(f\"[cax] running: {' '.join(cmd)}\")\n         result = subprocess.run(cmd, check=False, capture_output=True, text=True)\n         if result.returncode != 0:\n             typer.echo(result.stdout)"
      },
      {
        "sha": "6316378721f5e8a06ffa01ace3a331afbbbeed2a",
        "filename": "cax/detectors.py",
        "status": "modified",
        "additions": 65,
        "deletions": 4,
        "changes": 69,
        "blob_url": "https://github.com/malabz/Cax/blob/21a3d0beddc8039f4bb00ea91ed2c57958fca539/cax%2Fdetectors.py",
        "raw_url": "https://github.com/malabz/Cax/raw/21a3d0beddc8039f4bb00ea91ed2c57958fca539/cax%2Fdetectors.py",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/cax%2Fdetectors.py?ref=21a3d0beddc8039f4bb00ea91ed2c57958fca539",
        "patch": "@@ -4,6 +4,7 @@\n import platform\n import shutil\n import subprocess\n+import sys\n from dataclasses import dataclass\n from typing import Optional\n \n@@ -29,7 +30,17 @@ def executable_info(executable: str, version_args: list[str] | None = None) -> E\n     if path and version_args is not None:\n         try:\n             result = subprocess.run([path, *version_args], check=False, capture_output=True, text=True)\n-            version = result.stdout.strip() or result.stderr.strip() or None\n+            version_output = result.stdout.strip() or result.stderr.strip() or None\n+            if version_output:\n+                cleaned_lines = []\n+                for raw_line in version_output.splitlines():\n+                    line = raw_line.strip()\n+                    if not line:\n+                        continue\n+                    if \"failed to\" in line.lower():\n+                        continue\n+                    cleaned_lines.append(line)\n+                version = cleaned_lines[0] if cleaned_lines else None\n         except OSError:\n             version = None\n     return ExecutableInfo(name=executable, path=path, version=version)\n@@ -76,11 +87,61 @@ def environment_summary() -> dict[str, Optional[str]]:\n     \"\"\"Return a dictionary summarising key binaries and hardware.\"\"\"\n \n     ramax = executable_info(\"RaMAx\", [\"--version\"])\n-    cactus_prepare = executable_info(\"cactus-prepare\", [\"--version\"])\n+    cactus_exec = executable_info(\"cactus\", [\"--version\"])\n+    # 优先使用用户指定的命令获取 cactus 版本\n+    cactus_version = detect_cactus_version() or (cactus_exec.version)\n     return {\n         \"ramax_path\": ramax.path,\n         \"ramax_version\": ramax.version,\n-        \"cactus_prepare_path\": cactus_prepare.path,\n-        \"cactus_prepare_version\": cactus_prepare.version,\n+        \"cactus_path\": cactus_exec.path,\n+        \"cactus_version\": cactus_version,\n         \"gpu\": detect_gpu_summary(),\n     }\n+\n+\n+def detect_cactus_version() -> Optional[str]:\n+    \"\"\"Return cactus version using: ``pip show cactus | grep -i ^Version``.\n+\n+    Falls back to ``python -m pip show cactus`` parsing when the pipeline isn't available.\n+    \"\"\"\n+\n+    # Pipeline per user instruction\n+    try:\n+        pipe_cmd = \"pip show cactus | grep -i ^Version\"\n+        result = subprocess.run(\n+            pipe_cmd,\n+            shell=True,\n+            check=False,\n+            capture_output=True,\n+            text=True,\n+        )\n+        if result.returncode == 0 and result.stdout:\n+            for raw in result.stdout.splitlines():\n+                line = raw.strip()\n+                if not line:\n+                    continue\n+                if line.lower().startswith(\"version\"):\n+                    # Accept either \"Version: x\" or \"version x\"\n+                    if \":\" in line:\n+                        return line.split(\":\", 1)[1].strip() or None\n+                    parts = line.split()\n+                    return parts[-1] if parts else None\n+    except OSError:\n+        pass\n+\n+    # Fallback without grep/pipes\n+    try:\n+        result = subprocess.run(\n+            [sys.executable, \"-m\", \"pip\", \"show\", \"cactus\"],\n+            check=False,\n+            capture_output=True,\n+            text=True,\n+        )\n+        if result.returncode != 0:\n+            return None\n+        for line in result.stdout.splitlines():\n+            if line.lower().startswith(\"version:\"):\n+                return line.split(\":\", 1)[1].strip() or None\n+    except OSError:\n+        return None\n+    return None"
      },
      {
        "sha": "83bdc4ec3eec93781fa9d894af641bb04d40bbe6",
        "filename": "cax/render.py",
        "status": "modified",
        "additions": 60,
        "deletions": 17,
        "changes": 77,
        "blob_url": "https://github.com/malabz/Cax/blob/21a3d0beddc8039f4bb00ea91ed2c57958fca539/cax%2Frender.py",
        "raw_url": "https://github.com/malabz/Cax/raw/21a3d0beddc8039f4bb00ea91ed2c57958fca539/cax%2Frender.py",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/cax%2Frender.py?ref=21a3d0beddc8039f4bb00ea91ed2c57958fca539",
        "patch": "@@ -1,29 +1,33 @@\n \"\"\"Rendering helpers for previews and shell exports.\"\"\"\n from __future__ import annotations\n \n-from io import StringIO\n import shlex\n-from typing import Iterable\n+from io import StringIO\n+from typing import Iterable, Optional\n \n-from rich.console import Console\n+from rich.console import Console, Group\n+from rich.panel import Panel\n from rich.table import Table\n+from rich.text import Text\n \n from .models import Plan\n from .planner import PlannedCommand\n \n \n-def plan_overview(plan: Plan) -> str:\n-    \"\"\"Return a rich table summarising the plan.\"\"\"\n-\n-    buf = StringIO()\n-    console = Console(file=buf, force_terminal=True, color_system=None)\n+def plan_overview(plan: Plan) -> Panel:\n+    \"\"\"Return a Rich Panel summarising the plan (auto-resizes in UI).\"\"\"\n \n-    table = Table(title=\"Cactus → RaMAx Plan\", show_header=True, header_style=\"bold magenta\")\n-    table.add_column(\"Round\")\n-    table.add_column(\"Root\")\n-    table.add_column(\"Target HAL\")\n-    table.add_column(\"RaMAx?\")\n-    table.add_column(\"Workdir\")\n+    table = Table(\n+        title=\"Cactus → RaMAx Plan\",\n+        show_header=True,\n+        header_style=\"bold magenta\",\n+        expand=True,\n+    )\n+    table.add_column(\"Round\", overflow=\"fold\")\n+    table.add_column(\"Root\", overflow=\"fold\")\n+    table.add_column(\"Target HAL\", overflow=\"fold\")\n+    table.add_column(\"RaMAx?\", overflow=\"fold\")\n+    table.add_column(\"Workdir\", overflow=\"fold\")\n \n     for round_entry in plan.rounds:\n         table.add_row(\n@@ -34,9 +38,48 @@ def plan_overview(plan: Plan) -> str:\n             round_entry.workdir or \"\",\n         )\n \n-    console.print(table)\n-    console.print(f\"Verbose logging: {'on' if plan.verbose else 'off'}\")\n-    return buf.getvalue()\n+    footer = Text(f\"Verbose logging: {'on' if plan.verbose else 'off'}\", style=\"dim\")\n+    content = Group(table, footer)\n+    return Panel(content, border_style=\"magenta\", expand=True)\n+\n+\n+def environment_summary_card(\n+    environment: dict[str, Optional[str]],\n+    resources: dict[str, str],\n+) -> Panel:\n+    \"\"\"Return a Rich Panel that adapts to container width (no pre-rendering).\"\"\"\n+\n+    def value_or_missing(value: Optional[str]) -> str:\n+        return value if value else \"未检测到\"\n+\n+    def oneline(value: Optional[str]) -> str:\n+        if not value:\n+            return \"未检测到\"\n+        lines = value.splitlines()\n+        if not lines:\n+            return value\n+        return lines[0] if len(lines) == 1 else f\"{lines[0]} (＋{len(lines)-1} more)\"\n+\n+    table = Table.grid(padding=(0, 1), expand=True)\n+    table.add_column(ratio=1)\n+\n+    def entry(name: str, value: Optional[str]) -> Text:\n+        text = Text()\n+        text.append(f\"{name}: \", style=\"bold cyan\")\n+        text.append(oneline(value))\n+        return text\n+\n+    table.add_row(entry(\"RaMAx 路径\", environment.get(\"ramax_path\")))\n+    table.add_row(entry(\"RaMAx 版本\", environment.get(\"ramax_version\")))\n+    table.add_row(entry(\"cactus 路径\", environment.get(\"cactus_path\")))\n+    table.add_row(entry(\"cactus 版本\", environment.get(\"cactus_version\")))\n+    table.add_row(entry(\"GPU\", environment.get(\"gpu\")))\n+    table.add_row(entry(\"CPU 核心数\", resources.get(\"cpu_count\")))\n+    table.add_row(entry(\"内存 (GB)\", resources.get(\"memory_gb\")))\n+    table.add_row(entry(\"磁盘可用 (GB)\", resources.get(\"disk_free_gb\")))\n+\n+    panel = Panel(table, title=\"环境摘要\", border_style=\"cyan\", expand=True)\n+    return panel\n \n \n def render_run_script(plan: Plan, commands: Iterable[PlannedCommand]) -> str:"
      },
      {
        "sha": "2d6545f5155f27a5b725bf1cc3b74246dd076cad",
        "filename": "cax/ui.py",
        "status": "modified",
        "additions": 237,
        "deletions": 5,
        "changes": 242,
        "blob_url": "https://github.com/malabz/Cax/blob/21a3d0beddc8039f4bb00ea91ed2c57958fca539/cax%2Fui.py",
        "raw_url": "https://github.com/malabz/Cax/raw/21a3d0beddc8039f4bb00ea91ed2c57958fca539/cax%2Fui.py",
        "contents_url": "https://api.github.com/repos/malabz/Cax/contents/cax%2Fui.py?ref=21a3d0beddc8039f4bb00ea91ed2c57958fca539",
        "patch": "@@ -13,7 +13,7 @@\n \n from rich.text import Text\n \n-from . import planner, render, tree_utils\n+from . import detectors, planner, render, tree_utils\n from .models import Plan, Round, Step\n \n \n@@ -184,6 +184,171 @@ def on_button_pressed(self, event: Button.Pressed) -> None:\n         else:\n             self.action_cancel()\n \n+\n+class RamaxOptionsModal(ModalScreen[tuple[list[str], list[str]] | None]):\n+    \"\"\"Modal dialog for editing global and per-round RaMAx options.\"\"\"\n+\n+    BINDINGS = [\n+        Binding(\"escape\", \"cancel\", \"取消\"),\n+        Binding(\"ctrl+s\", \"save\", \"保存\"),\n+        Binding(\"enter\", \"save\", \"保存\"),\n+    ]\n+\n+    CSS = \"\"\"\n+    RamaxOptionsModal {\n+        align: center middle;\n+    }\n+    #options-dialog {\n+        padding: 1 2;\n+        width: 80%;\n+        max-width: 90;\n+        border: round $accent;\n+        background: $panel;\n+    }\n+    #options-title {\n+        padding-bottom: 1;\n+    }\n+    .section-label {\n+        padding-top: 1;\n+        padding-bottom: 0;\n+    }\n+    .options-list {\n+        layout: vertical;\n+        gap: 1;\n+        max-height: 12;\n+        overflow-y: auto;\n+        padding-top: 1;\n+    }\n+    .option-input {\n+        width: 100%;\n+    }\n+    .option-empty {\n+        color: $text-muted;\n+    }\n+    .button-row {\n+        layout: horizontal;\n+        gap: 1;\n+        padding-top: 1;\n+    }\n+    #options-buttons {\n+        layout: horizontal;\n+        gap: 1;\n+        padding-top: 1;\n+        justify: end;\n+    }\n+    #options-status {\n+        padding-top: 1;\n+        color: $error;\n+    }\n+    \"\"\"\n+\n+    def __init__(self, global_opts: list[str], round_opts: list[str]):\n+        super().__init__()\n+        self._global_values = list(global_opts)\n+        self._round_values = list(round_opts)\n+        self._global_container: Container | None = None\n+        self._round_container: Container | None = None\n+        self._status: Static | None = None\n+\n+    def compose(self) -> ComposeResult:\n+        with Container(id=\"options-dialog\"):\n+            yield Static(\"编辑 RaMAx 选项\", id=\"options-title\")\n+            yield Static(\"全局选项 (plan.global_ramax_opts)\", classes=\"section-label\")\n+            global_container = Container(id=\"global-options\", classes=\"options-list\")\n+            self._global_container = global_container\n+            yield global_container\n+            with Container(id=\"global-buttons\", classes=\"button-row\"):\n+                yield Button(\"追加全局选项\", id=\"add-global\", variant=\"success\")\n+                yield Button(\"删除最后全局\", id=\"remove-global\", variant=\"warning\")\n+            yield Static(\"当前 Round 选项 (round.ramax_opts)\", classes=\"section-label\")\n+            round_container = Container(id=\"round-options\", classes=\"options-list\")\n+            self._round_container = round_container\n+            yield round_container\n+            with Container(id=\"round-buttons\", classes=\"button-row\"):\n+                yield Button(\"追加 Round 选项\", id=\"add-round\", variant=\"success\")\n+                yield Button(\"删除最后 Round\", id=\"remove-round\", variant=\"warning\")\n+            status = Static(\"\", id=\"options-status\")\n+            self._status = status\n+            yield status\n+            with Container(id=\"options-buttons\"):\n+                yield Button(\"保存\", id=\"save-options\", variant=\"success\")\n+                yield Button(\"取消\", id=\"cancel-options\")\n+\n+    def on_mount(self) -> None:\n+        self._refresh_inputs()\n+\n+    def _refresh_inputs(self) -> None:\n+        if self._global_container:\n+            for child in list(self._global_container.children):\n+                child.remove()\n+            if self._global_values:\n+                inputs = [\n+                    Input(value=value, placeholder=\"例如 --threads=8\", classes=\"option-input\", id=f\"global-{idx}\")\n+                    for idx, value in enumerate(self._global_values)\n+                ]\n+                self._global_container.mount(*inputs)\n+            else:\n+                self._global_container.mount(Static(\"（无全局选项）\", classes=\"option-empty\"))\n+        if self._round_container:\n+            for child in list(self._round_container.children):\n+                child.remove()\n+            if self._round_values:\n+                inputs = [\n+                    Input(value=value, placeholder=\"例如 --input {}\", classes=\"option-input\", id=f\"round-{idx}\")\n+                    for idx, value in enumerate(self._round_values)\n+                ]\n+                self._round_container.mount(*inputs)\n+            else:\n+                self._round_container.mount(Static(\"（无 Round 选项）\", classes=\"option-empty\"))\n+\n+    def _sync_from_inputs(self) -> None:\n+        if self._global_container:\n+            self._global_values = self._collect_values(self._global_container, strip_empty=False)\n+        if self._round_container:\n+            self._round_values = self._collect_values(self._round_container, strip_empty=False)\n+\n+    def _collect_values(self, container: Container, strip_empty: bool) -> list[str]:\n+        values: list[str] = []\n+        for widget in container.query(Input):\n+            value = widget.value if not strip_empty else widget.value.strip()\n+            if strip_empty:\n+                if value:\n+                    values.append(value)\n+            else:\n+                values.append(value)\n+        return values\n+\n+    def action_save(self) -> None:\n+        global_values = self._collect_values(self._global_container, strip_empty=True) if self._global_container else []\n+        round_values = self._collect_values(self._round_container, strip_empty=True) if self._round_container else []\n+        self.dismiss((global_values, round_values))\n+\n+    def action_cancel(self) -> None:\n+        self.dismiss(None)\n+\n+    def on_button_pressed(self, event: Button.Pressed) -> None:\n+        button_id = event.button.id\n+        if button_id == \"save-options\":\n+            self.action_save()\n+            return\n+        if button_id == \"cancel-options\":\n+            self.action_cancel()\n+            return\n+        self._sync_from_inputs()\n+        if button_id == \"add-global\":\n+            self._global_values.append(\"\")\n+        elif button_id == \"remove-global\":\n+            if self._global_values:\n+                self._global_values.pop()\n+        elif button_id == \"add-round\":\n+            self._round_values.append(\"\")\n+        elif button_id == \"remove-round\":\n+            if self._round_values:\n+                self._round_values.pop()\n+        else:\n+            return\n+        self._refresh_inputs()\n+\n class RoundListItem(ListItem):\n     \"\"\"List item reflecting a round with RaMAx toggle.\"\"\"\n \n@@ -235,6 +400,14 @@ class PlanUIApp(App[UIResult]):\n         width: 55%;\n         padding: 1 2;\n         overflow-y: auto;\n+        layout: vertical;\n+    }\n+    #environment-summary {\n+        width: 100%;\n+    }\n+    #plan-overview {\n+        width: 100%;\n+        margin-top: 1;\n     }\n     \"\"\"\n \n@@ -280,9 +453,18 @@ def compose(self) -> ComposeResult:\n                 list_view = ListView(*self.round_items, id=\"rounds\")\n                 self.round_list = list_view\n                 yield list_view\n-            detail = Static(render.plan_overview(self.plan), id=\"details\")\n-            self.detail_panel = detail\n-            yield detail\n+            environment_card = Static(\n+                render.environment_summary_card(\n+                    detectors.environment_summary(),\n+                    detectors.system_resources(),\n+                ),\n+                id=\"environment-summary\",\n+            )\n+            with Container(id=\"details\"):\n+                yield environment_card\n+                detail = Static(render.plan_overview(self.plan), id=\"plan-overview\")\n+                self.detail_panel = detail\n+                yield detail\n         yield Footer()\n \n     def on_mount(self) -> None:\n@@ -443,8 +625,20 @@ def _round_details(self, round_entry: Round) -> list[str]:\n             details.append(\"\")\n             details.append(\"[magenta]hal2fasta[/magenta]\")\n             details.extend(step.raw for step in round_entry.hal2fasta_steps)\n+        details.append(\"\")\n+        details.append(\"[yellow]RaMAx 选项[/yellow]\")\n+        details.append(f\"全局: {self._format_option_list(self.plan.global_ramax_opts)}\")\n+        details.append(f\"Round: {self._format_option_list(round_entry.ramax_opts)}\")\n         return details\n \n+    def _format_option_list(self, options: list[str]) -> str:\n+        return \", \".join(options) if options else \"（空）\"\n+\n+    def _ramax_options_summary(self, round_entry: Round) -> str:\n+        global_summary = self._format_option_list(self.plan.global_ramax_opts)\n+        round_summary = self._format_option_list(round_entry.ramax_opts)\n+        return f\"全局: {global_summary}\\nRound: {round_summary}\"\n+\n     def _show_round(self, index: int, status: str | None = None) -> None:\n         if not self.detail_panel or index >= len(self.plan.rounds):\n             return\n@@ -455,7 +649,14 @@ def _show_round(self, index: int, status: str | None = None) -> None:\n         self.detail_panel.update(\"\\n\".join(details))\n \n     def _gather_command_targets(self, round_entry: Round) -> list[CommandTarget]:\n-        targets: list[CommandTarget] = []\n+        targets: list[CommandTarget] = [\n+            CommandTarget(\n+                key=\"ramax-options\",\n+                label=\"RaMAx 选项\",\n+                command=self._ramax_options_summary(round_entry),\n+                kind=\"ramax-options\",\n+            )\n+        ]\n         if round_entry.replace_with_ramax:\n             ramax_preview = self._ramax_command_preview(round_entry)\n             targets.append(\n@@ -601,6 +802,18 @@ def _handle_command_selection(self, round_index: int, target: CommandTarget | No\n         self._open_command_editor(round_index, target)\n \n     def _open_command_editor(self, round_index: int, target: CommandTarget) -> None:\n+        if target.kind == \"ramax-options\":\n+            if round_index >= len(self.plan.rounds):\n+                return\n+            options_modal = RamaxOptionsModal(\n+                self.plan.global_ramax_opts,\n+                self.plan.rounds[round_index].ramax_opts,\n+            )\n+            self.push_screen(\n+                options_modal,\n+                lambda result: self._apply_ramax_options(round_index, result),\n+            )\n+            return\n         editor = CommandEditModal(f\"Edit {target.label} command\", target.command)\n         self.push_screen(\n             editor,\n@@ -626,6 +839,25 @@ def _apply_command_edit(\n                 return\n         self._show_round(round_index, status=status)\n \n+    def _apply_ramax_options(\n+        self,\n+        round_index: int,\n+        result: tuple[list[str], list[str]] | None,\n+    ) -> None:\n+        if result is None or round_index >= len(self.plan.rounds):\n+            return\n+        global_opts, round_opts = result\n+        self.plan.global_ramax_opts = global_opts\n+        round_entry = self.plan.rounds[round_index]\n+        round_entry.ramax_opts = round_opts\n+        status = \"已更新 RaMAx 选项\"\n+        if self.alignment_tree and self.tree_widget:\n+            node = self._find_node_for_round(round_entry)\n+            if node:\n+                self._show_alignment_node(node, status=status)\n+                return\n+        self._show_round(round_index, status=status)\n+\n     def _ramax_command_preview(self, round_entry: Round) -> str:\n         if round_entry.manual_ramax_command:\n             return round_entry.manual_ramax_command"
      }
    ]
  }
}